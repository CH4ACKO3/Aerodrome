{"expires":1743603347.331,"value":{"highlighted":"<!-- Syntax highlighted by torchlight.dev --><div class='line'><span style=\"color: #89DDFF;\">import</span><span style=\"color: #A6ACCD;\"> random</span></div><div class='line'><span style=\"color: #89DDFF;\">import</span><span style=\"color: #A6ACCD;\"> numpy </span><span style=\"color: #89DDFF;\">as</span><span style=\"color: #A6ACCD;\"> np</span></div><div class='line'><span style=\"color: #89DDFF;\">import</span><span style=\"color: #A6ACCD;\"> argparse</span></div><div class='line'><span style=\"color: #89DDFF;\">from</span><span style=\"color: #A6ACCD;\"> copy </span><span style=\"color: #89DDFF;\">import</span><span style=\"color: #A6ACCD;\"> deepcopy</span></div><div class='line'><span style=\"color: #89DDFF;\">from</span><span style=\"color: #A6ACCD;\"> tqdm </span><span style=\"color: #89DDFF;\">import</span><span style=\"color: #A6ACCD;\"> tqdm</span></div><div class='line'><span style=\"color: #89DDFF;\">from</span><span style=\"color: #A6ACCD;\"> matplotlib </span><span style=\"color: #89DDFF;\">import</span><span style=\"color: #A6ACCD;\"> pyplot </span><span style=\"color: #89DDFF;\">as</span><span style=\"color: #A6ACCD;\"> plt</span></div><div class='line'>&nbsp;</div><div class='line'><span style=\"color: #89DDFF;\">import</span><span style=\"color: #A6ACCD;\"> torch</span></div><div class='line'><span style=\"color: #89DDFF;\">import</span><span style=\"color: #A6ACCD;\"> torch</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #F07178;\">nn</span><span style=\"color: #A6ACCD;\"> </span><span style=\"color: #89DDFF;\">as</span><span style=\"color: #A6ACCD;\"> nn</span></div><div class='line'><span style=\"color: #89DDFF;\">import</span><span style=\"color: #A6ACCD;\"> torch</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #F07178;\">nn</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #F07178;\">functional</span><span style=\"color: #A6ACCD;\"> </span><span style=\"color: #89DDFF;\">as</span><span style=\"color: #A6ACCD;\"> F</span></div><div class='line'><span style=\"color: #89DDFF;\">import</span><span style=\"color: #A6ACCD;\"> torch</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #F07178;\">optim</span><span style=\"color: #A6ACCD;\"> </span><span style=\"color: #89DDFF;\">as</span><span style=\"color: #A6ACCD;\"> optim</span></div><div class='line'><span style=\"color: #89DDFF;\">from</span><span style=\"color: #A6ACCD;\"> torch</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #A6ACCD;\">optim</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #A6ACCD;\">lr_scheduler </span><span style=\"color: #89DDFF;\">import</span><span style=\"color: #A6ACCD;\"> CosineAnnealingLR</span></div><div class='line'><span style=\"color: #89DDFF;\">import</span><span style=\"color: #A6ACCD;\"> aerodrome</span></div><div class='line'>&nbsp;</div><div class='line'><span style=\"color: #C792EA;\">class</span><span style=\"color: #A6ACCD;\"> </span><span style=\"color: #FFCB6B;\">ReplayBuffer</span><span style=\"color: #89DDFF;\">:</span></div><div class='line'><span style=\"color: #A6ACCD;\">    </span><span style=\"color: #C792EA;\">def</span><span style=\"color: #A6ACCD;\"> </span><span style=\"color: #82AAFF;\">__init__</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #A6ACCD;\">self</span><span style=\"color: #89DDFF;\">,</span><span style=\"color: #A6ACCD;\"> buffer_size</span><span style=\"color: #89DDFF;\">:</span><span style=\"color: #A6ACCD;\"> </span><span style=\"color: #FFCB6B;\">int</span><span style=\"color: #89DDFF;\">):</span></div><div class='line'><span style=\"color: #A6ACCD;\">        self</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #F07178;\">buffer_size</span><span style=\"color: #A6ACCD;\"> </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #A6ACCD;\"> buffer_size</span></div><div class='line'><span style=\"color: #A6ACCD;\">        self</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #F07178;\">full</span><span style=\"color: #A6ACCD;\"> </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #A6ACCD;\"> </span><span style=\"color: #89DDFF;\">False</span></div><div class='line'><span style=\"color: #A6ACCD;\">        self</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #F07178;\">pointer</span><span style=\"color: #A6ACCD;\"> </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #A6ACCD;\"> </span><span style=\"color: #F78C6C;\">0</span></div><div class='line'><span style=\"color: #A6ACCD;\">        self</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #F07178;\">obs</span><span style=\"color: #A6ACCD;\"> </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #A6ACCD;\"> np</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #82AAFF;\">zeros</span><span style=\"color: #89DDFF;\">((</span><span style=\"color: #82AAFF;\">buffer_size</span><span style=\"color: #89DDFF;\">,</span><span style=\"color: #82AAFF;\"> </span><span style=\"color: #F78C6C;\">4</span><span style=\"color: #89DDFF;\">),</span><span style=\"color: #82AAFF;\"> </span><span style=\"color: #A6ACCD;\">dtype</span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #82AAFF;\">np</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #F07178;\">float32</span><span style=\"color: #89DDFF;\">)</span></div><div class='line'><span style=\"color: #A6ACCD;\">        self</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #F07178;\">act</span><span style=\"color: #A6ACCD;\"> </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #A6ACCD;\"> np</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #82AAFF;\">zeros</span><span style=\"color: #89DDFF;\">((</span><span style=\"color: #82AAFF;\">buffer_size</span><span style=\"color: #89DDFF;\">,</span><span style=\"color: #82AAFF;\"> </span><span style=\"color: #F78C6C;\">1</span><span style=\"color: #89DDFF;\">),</span><span style=\"color: #82AAFF;\"> </span><span style=\"color: #A6ACCD;\">dtype</span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #82AAFF;\">np</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #F07178;\">float32</span><span style=\"color: #89DDFF;\">)</span></div><div class='line'><span style=\"color: #A6ACCD;\">        self</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #F07178;\">reward</span><span style=\"color: #A6ACCD;\"> </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #A6ACCD;\"> np</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #82AAFF;\">zeros</span><span style=\"color: #89DDFF;\">((</span><span style=\"color: #82AAFF;\">buffer_size</span><span style=\"color: #89DDFF;\">,</span><span style=\"color: #82AAFF;\"> </span><span style=\"color: #F78C6C;\">1</span><span style=\"color: #89DDFF;\">),</span><span style=\"color: #82AAFF;\"> </span><span style=\"color: #A6ACCD;\">dtype</span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #82AAFF;\">np</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #F07178;\">float32</span><span style=\"color: #89DDFF;\">)</span></div><div class='line'><span style=\"color: #A6ACCD;\">        self</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #F07178;\">next_obs</span><span style=\"color: #A6ACCD;\"> </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #A6ACCD;\"> np</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #82AAFF;\">zeros</span><span style=\"color: #89DDFF;\">((</span><span style=\"color: #82AAFF;\">buffer_size</span><span style=\"color: #89DDFF;\">,</span><span style=\"color: #82AAFF;\"> </span><span style=\"color: #F78C6C;\">4</span><span style=\"color: #89DDFF;\">),</span><span style=\"color: #82AAFF;\"> </span><span style=\"color: #A6ACCD;\">dtype</span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #82AAFF;\">np</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #F07178;\">float32</span><span style=\"color: #89DDFF;\">)</span></div><div class='line'><span style=\"color: #A6ACCD;\">        self</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #F07178;\">terminated</span><span style=\"color: #A6ACCD;\"> </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #A6ACCD;\"> np</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #82AAFF;\">zeros</span><span style=\"color: #89DDFF;\">((</span><span style=\"color: #82AAFF;\">buffer_size</span><span style=\"color: #89DDFF;\">,</span><span style=\"color: #82AAFF;\"> </span><span style=\"color: #F78C6C;\">1</span><span style=\"color: #89DDFF;\">),</span><span style=\"color: #82AAFF;\"> </span><span style=\"color: #A6ACCD;\">dtype</span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #82AAFF;\">np</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #F07178;\">float32</span><span style=\"color: #89DDFF;\">)</span></div><div class='line'><span style=\"color: #A6ACCD;\">        self</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #F07178;\">truncated</span><span style=\"color: #A6ACCD;\"> </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #A6ACCD;\"> np</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #82AAFF;\">zeros</span><span style=\"color: #89DDFF;\">((</span><span style=\"color: #82AAFF;\">buffer_size</span><span style=\"color: #89DDFF;\">,</span><span style=\"color: #82AAFF;\"> </span><span style=\"color: #F78C6C;\">1</span><span style=\"color: #89DDFF;\">),</span><span style=\"color: #82AAFF;\"> </span><span style=\"color: #A6ACCD;\">dtype</span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #82AAFF;\">np</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #F07178;\">float32</span><span style=\"color: #89DDFF;\">)</span></div><div class='line'>&nbsp;</div><div class='line'><span style=\"color: #A6ACCD;\">    </span><span style=\"color: #C792EA;\">def</span><span style=\"color: #A6ACCD;\"> </span><span style=\"color: #82AAFF;\">push</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #A6ACCD;\">self</span><span style=\"color: #89DDFF;\">,</span><span style=\"color: #A6ACCD;\"> obs</span><span style=\"color: #89DDFF;\">,</span><span style=\"color: #A6ACCD;\"> act</span><span style=\"color: #89DDFF;\">,</span><span style=\"color: #A6ACCD;\"> reward</span><span style=\"color: #89DDFF;\">,</span><span style=\"color: #A6ACCD;\"> next_obs</span><span style=\"color: #89DDFF;\">,</span><span style=\"color: #A6ACCD;\"> terminated</span><span style=\"color: #89DDFF;\">,</span><span style=\"color: #A6ACCD;\"> truncated</span><span style=\"color: #89DDFF;\">):</span></div><div class='line'><span style=\"color: #A6ACCD;\">        self</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #F07178;\">obs</span><span style=\"color: #89DDFF;\">[</span><span style=\"color: #A6ACCD;\">self</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #F07178;\">pointer</span><span style=\"color: #89DDFF;\">]</span><span style=\"color: #A6ACCD;\"> </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #A6ACCD;\"> obs</span></div><div class='line'><span style=\"color: #A6ACCD;\">        self</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #F07178;\">act</span><span style=\"color: #89DDFF;\">[</span><span style=\"color: #A6ACCD;\">self</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #F07178;\">pointer</span><span style=\"color: #89DDFF;\">]</span><span style=\"color: #A6ACCD;\"> </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #A6ACCD;\"> act</span></div><div class='line'><span style=\"color: #A6ACCD;\">        self</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #F07178;\">reward</span><span style=\"color: #89DDFF;\">[</span><span style=\"color: #A6ACCD;\">self</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #F07178;\">pointer</span><span style=\"color: #89DDFF;\">]</span><span style=\"color: #A6ACCD;\"> </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #A6ACCD;\"> reward</span></div><div class='line'><span style=\"color: #A6ACCD;\">        self</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #F07178;\">next_obs</span><span style=\"color: #89DDFF;\">[</span><span style=\"color: #A6ACCD;\">self</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #F07178;\">pointer</span><span style=\"color: #89DDFF;\">]</span><span style=\"color: #A6ACCD;\"> </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #A6ACCD;\"> next_obs</span></div><div class='line'><span style=\"color: #A6ACCD;\">        self</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #F07178;\">terminated</span><span style=\"color: #89DDFF;\">[</span><span style=\"color: #A6ACCD;\">self</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #F07178;\">pointer</span><span style=\"color: #89DDFF;\">]</span><span style=\"color: #A6ACCD;\"> </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #A6ACCD;\"> terminated</span></div><div class='line'><span style=\"color: #A6ACCD;\">        self</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #F07178;\">truncated</span><span style=\"color: #89DDFF;\">[</span><span style=\"color: #A6ACCD;\">self</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #F07178;\">pointer</span><span style=\"color: #89DDFF;\">]</span><span style=\"color: #A6ACCD;\"> </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #A6ACCD;\"> truncated</span></div><div class='line'><span style=\"color: #A6ACCD;\">        self</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #F07178;\">pointer</span><span style=\"color: #A6ACCD;\"> </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #A6ACCD;\"> </span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #A6ACCD;\">self</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #F07178;\">pointer</span><span style=\"color: #A6ACCD;\"> </span><span style=\"color: #89DDFF;\">+</span><span style=\"color: #A6ACCD;\"> </span><span style=\"color: #F78C6C;\">1</span><span style=\"color: #89DDFF;\">)</span><span style=\"color: #A6ACCD;\"> </span><span style=\"color: #89DDFF;\">%</span><span style=\"color: #A6ACCD;\"> self</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #F07178;\">buffer_size</span></div><div class='line'><span style=\"color: #A6ACCD;\">        </span><span style=\"color: #89DDFF;\">if</span><span style=\"color: #A6ACCD;\"> </span><span style=\"color: #89DDFF;\">not</span><span style=\"color: #A6ACCD;\"> self</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #F07178;\">full</span><span style=\"color: #A6ACCD;\"> </span><span style=\"color: #89DDFF;\">and</span><span style=\"color: #A6ACCD;\"> self</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #F07178;\">pointer</span><span style=\"color: #A6ACCD;\"> </span><span style=\"color: #89DDFF;\">==</span><span style=\"color: #A6ACCD;\"> </span><span style=\"color: #F78C6C;\">0</span><span style=\"color: #89DDFF;\">:</span></div><div class='line'><span style=\"color: #A6ACCD;\">            self</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #F07178;\">full</span><span style=\"color: #A6ACCD;\"> </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #A6ACCD;\"> </span><span style=\"color: #89DDFF;\">True</span></div><div class='line'>&nbsp;</div><div class='line'><span style=\"color: #A6ACCD;\">    </span><span style=\"color: #C792EA;\">def</span><span style=\"color: #A6ACCD;\"> </span><span style=\"color: #82AAFF;\">sample</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #A6ACCD;\">self</span><span style=\"color: #89DDFF;\">,</span><span style=\"color: #A6ACCD;\"> batch_size</span><span style=\"color: #89DDFF;\">:</span><span style=\"color: #A6ACCD;\"> </span><span style=\"color: #FFCB6B;\">int</span><span style=\"color: #89DDFF;\">):</span></div><div class='line'><span style=\"color: #A6ACCD;\">        </span><span style=\"color: #89DDFF;\">if</span><span style=\"color: #A6ACCD;\"> self</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #F07178;\">full</span><span style=\"color: #89DDFF;\">:</span></div><div class='line'><span style=\"color: #A6ACCD;\">            indices </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #A6ACCD;\"> np</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #F07178;\">random</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #82AAFF;\">randint</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #F78C6C;\">0</span><span style=\"color: #89DDFF;\">,</span><span style=\"color: #82AAFF;\"> </span><span style=\"color: #A6ACCD;\">self</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #F07178;\">buffer_size</span><span style=\"color: #89DDFF;\">,</span><span style=\"color: #82AAFF;\"> </span><span style=\"color: #A6ACCD;\">size</span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #82AAFF;\">batch_size</span><span style=\"color: #89DDFF;\">)</span></div><div class='line'><span style=\"color: #A6ACCD;\">        </span><span style=\"color: #89DDFF;\">else</span><span style=\"color: #89DDFF;\">:</span></div><div class='line'><span style=\"color: #A6ACCD;\">            indices </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #A6ACCD;\"> np</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #F07178;\">random</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #82AAFF;\">randint</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #F78C6C;\">0</span><span style=\"color: #89DDFF;\">,</span><span style=\"color: #82AAFF;\"> </span><span style=\"color: #A6ACCD;\">self</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #F07178;\">pointer</span><span style=\"color: #89DDFF;\">,</span><span style=\"color: #82AAFF;\"> </span><span style=\"color: #A6ACCD;\">size</span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #82AAFF;\">batch_size</span><span style=\"color: #89DDFF;\">)</span></div><div class='line'>&nbsp;</div><div class='line'><span style=\"color: #A6ACCD;\">        data </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #A6ACCD;\"> </span><span style=\"color: #89DDFF;\">{</span></div><div class='line'><span style=\"color: #A6ACCD;\">            </span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #C3E88D;\">obs</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #89DDFF;\">:</span><span style=\"color: #A6ACCD;\"> self</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #F07178;\">obs</span><span style=\"color: #89DDFF;\">[</span><span style=\"color: #F07178;\">indices</span><span style=\"color: #89DDFF;\">],</span></div><div class='line'><span style=\"color: #A6ACCD;\">            </span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #C3E88D;\">act</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #89DDFF;\">:</span><span style=\"color: #A6ACCD;\"> self</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #F07178;\">act</span><span style=\"color: #89DDFF;\">[</span><span style=\"color: #F07178;\">indices</span><span style=\"color: #89DDFF;\">],</span></div><div class='line'><span style=\"color: #A6ACCD;\">            </span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #C3E88D;\">reward</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #89DDFF;\">:</span><span style=\"color: #A6ACCD;\"> self</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #F07178;\">reward</span><span style=\"color: #89DDFF;\">[</span><span style=\"color: #F07178;\">indices</span><span style=\"color: #89DDFF;\">],</span></div><div class='line'><span style=\"color: #A6ACCD;\">            </span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #C3E88D;\">next_obs</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #89DDFF;\">:</span><span style=\"color: #A6ACCD;\"> self</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #F07178;\">next_obs</span><span style=\"color: #89DDFF;\">[</span><span style=\"color: #F07178;\">indices</span><span style=\"color: #89DDFF;\">],</span></div><div class='line'><span style=\"color: #A6ACCD;\">            </span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #C3E88D;\">terminated</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #89DDFF;\">:</span><span style=\"color: #A6ACCD;\"> self</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #F07178;\">terminated</span><span style=\"color: #89DDFF;\">[</span><span style=\"color: #F07178;\">indices</span><span style=\"color: #89DDFF;\">],</span></div><div class='line'><span style=\"color: #A6ACCD;\">            </span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #C3E88D;\">truncated</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #89DDFF;\">:</span><span style=\"color: #A6ACCD;\"> self</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #F07178;\">truncated</span><span style=\"color: #89DDFF;\">[</span><span style=\"color: #F07178;\">indices</span><span style=\"color: #89DDFF;\">]</span></div><div class='line'><span style=\"color: #A6ACCD;\">        </span><span style=\"color: #89DDFF;\">}</span></div><div class='line'><span style=\"color: #A6ACCD;\">        </span><span style=\"color: #89DDFF;\">return</span><span style=\"color: #A6ACCD;\"> data</span></div><div class='line'>&nbsp;</div><div class='line'><span style=\"color: #C792EA;\">class</span><span style=\"color: #A6ACCD;\"> </span><span style=\"color: #FFCB6B;\">QNetwork</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #FFCB6B;\">nn</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #FFCB6B;\">Module</span><span style=\"color: #89DDFF;\">):</span></div><div class='line'><span style=\"color: #A6ACCD;\">    </span><span style=\"color: #C792EA;\">def</span><span style=\"color: #A6ACCD;\"> </span><span style=\"color: #82AAFF;\">__init__</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #A6ACCD;\">self</span><span style=\"color: #89DDFF;\">):</span></div><div class='line'><span style=\"color: #A6ACCD;\">        </span><span style=\"color: #FFCB6B;\">super</span><span style=\"color: #89DDFF;\">().</span><span style=\"color: #82AAFF;\">__init__</span><span style=\"color: #89DDFF;\">()</span></div><div class='line'><span style=\"color: #A6ACCD;\">        self</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #F07178;\">network</span><span style=\"color: #A6ACCD;\"> </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #A6ACCD;\"> nn</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #82AAFF;\">Sequential</span><span style=\"color: #89DDFF;\">(</span></div><div class='line'><span style=\"color: #82AAFF;\">            nn</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #82AAFF;\">Linear</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #F78C6C;\">4</span><span style=\"color: #89DDFF;\">,</span><span style=\"color: #82AAFF;\"> </span><span style=\"color: #F78C6C;\">256</span><span style=\"color: #89DDFF;\">),</span></div><div class='line'><span style=\"color: #82AAFF;\">            nn</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #82AAFF;\">ReLU</span><span style=\"color: #89DDFF;\">(),</span></div><div class='line'><span style=\"color: #82AAFF;\">            nn</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #82AAFF;\">Linear</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #F78C6C;\">256</span><span style=\"color: #89DDFF;\">,</span><span style=\"color: #82AAFF;\"> </span><span style=\"color: #F78C6C;\">256</span><span style=\"color: #89DDFF;\">),</span></div><div class='line'><span style=\"color: #82AAFF;\">            nn</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #82AAFF;\">ReLU</span><span style=\"color: #89DDFF;\">(),</span></div><div class='line'><span style=\"color: #82AAFF;\">            nn</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #82AAFF;\">Linear</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #F78C6C;\">256</span><span style=\"color: #89DDFF;\">,</span><span style=\"color: #82AAFF;\"> </span><span style=\"color: #F78C6C;\">2</span><span style=\"color: #89DDFF;\">),</span></div><div class='line'><span style=\"color: #82AAFF;\">        </span><span style=\"color: #89DDFF;\">)</span></div><div class='line'>&nbsp;</div><div class='line'><span style=\"color: #A6ACCD;\">    </span><span style=\"color: #C792EA;\">def</span><span style=\"color: #A6ACCD;\"> </span><span style=\"color: #82AAFF;\">forward</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #A6ACCD;\">self</span><span style=\"color: #89DDFF;\">,</span><span style=\"color: #A6ACCD;\"> x</span><span style=\"color: #89DDFF;\">):</span></div><div class='line'><span style=\"color: #A6ACCD;\">        </span><span style=\"color: #89DDFF;\">return</span><span style=\"color: #A6ACCD;\"> self</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #82AAFF;\">network</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #82AAFF;\">x</span><span style=\"color: #89DDFF;\">)</span></div><div class='line'>&nbsp;</div><div class='line'><span style=\"color: #C792EA;\">def</span><span style=\"color: #A6ACCD;\"> </span><span style=\"color: #82AAFF;\">linear_schedule</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #A6ACCD;\">start_e</span><span style=\"color: #89DDFF;\">,</span><span style=\"color: #A6ACCD;\"> end_e</span><span style=\"color: #89DDFF;\">,</span><span style=\"color: #A6ACCD;\"> duration</span><span style=\"color: #89DDFF;\">,</span><span style=\"color: #A6ACCD;\"> t</span><span style=\"color: #89DDFF;\">):</span></div><div class='line'><span style=\"color: #A6ACCD;\">    </span><span style=\"color: #89DDFF;\">return</span><span style=\"color: #A6ACCD;\"> start_e </span><span style=\"color: #89DDFF;\">+</span><span style=\"color: #A6ACCD;\"> </span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #A6ACCD;\">end_e </span><span style=\"color: #89DDFF;\">-</span><span style=\"color: #A6ACCD;\"> start_e</span><span style=\"color: #89DDFF;\">)</span><span style=\"color: #A6ACCD;\"> </span><span style=\"color: #89DDFF;\">*</span><span style=\"color: #A6ACCD;\"> </span><span style=\"color: #82AAFF;\">min</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #82AAFF;\">t </span><span style=\"color: #89DDFF;\">/</span><span style=\"color: #82AAFF;\"> duration</span><span style=\"color: #89DDFF;\">,</span><span style=\"color: #82AAFF;\"> </span><span style=\"color: #F78C6C;\">1</span><span style=\"color: #89DDFF;\">)</span></div><div class='line'>&nbsp;</div><div class='line'><span style=\"color: #C792EA;\">def</span><span style=\"color: #A6ACCD;\"> </span><span style=\"color: #82AAFF;\">main</span><span style=\"color: #89DDFF;\">():</span></div><div class='line'><span style=\"color: #A6ACCD;\">    parser </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #A6ACCD;\"> argparse</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #82AAFF;\">ArgumentParser</span><span style=\"color: #89DDFF;\">()</span></div><div class='line'><span style=\"color: #A6ACCD;\">    parser</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #82AAFF;\">add_argument</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #C3E88D;\">--seed</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #89DDFF;\">,</span><span style=\"color: #82AAFF;\"> </span><span style=\"color: #A6ACCD;\">type</span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #FFCB6B;\">int</span><span style=\"color: #89DDFF;\">,</span><span style=\"color: #82AAFF;\"> </span><span style=\"color: #A6ACCD;\">default</span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #F78C6C;\">0</span><span style=\"color: #89DDFF;\">,</span></div><div class='line'><span style=\"color: #82AAFF;\">                        </span><span style=\"color: #A6ACCD;\">help</span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #C3E88D;\">random seed of the experiment</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #89DDFF;\">)</span></div><div class='line'><span style=\"color: #A6ACCD;\">    parser</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #82AAFF;\">add_argument</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #C3E88D;\">--batch_size</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #89DDFF;\">,</span><span style=\"color: #82AAFF;\"> </span><span style=\"color: #A6ACCD;\">type</span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #FFCB6B;\">int</span><span style=\"color: #89DDFF;\">,</span><span style=\"color: #82AAFF;\"> </span><span style=\"color: #A6ACCD;\">default</span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #F78C6C;\">2048</span><span style=\"color: #89DDFF;\">,</span></div><div class='line'><span style=\"color: #82AAFF;\">                        </span><span style=\"color: #A6ACCD;\">help</span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #C3E88D;\">the batch size of sample from the reply memory</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #89DDFF;\">)</span></div><div class='line'><span style=\"color: #A6ACCD;\">    parser</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #82AAFF;\">add_argument</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #C3E88D;\">--gamma</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #89DDFF;\">,</span><span style=\"color: #82AAFF;\"> </span><span style=\"color: #A6ACCD;\">type</span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #FFCB6B;\">float</span><span style=\"color: #89DDFF;\">,</span><span style=\"color: #82AAFF;\"> </span><span style=\"color: #A6ACCD;\">default</span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #F78C6C;\">0.99</span><span style=\"color: #89DDFF;\">,</span></div><div class='line'><span style=\"color: #82AAFF;\">                        </span><span style=\"color: #A6ACCD;\">help</span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #C3E88D;\">discount factor</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #89DDFF;\">)</span></div><div class='line'><span style=\"color: #A6ACCD;\">    parser</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #82AAFF;\">add_argument</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #C3E88D;\">--tau</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #89DDFF;\">,</span><span style=\"color: #82AAFF;\"> </span><span style=\"color: #A6ACCD;\">type</span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #FFCB6B;\">float</span><span style=\"color: #89DDFF;\">,</span><span style=\"color: #82AAFF;\"> </span><span style=\"color: #A6ACCD;\">default</span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #F78C6C;\">0.1</span><span style=\"color: #89DDFF;\">,</span></div><div class='line'><span style=\"color: #82AAFF;\">                        </span><span style=\"color: #A6ACCD;\">help</span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #C3E88D;\">the target network update rate</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #89DDFF;\">)</span></div><div class='line'><span style=\"color: #A6ACCD;\">    parser</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #82AAFF;\">add_argument</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #C3E88D;\">--target_network_frequency</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #89DDFF;\">,</span><span style=\"color: #82AAFF;\"> </span><span style=\"color: #A6ACCD;\">type</span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #FFCB6B;\">int</span><span style=\"color: #89DDFF;\">,</span><span style=\"color: #82AAFF;\"> </span><span style=\"color: #A6ACCD;\">default</span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #F78C6C;\">1_000</span><span style=\"color: #89DDFF;\">,</span></div><div class='line'><span style=\"color: #82AAFF;\">                        </span><span style=\"color: #A6ACCD;\">help</span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #C3E88D;\">the frequency of target network update</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #89DDFF;\">)</span></div><div class='line'><span style=\"color: #A6ACCD;\">    parser</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #82AAFF;\">add_argument</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #C3E88D;\">--start_e</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #89DDFF;\">,</span><span style=\"color: #82AAFF;\"> </span><span style=\"color: #A6ACCD;\">type</span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #FFCB6B;\">float</span><span style=\"color: #89DDFF;\">,</span><span style=\"color: #82AAFF;\"> </span><span style=\"color: #A6ACCD;\">default</span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #F78C6C;\">1.0</span><span style=\"color: #89DDFF;\">,</span></div><div class='line'><span style=\"color: #82AAFF;\">                        </span><span style=\"color: #A6ACCD;\">help</span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #C3E88D;\">starting epsilon</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #89DDFF;\">)</span></div><div class='line'><span style=\"color: #A6ACCD;\">    parser</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #82AAFF;\">add_argument</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #C3E88D;\">--end_e</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #89DDFF;\">,</span><span style=\"color: #82AAFF;\"> </span><span style=\"color: #A6ACCD;\">type</span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #FFCB6B;\">float</span><span style=\"color: #89DDFF;\">,</span><span style=\"color: #82AAFF;\"> </span><span style=\"color: #A6ACCD;\">default</span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #F78C6C;\">0.01</span><span style=\"color: #89DDFF;\">,</span></div><div class='line'><span style=\"color: #82AAFF;\">                        </span><span style=\"color: #A6ACCD;\">help</span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #C3E88D;\">ending epsilon</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #89DDFF;\">)</span></div><div class='line'><span style=\"color: #A6ACCD;\">    parser</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #82AAFF;\">add_argument</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #C3E88D;\">--exploration_fraction</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #89DDFF;\">,</span><span style=\"color: #82AAFF;\"> </span><span style=\"color: #A6ACCD;\">type</span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #FFCB6B;\">float</span><span style=\"color: #89DDFF;\">,</span><span style=\"color: #82AAFF;\"> </span><span style=\"color: #A6ACCD;\">default</span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #F78C6C;\">0.5</span><span style=\"color: #89DDFF;\">,</span></div><div class='line'><span style=\"color: #82AAFF;\">                        </span><span style=\"color: #A6ACCD;\">help</span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #C3E88D;\">the timesteps it takes to update the target network</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #89DDFF;\">)</span></div><div class='line'><span style=\"color: #A6ACCD;\">    parser</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #82AAFF;\">add_argument</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #C3E88D;\">--learning_rate</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #89DDFF;\">,</span><span style=\"color: #82AAFF;\"> </span><span style=\"color: #A6ACCD;\">type</span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #FFCB6B;\">float</span><span style=\"color: #89DDFF;\">,</span><span style=\"color: #82AAFF;\"> </span><span style=\"color: #A6ACCD;\">default</span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #F78C6C;\">1e-3</span><span style=\"color: #89DDFF;\">,</span></div><div class='line'><span style=\"color: #82AAFF;\">                        </span><span style=\"color: #A6ACCD;\">help</span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #C3E88D;\">learning rate</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #89DDFF;\">)</span></div><div class='line'><span style=\"color: #A6ACCD;\">    parser</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #82AAFF;\">add_argument</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #C3E88D;\">--total_timesteps</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #89DDFF;\">,</span><span style=\"color: #82AAFF;\"> </span><span style=\"color: #A6ACCD;\">type</span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #FFCB6B;\">int</span><span style=\"color: #89DDFF;\">,</span><span style=\"color: #82AAFF;\"> </span><span style=\"color: #A6ACCD;\">default</span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #F78C6C;\">1_000_000</span><span style=\"color: #89DDFF;\">,</span></div><div class='line'><span style=\"color: #82AAFF;\">                        </span><span style=\"color: #A6ACCD;\">help</span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #C3E88D;\">total number of timesteps</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #89DDFF;\">)</span></div><div class='line'><span style=\"color: #A6ACCD;\">    parser</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #82AAFF;\">add_argument</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #C3E88D;\">--buffer_size</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #89DDFF;\">,</span><span style=\"color: #82AAFF;\"> </span><span style=\"color: #A6ACCD;\">type</span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #FFCB6B;\">int</span><span style=\"color: #89DDFF;\">,</span><span style=\"color: #82AAFF;\"> </span><span style=\"color: #A6ACCD;\">default</span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #F78C6C;\">100_000</span><span style=\"color: #89DDFF;\">,</span></div><div class='line'><span style=\"color: #82AAFF;\">                        </span><span style=\"color: #A6ACCD;\">help</span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #C3E88D;\">buffer size</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #89DDFF;\">)</span></div><div class='line'><span style=\"color: #A6ACCD;\">    parser</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #82AAFF;\">add_argument</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #C3E88D;\">--learning_starts</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #89DDFF;\">,</span><span style=\"color: #82AAFF;\"> </span><span style=\"color: #A6ACCD;\">type</span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #FFCB6B;\">int</span><span style=\"color: #89DDFF;\">,</span><span style=\"color: #82AAFF;\"> </span><span style=\"color: #A6ACCD;\">default</span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #F78C6C;\">10_000</span><span style=\"color: #89DDFF;\">,</span></div><div class='line'><span style=\"color: #82AAFF;\">                        </span><span style=\"color: #A6ACCD;\">help</span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #C3E88D;\">timestep to start learning</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #89DDFF;\">)</span></div><div class='line'><span style=\"color: #A6ACCD;\">    parser</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #82AAFF;\">add_argument</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #C3E88D;\">--train_frequency</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #89DDFF;\">,</span><span style=\"color: #82AAFF;\"> </span><span style=\"color: #A6ACCD;\">type</span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #FFCB6B;\">int</span><span style=\"color: #89DDFF;\">,</span><span style=\"color: #82AAFF;\"> </span><span style=\"color: #A6ACCD;\">default</span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #F78C6C;\">10</span><span style=\"color: #89DDFF;\">,</span></div><div class='line'><span style=\"color: #82AAFF;\">                        </span><span style=\"color: #A6ACCD;\">help</span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #C3E88D;\">the frequency of training</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #89DDFF;\">)</span></div><div class='line'><span style=\"color: #A6ACCD;\">    parser</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #82AAFF;\">add_argument</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #C3E88D;\">--device</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #89DDFF;\">,</span><span style=\"color: #82AAFF;\"> </span><span style=\"color: #A6ACCD;\">type</span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #FFCB6B;\">str</span><span style=\"color: #89DDFF;\">,</span><span style=\"color: #82AAFF;\"> </span><span style=\"color: #A6ACCD;\">default</span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #C3E88D;\">cuda</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #82AAFF;\"> </span><span style=\"color: #89DDFF;\">if</span><span style=\"color: #82AAFF;\"> torch</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #F07178;\">cuda</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #82AAFF;\">is_available</span><span style=\"color: #89DDFF;\">()</span><span style=\"color: #82AAFF;\"> </span><span style=\"color: #89DDFF;\">else</span><span style=\"color: #82AAFF;\"> </span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #C3E88D;\">cpu</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #89DDFF;\">,</span></div><div class='line'><span style=\"color: #82AAFF;\">                        </span><span style=\"color: #A6ACCD;\">help</span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #C3E88D;\">Device to run the experiment on</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #89DDFF;\">)</span></div><div class='line'><span style=\"color: #A6ACCD;\">    args </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #A6ACCD;\"> parser</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #82AAFF;\">parse_args</span><span style=\"color: #89DDFF;\">()</span></div><div class='line'>&nbsp;</div><div class='line'><span style=\"color: #A6ACCD;\">    random</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #82AAFF;\">seed</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #82AAFF;\">args</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #F07178;\">seed</span><span style=\"color: #89DDFF;\">)</span></div><div class='line'><span style=\"color: #A6ACCD;\">    np</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #F07178;\">random</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #82AAFF;\">seed</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #82AAFF;\">args</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #F07178;\">seed</span><span style=\"color: #89DDFF;\">)</span></div><div class='line'><span style=\"color: #A6ACCD;\">    torch</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #82AAFF;\">manual_seed</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #82AAFF;\">args</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #F07178;\">seed</span><span style=\"color: #89DDFF;\">)</span></div><div class='line'><span style=\"color: #A6ACCD;\">    torch</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #F07178;\">backends</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #F07178;\">cudnn</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #F07178;\">deterministic</span><span style=\"color: #A6ACCD;\"> </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #A6ACCD;\"> </span><span style=\"color: #89DDFF;\">True</span></div><div class='line'>&nbsp;</div><div class='line'><span style=\"color: #A6ACCD;\">    device </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #A6ACCD;\"> torch</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #82AAFF;\">device</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #82AAFF;\">args</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #F07178;\">device</span><span style=\"color: #89DDFF;\">)</span></div><div class='line'><span style=\"color: #A6ACCD;\">    </span><span style=\"color: #82AAFF;\">print</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #C792EA;\">f</span><span style=\"color: #C3E88D;\">&quot;Using device: </span><span style=\"color: #82AAFF;\">{device}</span><span style=\"color: #C3E88D;\">&quot;</span><span style=\"color: #89DDFF;\">)</span></div><div class='line'>&nbsp;</div><div class='line'><span style=\"color: #A6ACCD;\">    q_network </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #A6ACCD;\"> </span><span style=\"color: #82AAFF;\">QNetwork</span><span style=\"color: #89DDFF;\">().</span><span style=\"color: #82AAFF;\">to</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #82AAFF;\">device</span><span style=\"color: #89DDFF;\">)</span></div><div class='line'><span style=\"color: #A6ACCD;\">    target_network </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #A6ACCD;\"> </span><span style=\"color: #82AAFF;\">QNetwork</span><span style=\"color: #89DDFF;\">().</span><span style=\"color: #82AAFF;\">to</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #82AAFF;\">device</span><span style=\"color: #89DDFF;\">)</span></div><div class='line'><span style=\"color: #A6ACCD;\">    target_network</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #82AAFF;\">load_state_dict</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #82AAFF;\">q_network</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #82AAFF;\">state_dict</span><span style=\"color: #89DDFF;\">())</span></div><div class='line'><span style=\"color: #A6ACCD;\">    target_network</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #82AAFF;\">eval</span><span style=\"color: #89DDFF;\">()</span></div><div class='line'>&nbsp;</div><div class='line'><span style=\"color: #A6ACCD;\">    optimizer </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #A6ACCD;\"> optim</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #82AAFF;\">Adam</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #82AAFF;\">q_network</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #82AAFF;\">parameters</span><span style=\"color: #89DDFF;\">(),</span><span style=\"color: #82AAFF;\"> </span><span style=\"color: #A6ACCD;\">lr</span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #82AAFF;\">args</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #F07178;\">learning_rate</span><span style=\"color: #89DDFF;\">)</span></div><div class='line'><span style=\"color: #A6ACCD;\">    cos_annealing_scheduler </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #A6ACCD;\"> </span><span style=\"color: #82AAFF;\">CosineAnnealingLR</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #82AAFF;\">optimizer</span><span style=\"color: #89DDFF;\">,</span><span style=\"color: #82AAFF;\"> </span><span style=\"color: #A6ACCD;\">T_max</span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #82AAFF;\">args</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #F07178;\">total_timesteps</span><span style=\"color: #89DDFF;\">,</span><span style=\"color: #82AAFF;\"> </span><span style=\"color: #A6ACCD;\">eta_min</span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #82AAFF;\">args</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #F07178;\">learning_rate</span><span style=\"color: #82AAFF;\"> </span><span style=\"color: #89DDFF;\">*</span><span style=\"color: #82AAFF;\"> </span><span style=\"color: #F78C6C;\">0.01</span><span style=\"color: #89DDFF;\">)</span></div><div class='line'>&nbsp;</div><div class='line'><span style=\"color: #A6ACCD;\">    replay_buffer </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #A6ACCD;\"> </span><span style=\"color: #82AAFF;\">ReplayBuffer</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #82AAFF;\">args</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #F07178;\">buffer_size</span><span style=\"color: #89DDFF;\">)</span></div><div class='line'>&nbsp;</div><div class='line'><span style=\"color: #A6ACCD;\">    env </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #A6ACCD;\"> aerodrome</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #82AAFF;\">make</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #C3E88D;\">cartpole-v0</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #89DDFF;\">)</span></div><div class='line'><span style=\"color: #A6ACCD;\">    obs</span><span style=\"color: #89DDFF;\">,</span><span style=\"color: #A6ACCD;\"> info </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #A6ACCD;\"> env</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #82AAFF;\">reset</span><span style=\"color: #89DDFF;\">()</span></div><div class='line'><span style=\"color: #A6ACCD;\">    obs </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #A6ACCD;\"> np</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #82AAFF;\">array</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #82AAFF;\">obs</span><span style=\"color: #89DDFF;\">,</span><span style=\"color: #82AAFF;\"> </span><span style=\"color: #A6ACCD;\">dtype</span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #82AAFF;\">np</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #F07178;\">float32</span><span style=\"color: #89DDFF;\">)</span></div><div class='line'><span style=\"color: #A6ACCD;\">    </span><span style=\"color: #82AAFF;\">print</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #82AAFF;\">obs</span><span style=\"color: #89DDFF;\">,</span><span style=\"color: #82AAFF;\"> info</span><span style=\"color: #89DDFF;\">)</span></div><div class='line'>&nbsp;</div><div class='line'><span style=\"color: #A6ACCD;\">    episode_length </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #A6ACCD;\"> </span><span style=\"color: #89DDFF;\">[]</span></div><div class='line'><span style=\"color: #A6ACCD;\">    current_step </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #A6ACCD;\"> </span><span style=\"color: #F78C6C;\">0</span></div><div class='line'><span style=\"color: #A6ACCD;\">    </span><span style=\"color: #89DDFF;\">for</span><span style=\"color: #A6ACCD;\"> step </span><span style=\"color: #89DDFF;\">in</span><span style=\"color: #A6ACCD;\"> </span><span style=\"color: #82AAFF;\">tqdm</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #82AAFF;\">range</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #82AAFF;\">args</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #F07178;\">total_timesteps</span><span style=\"color: #89DDFF;\">)):</span></div><div class='line'><span style=\"color: #A6ACCD;\">        current_step </span><span style=\"color: #89DDFF;\">+=</span><span style=\"color: #A6ACCD;\"> </span><span style=\"color: #F78C6C;\">1</span></div><div class='line'><span style=\"color: #A6ACCD;\">        epsilon </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #A6ACCD;\"> </span><span style=\"color: #82AAFF;\">linear_schedule</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #82AAFF;\">args</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #F07178;\">start_e</span><span style=\"color: #89DDFF;\">,</span><span style=\"color: #82AAFF;\"> args</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #F07178;\">end_e</span><span style=\"color: #89DDFF;\">,</span><span style=\"color: #82AAFF;\"> args</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #F07178;\">exploration_fraction</span><span style=\"color: #82AAFF;\"> </span><span style=\"color: #89DDFF;\">*</span><span style=\"color: #82AAFF;\"> args</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #F07178;\">total_timesteps</span><span style=\"color: #89DDFF;\">,</span><span style=\"color: #82AAFF;\"> step</span><span style=\"color: #89DDFF;\">)</span></div><div class='line'><span style=\"color: #A6ACCD;\">        </span><span style=\"color: #89DDFF;\">if</span><span style=\"color: #A6ACCD;\"> random</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #82AAFF;\">random</span><span style=\"color: #89DDFF;\">()</span><span style=\"color: #A6ACCD;\"> </span><span style=\"color: #89DDFF;\">&lt;</span><span style=\"color: #A6ACCD;\"> epsilon</span><span style=\"color: #89DDFF;\">:</span></div><div class='line'><span style=\"color: #A6ACCD;\">            action </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #A6ACCD;\"> random</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #82AAFF;\">randint</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #F78C6C;\">0</span><span style=\"color: #89DDFF;\">,</span><span style=\"color: #82AAFF;\"> </span><span style=\"color: #F78C6C;\">1</span><span style=\"color: #89DDFF;\">)</span></div><div class='line'><span style=\"color: #A6ACCD;\">        </span><span style=\"color: #89DDFF;\">else</span><span style=\"color: #89DDFF;\">:</span></div><div class='line'><span style=\"color: #A6ACCD;\">            </span><span style=\"color: #89DDFF;\">with</span><span style=\"color: #A6ACCD;\"> torch</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #82AAFF;\">no_grad</span><span style=\"color: #89DDFF;\">():</span></div><div class='line'><span style=\"color: #A6ACCD;\">                q_values </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #A6ACCD;\"> </span><span style=\"color: #82AAFF;\">q_network</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #82AAFF;\">torch</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #82AAFF;\">from_numpy</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #82AAFF;\">obs</span><span style=\"color: #89DDFF;\">).</span><span style=\"color: #82AAFF;\">unsqueeze</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #F78C6C;\">0</span><span style=\"color: #89DDFF;\">).</span><span style=\"color: #82AAFF;\">to</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #82AAFF;\">device</span><span style=\"color: #89DDFF;\">))</span></div><div class='line'><span style=\"color: #A6ACCD;\">                action </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #A6ACCD;\"> torch</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #82AAFF;\">argmax</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #82AAFF;\">q_values</span><span style=\"color: #89DDFF;\">,</span><span style=\"color: #82AAFF;\"> </span><span style=\"color: #A6ACCD;\">dim</span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #F78C6C;\">1</span><span style=\"color: #89DDFF;\">).</span><span style=\"color: #82AAFF;\">cpu</span><span style=\"color: #89DDFF;\">().</span><span style=\"color: #82AAFF;\">numpy</span><span style=\"color: #89DDFF;\">().</span><span style=\"color: #82AAFF;\">item</span><span style=\"color: #89DDFF;\">()</span></div><div class='line'>&nbsp;</div><div class='line'><span style=\"color: #A6ACCD;\">        next_obs</span><span style=\"color: #89DDFF;\">,</span><span style=\"color: #A6ACCD;\"> reward</span><span style=\"color: #89DDFF;\">,</span><span style=\"color: #A6ACCD;\"> terminated</span><span style=\"color: #89DDFF;\">,</span><span style=\"color: #A6ACCD;\"> truncated</span><span style=\"color: #89DDFF;\">,</span><span style=\"color: #A6ACCD;\"> info </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #A6ACCD;\"> env</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #82AAFF;\">step</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #82AAFF;\">action</span><span style=\"color: #89DDFF;\">)</span></div><div class='line'><span style=\"color: #A6ACCD;\">        next_obs </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #A6ACCD;\"> np</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #82AAFF;\">array</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #82AAFF;\">next_obs</span><span style=\"color: #89DDFF;\">,</span><span style=\"color: #82AAFF;\"> </span><span style=\"color: #A6ACCD;\">dtype</span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #82AAFF;\">np</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #F07178;\">float32</span><span style=\"color: #89DDFF;\">)</span></div><div class='line'>&nbsp;</div><div class='line'><span style=\"color: #A6ACCD;\">        real_next_obs </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #A6ACCD;\"> </span><span style=\"color: #82AAFF;\">deepcopy</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #82AAFF;\">next_obs</span><span style=\"color: #89DDFF;\">)</span></div><div class='line'><span style=\"color: #A6ACCD;\">        replay_buffer</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #82AAFF;\">push</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #82AAFF;\">obs</span><span style=\"color: #89DDFF;\">,</span><span style=\"color: #82AAFF;\"> action</span><span style=\"color: #89DDFF;\">,</span><span style=\"color: #82AAFF;\"> reward</span><span style=\"color: #89DDFF;\">,</span><span style=\"color: #82AAFF;\"> real_next_obs</span><span style=\"color: #89DDFF;\">,</span><span style=\"color: #82AAFF;\"> terminated</span><span style=\"color: #89DDFF;\">,</span><span style=\"color: #82AAFF;\"> truncated</span><span style=\"color: #89DDFF;\">)</span></div><div class='line'>&nbsp;</div><div class='line'><span style=\"color: #A6ACCD;\">        obs </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #A6ACCD;\"> next_obs</span></div><div class='line'>&nbsp;</div><div class='line'><span style=\"color: #A6ACCD;\">        </span><span style=\"color: #89DDFF;\">if</span><span style=\"color: #A6ACCD;\"> step </span><span style=\"color: #89DDFF;\">&gt;</span><span style=\"color: #A6ACCD;\"> args</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #F07178;\">learning_starts</span><span style=\"color: #89DDFF;\">:</span></div><div class='line'><span style=\"color: #A6ACCD;\">            </span><span style=\"color: #89DDFF;\">if</span><span style=\"color: #A6ACCD;\"> step </span><span style=\"color: #89DDFF;\">%</span><span style=\"color: #A6ACCD;\"> args</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #F07178;\">train_frequency</span><span style=\"color: #A6ACCD;\"> </span><span style=\"color: #89DDFF;\">==</span><span style=\"color: #A6ACCD;\"> </span><span style=\"color: #F78C6C;\">0</span><span style=\"color: #89DDFF;\">:</span></div><div class='line'><span style=\"color: #A6ACCD;\">                batch </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #A6ACCD;\"> replay_buffer</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #82AAFF;\">sample</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #82AAFF;\">args</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #F07178;\">batch_size</span><span style=\"color: #89DDFF;\">)</span></div><div class='line'><span style=\"color: #A6ACCD;\">                batch</span><span style=\"color: #89DDFF;\">[</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #C3E88D;\">obs</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #89DDFF;\">]</span><span style=\"color: #A6ACCD;\"> </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #A6ACCD;\"> torch</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #82AAFF;\">from_numpy</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #82AAFF;\">batch</span><span style=\"color: #89DDFF;\">[</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #C3E88D;\">obs</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #89DDFF;\">]).</span><span style=\"color: #82AAFF;\">to</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #82AAFF;\">device</span><span style=\"color: #89DDFF;\">)</span></div><div class='line'><span style=\"color: #A6ACCD;\">                batch</span><span style=\"color: #89DDFF;\">[</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #C3E88D;\">act</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #89DDFF;\">]</span><span style=\"color: #A6ACCD;\"> </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #A6ACCD;\"> torch</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #82AAFF;\">from_numpy</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #82AAFF;\">batch</span><span style=\"color: #89DDFF;\">[</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #C3E88D;\">act</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #89DDFF;\">]).</span><span style=\"color: #82AAFF;\">to</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #82AAFF;\">device</span><span style=\"color: #89DDFF;\">)</span></div><div class='line'><span style=\"color: #A6ACCD;\">                batch</span><span style=\"color: #89DDFF;\">[</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #C3E88D;\">reward</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #89DDFF;\">]</span><span style=\"color: #A6ACCD;\"> </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #A6ACCD;\"> torch</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #82AAFF;\">from_numpy</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #82AAFF;\">batch</span><span style=\"color: #89DDFF;\">[</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #C3E88D;\">reward</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #89DDFF;\">]).</span><span style=\"color: #82AAFF;\">to</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #82AAFF;\">device</span><span style=\"color: #89DDFF;\">)</span></div><div class='line'><span style=\"color: #A6ACCD;\">                batch</span><span style=\"color: #89DDFF;\">[</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #C3E88D;\">next_obs</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #89DDFF;\">]</span><span style=\"color: #A6ACCD;\"> </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #A6ACCD;\"> torch</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #82AAFF;\">from_numpy</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #82AAFF;\">batch</span><span style=\"color: #89DDFF;\">[</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #C3E88D;\">next_obs</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #89DDFF;\">]).</span><span style=\"color: #82AAFF;\">to</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #82AAFF;\">device</span><span style=\"color: #89DDFF;\">)</span></div><div class='line'><span style=\"color: #A6ACCD;\">                batch</span><span style=\"color: #89DDFF;\">[</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #C3E88D;\">terminated</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #89DDFF;\">]</span><span style=\"color: #A6ACCD;\"> </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #A6ACCD;\"> torch</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #82AAFF;\">from_numpy</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #82AAFF;\">batch</span><span style=\"color: #89DDFF;\">[</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #C3E88D;\">terminated</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #89DDFF;\">]).</span><span style=\"color: #82AAFF;\">to</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #82AAFF;\">device</span><span style=\"color: #89DDFF;\">)</span></div><div class='line'><span style=\"color: #A6ACCD;\">                batch</span><span style=\"color: #89DDFF;\">[</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #C3E88D;\">truncated</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #89DDFF;\">]</span><span style=\"color: #A6ACCD;\"> </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #A6ACCD;\"> torch</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #82AAFF;\">from_numpy</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #82AAFF;\">batch</span><span style=\"color: #89DDFF;\">[</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #C3E88D;\">truncated</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #89DDFF;\">]).</span><span style=\"color: #82AAFF;\">to</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #82AAFF;\">device</span><span style=\"color: #89DDFF;\">)</span></div><div class='line'>&nbsp;</div><div class='line'><span style=\"color: #A6ACCD;\">                </span><span style=\"color: #89DDFF;\">with</span><span style=\"color: #A6ACCD;\"> torch</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #82AAFF;\">no_grad</span><span style=\"color: #89DDFF;\">():</span></div><div class='line'><span style=\"color: #A6ACCD;\">                    target_max</span><span style=\"color: #89DDFF;\">,</span><span style=\"color: #A6ACCD;\"> _ </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #A6ACCD;\"> </span><span style=\"color: #82AAFF;\">target_network</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #82AAFF;\">batch</span><span style=\"color: #89DDFF;\">[</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #C3E88D;\">next_obs</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #89DDFF;\">]).</span><span style=\"color: #82AAFF;\">max</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #A6ACCD;\">dim</span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #F78C6C;\">1</span><span style=\"color: #89DDFF;\">,</span><span style=\"color: #82AAFF;\"> </span><span style=\"color: #A6ACCD;\">keepdim</span><span style=\"color: #89DDFF;\">=True)</span></div><div class='line'><span style=\"color: #A6ACCD;\">                    td_target </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #A6ACCD;\"> batch</span><span style=\"color: #89DDFF;\">[</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #C3E88D;\">reward</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #89DDFF;\">]</span><span style=\"color: #A6ACCD;\"> </span><span style=\"color: #89DDFF;\">+</span><span style=\"color: #A6ACCD;\"> args</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #F07178;\">gamma</span><span style=\"color: #A6ACCD;\"> </span><span style=\"color: #89DDFF;\">*</span><span style=\"color: #A6ACCD;\"> </span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #F78C6C;\">1</span><span style=\"color: #A6ACCD;\"> </span><span style=\"color: #89DDFF;\">-</span><span style=\"color: #A6ACCD;\"> batch</span><span style=\"color: #89DDFF;\">[</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #C3E88D;\">terminated</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #89DDFF;\">])</span><span style=\"color: #A6ACCD;\"> </span><span style=\"color: #89DDFF;\">*</span><span style=\"color: #A6ACCD;\"> target_max </span><span style=\"color: #89DDFF;\">-</span><span style=\"color: #A6ACCD;\"> </span><span style=\"color: #F78C6C;\">10.0</span><span style=\"color: #A6ACCD;\"> </span><span style=\"color: #89DDFF;\">*</span><span style=\"color: #A6ACCD;\"> batch</span><span style=\"color: #89DDFF;\">[</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #C3E88D;\">terminated</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #89DDFF;\">]</span></div><div class='line'>&nbsp;</div><div class='line'><span style=\"color: #A6ACCD;\">                old_val </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #A6ACCD;\"> </span><span style=\"color: #82AAFF;\">q_network</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #82AAFF;\">batch</span><span style=\"color: #89DDFF;\">[</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #C3E88D;\">obs</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #89DDFF;\">])</span></div><div class='line'><span style=\"color: #A6ACCD;\">                old_val </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #A6ACCD;\"> old_val</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #82AAFF;\">gather</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #F78C6C;\">1</span><span style=\"color: #89DDFF;\">,</span><span style=\"color: #82AAFF;\"> batch</span><span style=\"color: #89DDFF;\">[</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #C3E88D;\">act</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #89DDFF;\">].</span><span style=\"color: #82AAFF;\">long</span><span style=\"color: #89DDFF;\">())</span></div><div class='line'>&nbsp;</div><div class='line'><span style=\"color: #A6ACCD;\">                loss </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #A6ACCD;\"> F</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #82AAFF;\">mse_loss</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #82AAFF;\">td_target</span><span style=\"color: #89DDFF;\">,</span><span style=\"color: #82AAFF;\"> old_val</span><span style=\"color: #89DDFF;\">)</span></div><div class='line'>&nbsp;</div><div class='line'><span style=\"color: #A6ACCD;\">                optimizer</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #82AAFF;\">zero_grad</span><span style=\"color: #89DDFF;\">()</span></div><div class='line'><span style=\"color: #A6ACCD;\">                loss</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #82AAFF;\">backward</span><span style=\"color: #89DDFF;\">()</span></div><div class='line'><span style=\"color: #A6ACCD;\">                optimizer</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #82AAFF;\">step</span><span style=\"color: #89DDFF;\">()</span></div><div class='line'>&nbsp;</div><div class='line'><span style=\"color: #A6ACCD;\">            </span><span style=\"color: #89DDFF;\">if</span><span style=\"color: #A6ACCD;\"> step </span><span style=\"color: #89DDFF;\">%</span><span style=\"color: #A6ACCD;\"> args</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #F07178;\">target_network_frequency</span><span style=\"color: #A6ACCD;\"> </span><span style=\"color: #89DDFF;\">==</span><span style=\"color: #A6ACCD;\"> </span><span style=\"color: #F78C6C;\">0</span><span style=\"color: #89DDFF;\">:</span></div><div class='line'><span style=\"color: #A6ACCD;\">                </span><span style=\"color: #89DDFF;\">for</span><span style=\"color: #A6ACCD;\"> target_param</span><span style=\"color: #89DDFF;\">,</span><span style=\"color: #A6ACCD;\"> param </span><span style=\"color: #89DDFF;\">in</span><span style=\"color: #A6ACCD;\"> </span><span style=\"color: #82AAFF;\">zip</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #82AAFF;\">target_network</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #82AAFF;\">parameters</span><span style=\"color: #89DDFF;\">(),</span><span style=\"color: #82AAFF;\"> q_network</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #82AAFF;\">parameters</span><span style=\"color: #89DDFF;\">()):</span></div><div class='line'><span style=\"color: #A6ACCD;\">                    target_param</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #F07178;\">data</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #82AAFF;\">copy_</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #82AAFF;\">args</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #F07178;\">tau</span><span style=\"color: #82AAFF;\"> </span><span style=\"color: #89DDFF;\">*</span><span style=\"color: #82AAFF;\"> param</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #F07178;\">data</span><span style=\"color: #82AAFF;\"> </span><span style=\"color: #89DDFF;\">+</span><span style=\"color: #82AAFF;\"> </span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #F78C6C;\">1</span><span style=\"color: #82AAFF;\"> </span><span style=\"color: #89DDFF;\">-</span><span style=\"color: #82AAFF;\"> args</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #F07178;\">tau</span><span style=\"color: #89DDFF;\">)</span><span style=\"color: #82AAFF;\"> </span><span style=\"color: #89DDFF;\">*</span><span style=\"color: #82AAFF;\"> target_param</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #F07178;\">data</span><span style=\"color: #89DDFF;\">)</span></div><div class='line'>&nbsp;</div><div class='line'><span style=\"color: #A6ACCD;\">        cos_annealing_scheduler</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #82AAFF;\">step</span><span style=\"color: #89DDFF;\">()</span></div><div class='line'>&nbsp;</div><div class='line'><span style=\"color: #A6ACCD;\">        </span><span style=\"color: #89DDFF;\">if</span><span style=\"color: #A6ACCD;\"> terminated </span><span style=\"color: #89DDFF;\">or</span><span style=\"color: #A6ACCD;\"> truncated</span><span style=\"color: #89DDFF;\">:</span></div><div class='line'><span style=\"color: #A6ACCD;\">            obs</span><span style=\"color: #89DDFF;\">,</span><span style=\"color: #A6ACCD;\"> info </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #A6ACCD;\"> env</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #82AAFF;\">reset</span><span style=\"color: #89DDFF;\">()</span></div><div class='line'><span style=\"color: #A6ACCD;\">            obs </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #A6ACCD;\"> np</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #82AAFF;\">array</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #82AAFF;\">obs</span><span style=\"color: #89DDFF;\">,</span><span style=\"color: #82AAFF;\"> </span><span style=\"color: #A6ACCD;\">dtype</span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #82AAFF;\">np</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #F07178;\">float32</span><span style=\"color: #89DDFF;\">)</span></div><div class='line'><span style=\"color: #A6ACCD;\">            episode_length</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #82AAFF;\">append</span><span style=\"color: #89DDFF;\">((</span><span style=\"color: #82AAFF;\">step</span><span style=\"color: #89DDFF;\">,</span><span style=\"color: #82AAFF;\"> current_step</span><span style=\"color: #89DDFF;\">))</span></div><div class='line'><span style=\"color: #A6ACCD;\">            current_step </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #A6ACCD;\"> </span><span style=\"color: #F78C6C;\">0</span></div><div class='line'>&nbsp;</div><div class='line'><span style=\"color: #A6ACCD;\">    episode_length </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #A6ACCD;\"> np</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #82AAFF;\">array</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #82AAFF;\">episode_length</span><span style=\"color: #89DDFF;\">)</span></div><div class='line'><span style=\"color: #A6ACCD;\">    fig</span><span style=\"color: #89DDFF;\">,</span><span style=\"color: #A6ACCD;\"> ax </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #A6ACCD;\"> plt</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #82AAFF;\">subplots</span><span style=\"color: #89DDFF;\">()</span></div><div class='line'><span style=\"color: #A6ACCD;\">    ax</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #82AAFF;\">plot</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #82AAFF;\">episode_length</span><span style=\"color: #89DDFF;\">[:,</span><span style=\"color: #82AAFF;\"> </span><span style=\"color: #F78C6C;\">0</span><span style=\"color: #89DDFF;\">],</span><span style=\"color: #82AAFF;\"> episode_length</span><span style=\"color: #89DDFF;\">[:,</span><span style=\"color: #82AAFF;\"> </span><span style=\"color: #F78C6C;\">1</span><span style=\"color: #89DDFF;\">],</span><span style=\"color: #82AAFF;\"> </span><span style=\"color: #A6ACCD;\">alpha</span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #F78C6C;\">0.5</span><span style=\"color: #89DDFF;\">,</span><span style=\"color: #82AAFF;\"> </span><span style=\"color: #A6ACCD;\">c</span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #C3E88D;\">skyblue</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #89DDFF;\">)</span></div><div class='line'><span style=\"color: #A6ACCD;\">    moving_average </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #A6ACCD;\"> np</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #82AAFF;\">convolve</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #82AAFF;\">episode_length</span><span style=\"color: #89DDFF;\">[:,</span><span style=\"color: #82AAFF;\"> </span><span style=\"color: #F78C6C;\">1</span><span style=\"color: #89DDFF;\">],</span><span style=\"color: #82AAFF;\"> np</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #82AAFF;\">ones</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #F78C6C;\">100</span><span style=\"color: #89DDFF;\">)</span><span style=\"color: #82AAFF;\"> </span><span style=\"color: #89DDFF;\">/</span><span style=\"color: #82AAFF;\"> </span><span style=\"color: #F78C6C;\">100</span><span style=\"color: #89DDFF;\">,</span><span style=\"color: #82AAFF;\"> </span><span style=\"color: #A6ACCD;\">mode</span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #89DDFF;\">&#39;</span><span style=\"color: #C3E88D;\">valid</span><span style=\"color: #89DDFF;\">&#39;</span><span style=\"color: #89DDFF;\">)</span></div><div class='line'><span style=\"color: #A6ACCD;\">    ax</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #82AAFF;\">plot</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #82AAFF;\">episode_length</span><span style=\"color: #89DDFF;\">[</span><span style=\"color: #F78C6C;\">99</span><span style=\"color: #89DDFF;\">:,</span><span style=\"color: #82AAFF;\"> </span><span style=\"color: #F78C6C;\">0</span><span style=\"color: #89DDFF;\">],</span><span style=\"color: #82AAFF;\"> moving_average</span><span style=\"color: #89DDFF;\">,</span><span style=\"color: #82AAFF;\"> </span><span style=\"color: #A6ACCD;\">c</span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #C3E88D;\">royalblue</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #89DDFF;\">)</span></div><div class='line'><span style=\"color: #A6ACCD;\">    ax</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #82AAFF;\">set_xlabel</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #C3E88D;\">steps</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #89DDFF;\">)</span></div><div class='line'><span style=\"color: #A6ACCD;\">    ax</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #82AAFF;\">set_ylabel</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #C3E88D;\">cumulative reward</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #89DDFF;\">)</span></div><div class='line'><span style=\"color: #A6ACCD;\">    plt</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #82AAFF;\">show</span><span style=\"color: #89DDFF;\">()</span></div><div class='line'>&nbsp;</div><div class='line'><span style=\"color: #89DDFF;\">if</span><span style=\"color: #A6ACCD;\"> __name__ </span><span style=\"color: #89DDFF;\">==</span><span style=\"color: #A6ACCD;\"> </span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #C3E88D;\">__main__</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #89DDFF;\">:</span></div><div class='line'><span style=\"color: #A6ACCD;\">    </span><span style=\"color: #82AAFF;\">main</span><span style=\"color: #89DDFF;\">()</span></div>","classes":"torchlight","styles":"background-color: #292D3E; --theme-selection-background: #00000080;"}}
