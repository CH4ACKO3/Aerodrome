{"expires":1743605058.103,"value":{"highlighted":"<!-- Syntax highlighted by torchlight.dev --><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">  1</span><span style=\"color: #0991B6;\">import</span><span style=\"color: #002339;\"> random</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">  2</span><span style=\"color: #0991B6;\">import</span><span style=\"color: #002339;\"> numpy </span><span style=\"color: #0991B6;\">as</span><span style=\"color: #002339;\"> np</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">  3</span><span style=\"color: #0991B6;\">import</span><span style=\"color: #002339;\"> argparse</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">  4</span><span style=\"color: #0991B6;\">from</span><span style=\"color: #002339;\"> copy </span><span style=\"color: #0991B6;\">import</span><span style=\"color: #002339;\"> deepcopy</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">  5</span><span style=\"color: #0991B6;\">from</span><span style=\"color: #002339;\"> tqdm </span><span style=\"color: #0991B6;\">import</span><span style=\"color: #002339;\"> tqdm</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">  6</span><span style=\"color: #0991B6;\">from</span><span style=\"color: #002339;\"> matplotlib </span><span style=\"color: #0991B6;\">import</span><span style=\"color: #002339;\"> pyplot </span><span style=\"color: #0991B6;\">as</span><span style=\"color: #002339;\"> plt</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">  7</span>&nbsp;</div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">  8</span><span style=\"color: #0991B6;\">import</span><span style=\"color: #002339;\"> torch</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">  9</span><span style=\"color: #0991B6;\">import</span><span style=\"color: #002339;\"> torch.nn </span><span style=\"color: #0991B6;\">as</span><span style=\"color: #002339;\"> nn</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 10</span><span style=\"color: #0991B6;\">import</span><span style=\"color: #002339;\"> torch.nn.functional </span><span style=\"color: #0991B6;\">as</span><span style=\"color: #002339;\"> F</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 11</span><span style=\"color: #0991B6;\">import</span><span style=\"color: #002339;\"> torch.optim </span><span style=\"color: #0991B6;\">as</span><span style=\"color: #002339;\"> optim</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 12</span><span style=\"color: #0991B6;\">from</span><span style=\"color: #002339;\"> torch.optim.lr_scheduler </span><span style=\"color: #0991B6;\">import</span><span style=\"color: #002339;\"> CosineAnnealingLR</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 13</span><span style=\"color: #0991B6;\">import</span><span style=\"color: #002339;\"> aerodrome</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 14</span>&nbsp;</div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 15</span><span style=\"color: #0991B6;\">class</span><span style=\"color: #002339;\"> </span><span style=\"color: #0444AC;\">ReplayBuffer</span><span style=\"color: #002339;\">:</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 16</span><span style=\"color: #002339;\">    </span><span style=\"color: #0991B6;\">def</span><span style=\"color: #002339;\"> </span><span style=\"color: #08134A;\">__init__</span><span style=\"color: #002339;\">(</span><span style=\"color: #B1108E;\">self</span><span style=\"color: #002339;\">, </span><span style=\"color: #B1108E;\">buffer_size</span><span style=\"color: #002339;\">: </span><span style=\"color: #DC3EB7;\">int</span><span style=\"color: #002339;\">):</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 17</span><span style=\"color: #002339;\">        </span><span style=\"color: #2F86D2;\">self</span><span style=\"color: #002339;\">.buffer_size </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> buffer_size</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 18</span><span style=\"color: #002339;\">        </span><span style=\"color: #2F86D2;\">self</span><span style=\"color: #002339;\">.full </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> </span><span style=\"color: #2970C7;\">False</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 19</span><span style=\"color: #002339;\">        </span><span style=\"color: #2F86D2;\">self</span><span style=\"color: #002339;\">.pointer </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> </span><span style=\"color: #174781;\">0</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 20</span><span style=\"color: #002339;\">        </span><span style=\"color: #2F86D2;\">self</span><span style=\"color: #002339;\">.obs </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> np.zeros((buffer_size, </span><span style=\"color: #174781;\">4</span><span style=\"color: #002339;\">), </span><span style=\"color: #B1108E;\">dtype</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\">np.float32)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 21</span><span style=\"color: #002339;\">        </span><span style=\"color: #2F86D2;\">self</span><span style=\"color: #002339;\">.act </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> np.zeros((buffer_size, </span><span style=\"color: #174781;\">1</span><span style=\"color: #002339;\">), </span><span style=\"color: #B1108E;\">dtype</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\">np.float32)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 22</span><span style=\"color: #002339;\">        </span><span style=\"color: #2F86D2;\">self</span><span style=\"color: #002339;\">.reward </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> np.zeros((buffer_size, </span><span style=\"color: #174781;\">1</span><span style=\"color: #002339;\">), </span><span style=\"color: #B1108E;\">dtype</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\">np.float32)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 23</span><span style=\"color: #002339;\">        </span><span style=\"color: #2F86D2;\">self</span><span style=\"color: #002339;\">.next_obs </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> np.zeros((buffer_size, </span><span style=\"color: #174781;\">4</span><span style=\"color: #002339;\">), </span><span style=\"color: #B1108E;\">dtype</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\">np.float32)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 24</span><span style=\"color: #002339;\">        </span><span style=\"color: #2F86D2;\">self</span><span style=\"color: #002339;\">.terminated </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> np.zeros((buffer_size, </span><span style=\"color: #174781;\">1</span><span style=\"color: #002339;\">), </span><span style=\"color: #B1108E;\">dtype</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\">np.float32)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 25</span><span style=\"color: #002339;\">        </span><span style=\"color: #2F86D2;\">self</span><span style=\"color: #002339;\">.truncated </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> np.zeros((buffer_size, </span><span style=\"color: #174781;\">1</span><span style=\"color: #002339;\">), </span><span style=\"color: #B1108E;\">dtype</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\">np.float32)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 26</span>&nbsp;</div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 27</span><span style=\"color: #002339;\">    </span><span style=\"color: #0991B6;\">def</span><span style=\"color: #002339;\"> </span><span style=\"color: #B1108E;\">push</span><span style=\"color: #002339;\">(</span><span style=\"color: #B1108E;\">self</span><span style=\"color: #002339;\">, </span><span style=\"color: #B1108E;\">obs</span><span style=\"color: #002339;\">, </span><span style=\"color: #B1108E;\">act</span><span style=\"color: #002339;\">, </span><span style=\"color: #B1108E;\">reward</span><span style=\"color: #002339;\">, </span><span style=\"color: #B1108E;\">next_obs</span><span style=\"color: #002339;\">, </span><span style=\"color: #B1108E;\">terminated</span><span style=\"color: #002339;\">, </span><span style=\"color: #B1108E;\">truncated</span><span style=\"color: #002339;\">):</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 28</span><span style=\"color: #002339;\">        </span><span style=\"color: #2F86D2;\">self</span><span style=\"color: #002339;\">.obs[</span><span style=\"color: #2F86D2;\">self</span><span style=\"color: #002339;\">.pointer] </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> obs</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 29</span><span style=\"color: #002339;\">        </span><span style=\"color: #2F86D2;\">self</span><span style=\"color: #002339;\">.act[</span><span style=\"color: #2F86D2;\">self</span><span style=\"color: #002339;\">.pointer] </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> act</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 30</span><span style=\"color: #002339;\">        </span><span style=\"color: #2F86D2;\">self</span><span style=\"color: #002339;\">.reward[</span><span style=\"color: #2F86D2;\">self</span><span style=\"color: #002339;\">.pointer] </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> reward</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 31</span><span style=\"color: #002339;\">        </span><span style=\"color: #2F86D2;\">self</span><span style=\"color: #002339;\">.next_obs[</span><span style=\"color: #2F86D2;\">self</span><span style=\"color: #002339;\">.pointer] </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> next_obs</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 32</span><span style=\"color: #002339;\">        </span><span style=\"color: #2F86D2;\">self</span><span style=\"color: #002339;\">.terminated[</span><span style=\"color: #2F86D2;\">self</span><span style=\"color: #002339;\">.pointer] </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> terminated</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 33</span><span style=\"color: #002339;\">        </span><span style=\"color: #2F86D2;\">self</span><span style=\"color: #002339;\">.truncated[</span><span style=\"color: #2F86D2;\">self</span><span style=\"color: #002339;\">.pointer] </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> truncated</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 34</span><span style=\"color: #002339;\">        </span><span style=\"color: #2F86D2;\">self</span><span style=\"color: #002339;\">.pointer </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> (</span><span style=\"color: #2F86D2;\">self</span><span style=\"color: #002339;\">.pointer </span><span style=\"color: #7B30D0;\">+</span><span style=\"color: #002339;\"> </span><span style=\"color: #174781;\">1</span><span style=\"color: #002339;\">) </span><span style=\"color: #7B30D0;\">%</span><span style=\"color: #002339;\"> </span><span style=\"color: #2F86D2;\">self</span><span style=\"color: #002339;\">.buffer_size</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 35</span><span style=\"color: #002339;\">        </span><span style=\"color: #0991B6;\">if</span><span style=\"color: #002339;\"> </span><span style=\"color: #7B30D0;\">not</span><span style=\"color: #002339;\"> </span><span style=\"color: #2F86D2;\">self</span><span style=\"color: #002339;\">.full </span><span style=\"color: #7B30D0;\">and</span><span style=\"color: #002339;\"> </span><span style=\"color: #2F86D2;\">self</span><span style=\"color: #002339;\">.pointer </span><span style=\"color: #7B30D0;\">==</span><span style=\"color: #002339;\"> </span><span style=\"color: #174781;\">0</span><span style=\"color: #002339;\">:</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 36</span><span style=\"color: #002339;\">            </span><span style=\"color: #2F86D2;\">self</span><span style=\"color: #002339;\">.full </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> </span><span style=\"color: #2970C7;\">True</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 37</span>&nbsp;</div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 38</span><span style=\"color: #002339;\">    </span><span style=\"color: #0991B6;\">def</span><span style=\"color: #002339;\"> </span><span style=\"color: #B1108E;\">sample</span><span style=\"color: #002339;\">(</span><span style=\"color: #B1108E;\">self</span><span style=\"color: #002339;\">, </span><span style=\"color: #B1108E;\">batch_size</span><span style=\"color: #002339;\">: </span><span style=\"color: #DC3EB7;\">int</span><span style=\"color: #002339;\">):</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 39</span><span style=\"color: #002339;\">        </span><span style=\"color: #0991B6;\">if</span><span style=\"color: #002339;\"> </span><span style=\"color: #2F86D2;\">self</span><span style=\"color: #002339;\">.full:</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 40</span><span style=\"color: #002339;\">            indices </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> np.random.randint(</span><span style=\"color: #174781;\">0</span><span style=\"color: #002339;\">, </span><span style=\"color: #2F86D2;\">self</span><span style=\"color: #002339;\">.buffer_size, </span><span style=\"color: #B1108E;\">size</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\">batch_size)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 41</span><span style=\"color: #002339;\">        </span><span style=\"color: #0991B6;\">else</span><span style=\"color: #002339;\">:</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 42</span><span style=\"color: #002339;\">            indices </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> np.random.randint(</span><span style=\"color: #174781;\">0</span><span style=\"color: #002339;\">, </span><span style=\"color: #2F86D2;\">self</span><span style=\"color: #002339;\">.pointer, </span><span style=\"color: #B1108E;\">size</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\">batch_size)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 43</span>&nbsp;</div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 44</span><span style=\"color: #002339;\">        data </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> {</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 45</span><span style=\"color: #002339;\">            </span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">obs</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">: </span><span style=\"color: #2F86D2;\">self</span><span style=\"color: #002339;\">.obs[indices],</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 46</span><span style=\"color: #002339;\">            </span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">act</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">: </span><span style=\"color: #2F86D2;\">self</span><span style=\"color: #002339;\">.act[indices],</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 47</span><span style=\"color: #002339;\">            </span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">reward</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">: </span><span style=\"color: #2F86D2;\">self</span><span style=\"color: #002339;\">.reward[indices],</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 48</span><span style=\"color: #002339;\">            </span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">next_obs</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">: </span><span style=\"color: #2F86D2;\">self</span><span style=\"color: #002339;\">.next_obs[indices],</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 49</span><span style=\"color: #002339;\">            </span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">terminated</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">: </span><span style=\"color: #2F86D2;\">self</span><span style=\"color: #002339;\">.terminated[indices],</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 50</span><span style=\"color: #002339;\">            </span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">truncated</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">: </span><span style=\"color: #2F86D2;\">self</span><span style=\"color: #002339;\">.truncated[indices]</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 51</span><span style=\"color: #002339;\">        }</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 52</span><span style=\"color: #002339;\">        </span><span style=\"color: #0991B6;\">return</span><span style=\"color: #002339;\"> data</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 53</span>&nbsp;</div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 54</span><span style=\"color: #0991B6;\">class</span><span style=\"color: #002339;\"> </span><span style=\"color: #0444AC;\">QNetwork</span><span style=\"color: #002339;\">(</span><span style=\"color: #B02767;\">nn</span><span style=\"color: #002339;\">.</span><span style=\"color: #B02767;\">Module</span><span style=\"color: #002339;\">):</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 55</span><span style=\"color: #002339;\">    </span><span style=\"color: #0991B6;\">def</span><span style=\"color: #002339;\"> </span><span style=\"color: #08134A;\">__init__</span><span style=\"color: #002339;\">(</span><span style=\"color: #B1108E;\">self</span><span style=\"color: #002339;\">):</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 56</span><span style=\"color: #002339;\">        </span><span style=\"color: #DC3EB7;\">super</span><span style=\"color: #002339;\">().</span><span style=\"color: #08134A;\">__init__</span><span style=\"color: #002339;\">()</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 57</span><span style=\"color: #002339;\">        </span><span style=\"color: #2F86D2;\">self</span><span style=\"color: #002339;\">.network </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> nn.Sequential(</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 58</span><span style=\"color: #002339;\">            nn.Linear(</span><span style=\"color: #174781;\">4</span><span style=\"color: #002339;\">, </span><span style=\"color: #174781;\">256</span><span style=\"color: #002339;\">),</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 59</span><span style=\"color: #002339;\">            nn.ReLU(),</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 60</span><span style=\"color: #002339;\">            nn.Linear(</span><span style=\"color: #174781;\">256</span><span style=\"color: #002339;\">, </span><span style=\"color: #174781;\">256</span><span style=\"color: #002339;\">),</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 61</span><span style=\"color: #002339;\">            nn.ReLU(),</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 62</span><span style=\"color: #002339;\">            nn.Linear(</span><span style=\"color: #174781;\">256</span><span style=\"color: #002339;\">, </span><span style=\"color: #174781;\">2</span><span style=\"color: #002339;\">),</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 63</span><span style=\"color: #002339;\">        )</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 64</span>&nbsp;</div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 65</span><span style=\"color: #002339;\">    </span><span style=\"color: #0991B6;\">def</span><span style=\"color: #002339;\"> </span><span style=\"color: #B1108E;\">forward</span><span style=\"color: #002339;\">(</span><span style=\"color: #B1108E;\">self</span><span style=\"color: #002339;\">, </span><span style=\"color: #B1108E;\">x</span><span style=\"color: #002339;\">):</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 66</span><span style=\"color: #002339;\">        </span><span style=\"color: #0991B6;\">return</span><span style=\"color: #002339;\"> </span><span style=\"color: #2F86D2;\">self</span><span style=\"color: #002339;\">.network(x)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 67</span>&nbsp;</div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 68</span><span style=\"color: #0991B6;\">def</span><span style=\"color: #002339;\"> </span><span style=\"color: #B1108E;\">linear_schedule</span><span style=\"color: #002339;\">(</span><span style=\"color: #B1108E;\">start_e</span><span style=\"color: #002339;\">, </span><span style=\"color: #B1108E;\">end_e</span><span style=\"color: #002339;\">, </span><span style=\"color: #B1108E;\">duration</span><span style=\"color: #002339;\">, </span><span style=\"color: #B1108E;\">t</span><span style=\"color: #002339;\">):</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 69</span><span style=\"color: #002339;\">    </span><span style=\"color: #0991B6;\">return</span><span style=\"color: #002339;\"> start_e </span><span style=\"color: #7B30D0;\">+</span><span style=\"color: #002339;\"> (end_e </span><span style=\"color: #7B30D0;\">-</span><span style=\"color: #002339;\"> start_e) </span><span style=\"color: #7B30D0;\">*</span><span style=\"color: #002339;\"> </span><span style=\"color: #08134A;\">min</span><span style=\"color: #002339;\">(t </span><span style=\"color: #7B30D0;\">/</span><span style=\"color: #002339;\"> duration, </span><span style=\"color: #174781;\">1</span><span style=\"color: #002339;\">)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 70</span>&nbsp;</div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 71</span><span style=\"color: #0991B6;\">def</span><span style=\"color: #002339;\"> </span><span style=\"color: #B1108E;\">main</span><span style=\"color: #002339;\">():</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 72</span><span style=\"color: #002339;\">    parser </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> argparse.ArgumentParser()</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 73</span><span style=\"color: #002339;\">    parser.add_argument(</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">--seed</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">, </span><span style=\"color: #B1108E;\">type</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #DC3EB7;\">int</span><span style=\"color: #002339;\">, </span><span style=\"color: #B1108E;\">default</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #174781;\">0</span><span style=\"color: #002339;\">,</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 74</span><span style=\"color: #002339;\">                        </span><span style=\"color: #B1108E;\">help</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">random seed of the experiment</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 75</span><span style=\"color: #002339;\">    parser.add_argument(</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">--batch_size</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">, </span><span style=\"color: #B1108E;\">type</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #DC3EB7;\">int</span><span style=\"color: #002339;\">, </span><span style=\"color: #B1108E;\">default</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #174781;\">2048</span><span style=\"color: #002339;\">,</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 76</span><span style=\"color: #002339;\">                        </span><span style=\"color: #B1108E;\">help</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">the batch size of sample from the reply memory</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 77</span><span style=\"color: #002339;\">    parser.add_argument(</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">--gamma</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">, </span><span style=\"color: #B1108E;\">type</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #DC3EB7;\">float</span><span style=\"color: #002339;\">, </span><span style=\"color: #B1108E;\">default</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #174781;\">0.99</span><span style=\"color: #002339;\">,</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 78</span><span style=\"color: #002339;\">                        </span><span style=\"color: #B1108E;\">help</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">discount factor</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 79</span><span style=\"color: #002339;\">    parser.add_argument(</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">--tau</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">, </span><span style=\"color: #B1108E;\">type</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #DC3EB7;\">float</span><span style=\"color: #002339;\">, </span><span style=\"color: #B1108E;\">default</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #174781;\">0.1</span><span style=\"color: #002339;\">,</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 80</span><span style=\"color: #002339;\">                        </span><span style=\"color: #B1108E;\">help</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">the target network update rate</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 81</span><span style=\"color: #002339;\">    parser.add_argument(</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">--target_network_frequency</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">, </span><span style=\"color: #B1108E;\">type</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #DC3EB7;\">int</span><span style=\"color: #002339;\">, </span><span style=\"color: #B1108E;\">default</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #174781;\">1_000</span><span style=\"color: #002339;\">,</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 82</span><span style=\"color: #002339;\">                        </span><span style=\"color: #B1108E;\">help</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">the frequency of target network update</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 83</span><span style=\"color: #002339;\">    parser.add_argument(</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">--start_e</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">, </span><span style=\"color: #B1108E;\">type</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #DC3EB7;\">float</span><span style=\"color: #002339;\">, </span><span style=\"color: #B1108E;\">default</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #174781;\">1.0</span><span style=\"color: #002339;\">,</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 84</span><span style=\"color: #002339;\">                        </span><span style=\"color: #B1108E;\">help</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">starting epsilon</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 85</span><span style=\"color: #002339;\">    parser.add_argument(</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">--end_e</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">, </span><span style=\"color: #B1108E;\">type</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #DC3EB7;\">float</span><span style=\"color: #002339;\">, </span><span style=\"color: #B1108E;\">default</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #174781;\">0.01</span><span style=\"color: #002339;\">,</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 86</span><span style=\"color: #002339;\">                        </span><span style=\"color: #B1108E;\">help</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">ending epsilon</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 87</span><span style=\"color: #002339;\">    parser.add_argument(</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">--exploration_fraction</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">, </span><span style=\"color: #B1108E;\">type</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #DC3EB7;\">float</span><span style=\"color: #002339;\">, </span><span style=\"color: #B1108E;\">default</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #174781;\">0.5</span><span style=\"color: #002339;\">,</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 88</span><span style=\"color: #002339;\">                        </span><span style=\"color: #B1108E;\">help</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">the timesteps it takes to update the target network</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 89</span><span style=\"color: #002339;\">    parser.add_argument(</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">--learning_rate</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">, </span><span style=\"color: #B1108E;\">type</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #DC3EB7;\">float</span><span style=\"color: #002339;\">, </span><span style=\"color: #B1108E;\">default</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #174781;\">1e-3</span><span style=\"color: #002339;\">,</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 90</span><span style=\"color: #002339;\">                        </span><span style=\"color: #B1108E;\">help</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">learning rate</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 91</span><span style=\"color: #002339;\">    parser.add_argument(</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">--total_timesteps</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">, </span><span style=\"color: #B1108E;\">type</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #DC3EB7;\">int</span><span style=\"color: #002339;\">, </span><span style=\"color: #B1108E;\">default</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #174781;\">1_000_000</span><span style=\"color: #002339;\">,</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 92</span><span style=\"color: #002339;\">                        </span><span style=\"color: #B1108E;\">help</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">total number of timesteps</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 93</span><span style=\"color: #002339;\">    parser.add_argument(</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">--buffer_size</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">, </span><span style=\"color: #B1108E;\">type</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #DC3EB7;\">int</span><span style=\"color: #002339;\">, </span><span style=\"color: #B1108E;\">default</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #174781;\">100_000</span><span style=\"color: #002339;\">,</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 94</span><span style=\"color: #002339;\">                        </span><span style=\"color: #B1108E;\">help</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">buffer size</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 95</span><span style=\"color: #002339;\">    parser.add_argument(</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">--learning_starts</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">, </span><span style=\"color: #B1108E;\">type</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #DC3EB7;\">int</span><span style=\"color: #002339;\">, </span><span style=\"color: #B1108E;\">default</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #174781;\">10_000</span><span style=\"color: #002339;\">,</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 96</span><span style=\"color: #002339;\">                        </span><span style=\"color: #B1108E;\">help</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">timestep to start learning</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 97</span><span style=\"color: #002339;\">    parser.add_argument(</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">--train_frequency</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">, </span><span style=\"color: #B1108E;\">type</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #DC3EB7;\">int</span><span style=\"color: #002339;\">, </span><span style=\"color: #B1108E;\">default</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #174781;\">10</span><span style=\"color: #002339;\">,</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 98</span><span style=\"color: #002339;\">                        </span><span style=\"color: #B1108E;\">help</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">the frequency of training</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 99</span><span style=\"color: #002339;\">    parser.add_argument(</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">--device</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">, </span><span style=\"color: #B1108E;\">type</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #DC3EB7;\">str</span><span style=\"color: #002339;\">, </span><span style=\"color: #B1108E;\">default</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">cuda</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\"> </span><span style=\"color: #0991B6;\">if</span><span style=\"color: #002339;\"> torch.cuda.is_available() </span><span style=\"color: #0991B6;\">else</span><span style=\"color: #002339;\"> </span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">cpu</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">,</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">100</span><span style=\"color: #002339;\">                        </span><span style=\"color: #B1108E;\">help</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">Device to run the experiment on</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">101</span><span style=\"color: #002339;\">    args </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> parser.parse_args()</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">102</span>&nbsp;</div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">103</span><span style=\"color: #002339;\">    random.seed(args.seed)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">104</span><span style=\"color: #002339;\">    np.random.seed(args.seed)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">105</span><span style=\"color: #002339;\">    torch.manual_seed(args.seed)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">106</span><span style=\"color: #002339;\">    torch.backends.cudnn.deterministic </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> </span><span style=\"color: #2970C7;\">True</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">107</span>&nbsp;</div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">108</span><span style=\"color: #002339;\">    device </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> torch.device(args.device)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">109</span><span style=\"color: #002339;\">    </span><span style=\"color: #08134A;\">print</span><span style=\"color: #002339;\">(</span><span style=\"color: #0991B6;\">f</span><span style=\"color: #A44185;\">&quot;Using device: </span><span style=\"color: #2970C7;\">{</span><span style=\"color: #002339;\">device</span><span style=\"color: #2970C7;\">}</span><span style=\"color: #A44185;\">&quot;</span><span style=\"color: #002339;\">)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">110</span>&nbsp;</div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">111</span><span style=\"color: #002339;\">    q_network </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> QNetwork().to(device)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">112</span><span style=\"color: #002339;\">    target_network </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> QNetwork().to(device)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">113</span><span style=\"color: #002339;\">    target_network.load_state_dict(q_network.state_dict())</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">114</span><span style=\"color: #002339;\">    target_network.eval()</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">115</span>&nbsp;</div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">116</span><span style=\"color: #002339;\">    optimizer </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> optim.Adam(q_network.parameters(), </span><span style=\"color: #B1108E;\">lr</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\">args.learning_rate)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">117</span><span style=\"color: #002339;\">    cos_annealing_scheduler </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> CosineAnnealingLR(optimizer, </span><span style=\"color: #B1108E;\">T_max</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\">args.total_timesteps, </span><span style=\"color: #B1108E;\">eta_min</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\">args.learning_rate </span><span style=\"color: #7B30D0;\">*</span><span style=\"color: #002339;\"> </span><span style=\"color: #174781;\">0.01</span><span style=\"color: #002339;\">)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">118</span>&nbsp;</div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">119</span><span style=\"color: #002339;\">    replay_buffer </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> ReplayBuffer(args.buffer_size)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">120</span>&nbsp;</div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">121</span><span style=\"color: #002339;\">    env </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> aerodrome.make(</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">cartpole-v0</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">122</span><span style=\"color: #002339;\">    obs, info </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> env.reset()</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">123</span><span style=\"color: #002339;\">    obs </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> np.array(obs, </span><span style=\"color: #B1108E;\">dtype</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\">np.float32)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">124</span><span style=\"color: #002339;\">    </span><span style=\"color: #08134A;\">print</span><span style=\"color: #002339;\">(obs, info)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">125</span>&nbsp;</div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">126</span><span style=\"color: #002339;\">    episode_length </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> []</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">127</span><span style=\"color: #002339;\">    current_step </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> </span><span style=\"color: #174781;\">0</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">128</span><span style=\"color: #002339;\">    </span><span style=\"color: #0991B6;\">for</span><span style=\"color: #002339;\"> step </span><span style=\"color: #0991B6;\">in</span><span style=\"color: #002339;\"> tqdm(</span><span style=\"color: #08134A;\">range</span><span style=\"color: #002339;\">(args.total_timesteps)):</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">129</span><span style=\"color: #002339;\">        current_step </span><span style=\"color: #7B30D0;\">+=</span><span style=\"color: #002339;\"> </span><span style=\"color: #174781;\">1</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">130</span><span style=\"color: #002339;\">        epsilon </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> linear_schedule(args.start_e, args.end_e, args.exploration_fraction </span><span style=\"color: #7B30D0;\">*</span><span style=\"color: #002339;\"> args.total_timesteps, step)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">131</span><span style=\"color: #002339;\">        </span><span style=\"color: #0991B6;\">if</span><span style=\"color: #002339;\"> random.random() </span><span style=\"color: #7B30D0;\">&lt;</span><span style=\"color: #002339;\"> epsilon:</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">132</span><span style=\"color: #002339;\">            action </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> random.randint(</span><span style=\"color: #174781;\">0</span><span style=\"color: #002339;\">, </span><span style=\"color: #174781;\">1</span><span style=\"color: #002339;\">)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">133</span><span style=\"color: #002339;\">        </span><span style=\"color: #0991B6;\">else</span><span style=\"color: #002339;\">:</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">134</span><span style=\"color: #002339;\">            </span><span style=\"color: #0991B6;\">with</span><span style=\"color: #002339;\"> torch.no_grad():</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">135</span><span style=\"color: #002339;\">                q_values </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> q_network(torch.from_numpy(obs).unsqueeze(</span><span style=\"color: #174781;\">0</span><span style=\"color: #002339;\">).to(device))</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">136</span><span style=\"color: #002339;\">                action </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> torch.argmax(q_values, </span><span style=\"color: #B1108E;\">dim</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #174781;\">1</span><span style=\"color: #002339;\">).cpu().numpy().item()</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">137</span>&nbsp;</div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">138</span><span style=\"color: #002339;\">        next_obs, reward, terminated, truncated, info </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> env.step(action)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">139</span><span style=\"color: #002339;\">        next_obs </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> np.array(next_obs, </span><span style=\"color: #B1108E;\">dtype</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\">np.float32)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">140</span>&nbsp;</div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">141</span><span style=\"color: #002339;\">        real_next_obs </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> deepcopy(next_obs)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">142</span><span style=\"color: #002339;\">        replay_buffer.push(obs, action, reward, real_next_obs, terminated, truncated)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">143</span>&nbsp;</div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">144</span><span style=\"color: #002339;\">        obs </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> next_obs</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">145</span>&nbsp;</div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">146</span><span style=\"color: #002339;\">        </span><span style=\"color: #0991B6;\">if</span><span style=\"color: #002339;\"> step </span><span style=\"color: #7B30D0;\">&gt;</span><span style=\"color: #002339;\"> args.learning_starts:</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">147</span><span style=\"color: #002339;\">            </span><span style=\"color: #0991B6;\">if</span><span style=\"color: #002339;\"> step </span><span style=\"color: #7B30D0;\">%</span><span style=\"color: #002339;\"> args.train_frequency </span><span style=\"color: #7B30D0;\">==</span><span style=\"color: #002339;\"> </span><span style=\"color: #174781;\">0</span><span style=\"color: #002339;\">:</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">148</span><span style=\"color: #002339;\">                batch </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> replay_buffer.sample(args.batch_size)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">149</span><span style=\"color: #002339;\">                batch[</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">obs</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">] </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> torch.from_numpy(batch[</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">obs</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">]).to(device)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">150</span><span style=\"color: #002339;\">                batch[</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">act</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">] </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> torch.from_numpy(batch[</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">act</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">]).to(device)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">151</span><span style=\"color: #002339;\">                batch[</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">reward</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">] </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> torch.from_numpy(batch[</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">reward</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">]).to(device)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">152</span><span style=\"color: #002339;\">                batch[</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">next_obs</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">] </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> torch.from_numpy(batch[</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">next_obs</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">]).to(device)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">153</span><span style=\"color: #002339;\">                batch[</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">terminated</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">] </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> torch.from_numpy(batch[</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">terminated</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">]).to(device)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">154</span><span style=\"color: #002339;\">                batch[</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">truncated</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">] </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> torch.from_numpy(batch[</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">truncated</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">]).to(device)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">155</span>&nbsp;</div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">156</span><span style=\"color: #002339;\">                </span><span style=\"color: #0991B6;\">with</span><span style=\"color: #002339;\"> torch.no_grad():</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">157</span><span style=\"color: #002339;\">                    target_max, _ </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> target_network(batch[</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">next_obs</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">]).max(</span><span style=\"color: #B1108E;\">dim</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #174781;\">1</span><span style=\"color: #002339;\">, </span><span style=\"color: #B1108E;\">keepdim</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #2970C7;\">True</span><span style=\"color: #002339;\">)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">158</span><span style=\"color: #002339;\">                    td_target </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> batch[</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">reward</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">] </span><span style=\"color: #7B30D0;\">+</span><span style=\"color: #002339;\"> args.gamma </span><span style=\"color: #7B30D0;\">*</span><span style=\"color: #002339;\"> (</span><span style=\"color: #174781;\">1</span><span style=\"color: #002339;\"> </span><span style=\"color: #7B30D0;\">-</span><span style=\"color: #002339;\"> batch[</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">terminated</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">]) </span><span style=\"color: #7B30D0;\">*</span><span style=\"color: #002339;\"> target_max </span><span style=\"color: #7B30D0;\">-</span><span style=\"color: #002339;\"> </span><span style=\"color: #174781;\">10.0</span><span style=\"color: #002339;\"> </span><span style=\"color: #7B30D0;\">*</span><span style=\"color: #002339;\"> batch[</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">terminated</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">]</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">159</span>&nbsp;</div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">160</span><span style=\"color: #002339;\">                old_val </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> q_network(batch[</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">obs</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">])</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">161</span><span style=\"color: #002339;\">                old_val </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> old_val.gather(</span><span style=\"color: #174781;\">1</span><span style=\"color: #002339;\">, batch[</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">act</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">].long())</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">162</span>&nbsp;</div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">163</span><span style=\"color: #002339;\">                loss </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> F.mse_loss(td_target, old_val)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">164</span>&nbsp;</div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">165</span><span style=\"color: #002339;\">                optimizer.zero_grad()</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">166</span><span style=\"color: #002339;\">                loss.backward()</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">167</span><span style=\"color: #002339;\">                optimizer.step()</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">168</span>&nbsp;</div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">169</span><span style=\"color: #002339;\">            </span><span style=\"color: #0991B6;\">if</span><span style=\"color: #002339;\"> step </span><span style=\"color: #7B30D0;\">%</span><span style=\"color: #002339;\"> args.target_network_frequency </span><span style=\"color: #7B30D0;\">==</span><span style=\"color: #002339;\"> </span><span style=\"color: #174781;\">0</span><span style=\"color: #002339;\">:</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">170</span><span style=\"color: #002339;\">                </span><span style=\"color: #0991B6;\">for</span><span style=\"color: #002339;\"> target_param, param </span><span style=\"color: #0991B6;\">in</span><span style=\"color: #002339;\"> </span><span style=\"color: #08134A;\">zip</span><span style=\"color: #002339;\">(target_network.parameters(), q_network.parameters()):</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">171</span><span style=\"color: #002339;\">                    target_param.data.copy_(args.tau </span><span style=\"color: #7B30D0;\">*</span><span style=\"color: #002339;\"> param.data </span><span style=\"color: #7B30D0;\">+</span><span style=\"color: #002339;\"> (</span><span style=\"color: #174781;\">1</span><span style=\"color: #002339;\"> </span><span style=\"color: #7B30D0;\">-</span><span style=\"color: #002339;\"> args.tau) </span><span style=\"color: #7B30D0;\">*</span><span style=\"color: #002339;\"> target_param.data)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">172</span>&nbsp;</div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">173</span><span style=\"color: #002339;\">        cos_annealing_scheduler.step()</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">174</span>&nbsp;</div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">175</span><span style=\"color: #002339;\">        </span><span style=\"color: #0991B6;\">if</span><span style=\"color: #002339;\"> terminated </span><span style=\"color: #7B30D0;\">or</span><span style=\"color: #002339;\"> truncated:</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">176</span><span style=\"color: #002339;\">            obs, info </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> env.reset()</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">177</span><span style=\"color: #002339;\">            obs </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> np.array(obs, </span><span style=\"color: #B1108E;\">dtype</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\">np.float32)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">178</span><span style=\"color: #002339;\">            episode_length.append((step, current_step))</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">179</span><span style=\"color: #002339;\">            current_step </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> </span><span style=\"color: #174781;\">0</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">180</span>&nbsp;</div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">181</span><span style=\"color: #002339;\">    episode_length </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> np.array(episode_length)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">182</span><span style=\"color: #002339;\">    fig, ax </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> plt.subplots()</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">183</span><span style=\"color: #002339;\">    ax.plot(episode_length[:, </span><span style=\"color: #174781;\">0</span><span style=\"color: #002339;\">], episode_length[:, </span><span style=\"color: #174781;\">1</span><span style=\"color: #002339;\">], </span><span style=\"color: #B1108E;\">alpha</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #174781;\">0.5</span><span style=\"color: #002339;\">, </span><span style=\"color: #B1108E;\">c</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">skyblue</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">184</span><span style=\"color: #002339;\">    moving_average </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> np.convolve(episode_length[:, </span><span style=\"color: #174781;\">1</span><span style=\"color: #002339;\">], np.ones(</span><span style=\"color: #174781;\">100</span><span style=\"color: #002339;\">) </span><span style=\"color: #7B30D0;\">/</span><span style=\"color: #002339;\"> </span><span style=\"color: #174781;\">100</span><span style=\"color: #002339;\">, </span><span style=\"color: #B1108E;\">mode</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #D86DB6;\">&#39;</span><span style=\"color: #A44185;\">valid</span><span style=\"color: #D86DB6;\">&#39;</span><span style=\"color: #002339;\">)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">185</span><span style=\"color: #002339;\">    ax.plot(episode_length[</span><span style=\"color: #174781;\">99</span><span style=\"color: #002339;\">:, </span><span style=\"color: #174781;\">0</span><span style=\"color: #002339;\">], moving_average, </span><span style=\"color: #B1108E;\">c</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">royalblue</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">186</span><span style=\"color: #002339;\">    ax.set_xlabel(</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">steps</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">187</span><span style=\"color: #002339;\">    ax.set_ylabel(</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">cumulative reward</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">188</span><span style=\"color: #002339;\">    plt.show()</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">189</span>&nbsp;</div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">190</span><span style=\"color: #0991B6;\">if</span><span style=\"color: #002339;\"> __name__ </span><span style=\"color: #7B30D0;\">==</span><span style=\"color: #002339;\"> </span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">__main__</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">:</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">191</span><span style=\"color: #002339;\">    main()</span></div>","classes":"torchlight","styles":"background-color: #FFFFFF; --theme-selection-background: #4373c2;"}}
