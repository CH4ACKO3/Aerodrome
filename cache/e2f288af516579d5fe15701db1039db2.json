{"expires":1743604764.284,"value":{"highlighted":"<!-- Syntax highlighted by torchlight.dev --><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 1</span><span style=\"color: #D73A49;\">class</span><span style=\"color: #24292E;\"> </span><span style=\"color: #6F42C1;\">Space3D</span><span style=\"color: #24292E;\"> : </span><span style=\"color: #D73A49;\">public</span><span style=\"color: #24292E;\"> </span><span style=\"color: #6F42C1;\">BaseEnv</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 2</span><span style=\"color: #24292E;\">{</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 3</span><span style=\"color: #D73A49;\">private:</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 4</span><span style=\"color: #24292E;\">    </span><span style=\"color: #D73A49;\">double</span><span style=\"color: #24292E;\"> tau;</span><span style=\"color: #6A737D;\"> // 每次积分的时间长度，tau = dt / integrate_steps</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 5</span><span style=\"color: #24292E;\">    </span><span style=\"color: #D73A49;\">double</span><span style=\"color: #24292E;\"> dt;</span><span style=\"color: #6A737D;\"> // 每次被调用 step() 方法时，步进的时间长度</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 6</span><span style=\"color: #24292E;\">    </span><span style=\"color: #D73A49;\">double</span><span style=\"color: #24292E;\"> eps;</span><span style=\"color: #6A737D;\"> // 容差，可以用于检查动力学积分的精度，未实装</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 7</span><span style=\"color: #24292E;\">    </span><span style=\"color: #D73A49;\">int</span><span style=\"color: #24292E;\"> integrate_steps;</span><span style=\"color: #6A737D;\"> // 每次被调用 step() 方法时，调用环境内对象的 step() 方法的次数（将每次步进划分为几次积分）</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 8</span>&nbsp;</div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 9</span><span style=\"color: #D73A49;\">public:</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">10</span><span style=\"color: #24292E;\">    </span><span style=\"color: #6F42C1;\">std</span><span style=\"color: #24292E;\">::vector</span><span style=\"color: #D73A49;\">&lt;</span><span style=\"color: #6F42C1;\">std</span><span style=\"color: #24292E;\">::shared_ptr</span><span style=\"color: #D73A49;\">&lt;</span><span style=\"color: #24292E;\">Object3D</span><span style=\"color: #D73A49;\">&gt;&gt;</span><span style=\"color: #24292E;\"> objects;</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">11</span>&nbsp;</div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">12</span><span style=\"color: #24292E;\">    </span><span style=\"color: #6F42C1;\">Space3D</span><span style=\"color: #24292E;\">(</span><span style=\"color: #D73A49;\">double</span><span style=\"color: #24292E;\"> </span><span style=\"color: #E36209;\">tau</span><span style=\"color: #24292E;\">, </span><span style=\"color: #D73A49;\">double</span><span style=\"color: #24292E;\"> </span><span style=\"color: #E36209;\">eps</span><span style=\"color: #24292E;\">, </span><span style=\"color: #D73A49;\">int</span><span style=\"color: #24292E;\"> </span><span style=\"color: #E36209;\">integrate_steps</span><span style=\"color: #24292E;\">)</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">13</span><span style=\"color: #24292E;\">        : </span><span style=\"color: #6F42C1;\">tau</span><span style=\"color: #24292E;\">(tau), </span><span style=\"color: #6F42C1;\">eps</span><span style=\"color: #24292E;\">(eps), </span><span style=\"color: #6F42C1;\">integrate_steps</span><span style=\"color: #24292E;\">(integrate_steps)</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">14</span><span style=\"color: #24292E;\">    {</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">15</span><span style=\"color: #24292E;\">        dt </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> tau </span><span style=\"color: #D73A49;\">/</span><span style=\"color: #24292E;\"> integrate_steps;</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">16</span><span style=\"color: #24292E;\">    }</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">17</span>&nbsp;</div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">18</span><span style=\"color: #24292E;\">    </span><span style=\"color: #6F42C1;\">py</span><span style=\"color: #24292E;\">::</span><span style=\"color: #6F42C1;\">object</span><span style=\"color: #24292E;\"> </span><span style=\"color: #6F42C1;\">reset</span><span style=\"color: #24292E;\">()</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">19</span><span style=\"color: #24292E;\">    {</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">20</span><span style=\"color: #24292E;\">        </span><span style=\"color: #D73A49;\">for</span><span style=\"color: #24292E;\"> (</span><span style=\"color: #D73A49;\">auto&amp;</span><span style=\"color: #24292E;\"> object : objects)</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">21</span><span style=\"color: #24292E;\">        {</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">22</span><span style=\"color: #24292E;\">            object-&gt;</span><span style=\"color: #6F42C1;\">reset</span><span style=\"color: #24292E;\">();</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">23</span><span style=\"color: #24292E;\">        }</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">24</span><span style=\"color: #24292E;\">        </span><span style=\"color: #D73A49;\">return</span><span style=\"color: #24292E;\"> </span><span style=\"color: #6F42C1;\">to_dict</span><span style=\"color: #24292E;\">();</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">25</span><span style=\"color: #24292E;\">    }</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">26</span>&nbsp;</div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">27</span><span style=\"color: #24292E;\">    </span><span style=\"color: #D73A49;\">void</span><span style=\"color: #24292E;\"> </span><span style=\"color: #6F42C1;\">add_object</span><span style=\"color: #24292E;\">(</span><span style=\"color: #6F42C1;\">std</span><span style=\"color: #24292E;\">::</span><span style=\"color: #6F42C1;\">shared_ptr</span><span style=\"color: #24292E;\">&lt;</span><span style=\"color: #6F42C1;\">Object3D</span><span style=\"color: #24292E;\">&gt; </span><span style=\"color: #E36209;\">object</span><span style=\"color: #24292E;\">)</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">28</span><span style=\"color: #24292E;\">    {</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">29</span><span style=\"color: #24292E;\">        objects.</span><span style=\"color: #6F42C1;\">push_back</span><span style=\"color: #24292E;\">(object);</span><span style=\"color: #6A737D;\"> // 将传入的对象(Object3D及其子类)存入列表中</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">30</span><span style=\"color: #24292E;\">    }</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">31</span>&nbsp;</div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">32</span><span style=\"color: #24292E;\">    </span><span style=\"color: #D73A49;\">bool</span><span style=\"color: #24292E;\"> </span><span style=\"color: #6F42C1;\">check_consistency</span><span style=\"color: #24292E;\">()</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">33</span><span style=\"color: #24292E;\">    {</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">34</span><span style=\"color: #24292E;\">        </span><span style=\"color: #D73A49;\">return</span><span style=\"color: #24292E;\"> </span><span style=\"color: #005CC5;\">true</span><span style=\"color: #24292E;\">;</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">35</span><span style=\"color: #24292E;\">    }</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">36</span>&nbsp;</div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">37</span><span style=\"color: #24292E;\">    </span><span style=\"color: #6F42C1;\">py</span><span style=\"color: #24292E;\">::</span><span style=\"color: #6F42C1;\">dict</span><span style=\"color: #24292E;\"> </span><span style=\"color: #6F42C1;\">to_dict</span><span style=\"color: #24292E;\">()</span><span style=\"color: #6A737D;\"> // 调用环境中每个对象的 to_dict() 方法，并将所有返回值存入一个字典中并返回</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">38</span><span style=\"color: #24292E;\">    {</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">39</span><span style=\"color: #24292E;\">        </span><span style=\"color: #6F42C1;\">py</span><span style=\"color: #24292E;\">::dict output_dict;</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">40</span><span style=\"color: #24292E;\">        </span><span style=\"color: #D73A49;\">for</span><span style=\"color: #24292E;\"> (</span><span style=\"color: #D73A49;\">auto&amp;</span><span style=\"color: #24292E;\"> object : objects)</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">41</span><span style=\"color: #24292E;\">        {</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">42</span><span style=\"color: #24292E;\">            output_dict[</span><span style=\"color: #6F42C1;\">py</span><span style=\"color: #24292E;\">::</span><span style=\"color: #6F42C1;\">str</span><span style=\"color: #24292E;\">(object-&gt;name)] </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> object-&gt;</span><span style=\"color: #6F42C1;\">to_dict</span><span style=\"color: #24292E;\">(); </span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">43</span><span style=\"color: #24292E;\">        }</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">44</span><span style=\"color: #24292E;\">        </span><span style=\"color: #D73A49;\">return</span><span style=\"color: #24292E;\"> output_dict;</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">45</span><span style=\"color: #24292E;\">    }</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">46</span>&nbsp;</div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">47</span><span style=\"color: #24292E;\">    </span><span style=\"color: #6F42C1;\">py</span><span style=\"color: #24292E;\">::</span><span style=\"color: #6F42C1;\">dict</span><span style=\"color: #24292E;\"> </span><span style=\"color: #6F42C1;\">get_d</span><span style=\"color: #24292E;\">()</span><span style=\"color: #6A737D;\"> // 获取环境中所有对象的运动学导数，用于 debug</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">48</span><span style=\"color: #24292E;\">    {</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">49</span><span style=\"color: #24292E;\">        </span><span style=\"color: #6F42C1;\">py</span><span style=\"color: #24292E;\">::dict output_dict;</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">50</span><span style=\"color: #24292E;\">        </span><span style=\"color: #D73A49;\">for</span><span style=\"color: #24292E;\"> (</span><span style=\"color: #D73A49;\">auto&amp;</span><span style=\"color: #24292E;\"> object : objects)</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">51</span><span style=\"color: #24292E;\">        {</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">52</span><span style=\"color: #24292E;\">            output_dict[</span><span style=\"color: #6F42C1;\">py</span><span style=\"color: #24292E;\">::</span><span style=\"color: #6F42C1;\">str</span><span style=\"color: #24292E;\">(object-&gt;name)] </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> (object-&gt;</span><span style=\"color: #6F42C1;\">d</span><span style=\"color: #24292E;\">()).</span><span style=\"color: #6F42C1;\">to_dict</span><span style=\"color: #24292E;\">(); </span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">53</span><span style=\"color: #24292E;\">        }</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">54</span><span style=\"color: #24292E;\">        </span><span style=\"color: #D73A49;\">return</span><span style=\"color: #24292E;\"> output_dict;</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">55</span><span style=\"color: #24292E;\">    }</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">56</span>&nbsp;</div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">57</span><span style=\"color: #24292E;\">    </span><span style=\"color: #6F42C1;\">py</span><span style=\"color: #24292E;\">::</span><span style=\"color: #6F42C1;\">object</span><span style=\"color: #24292E;\"> </span><span style=\"color: #6F42C1;\">step</span><span style=\"color: #24292E;\">(</span><span style=\"color: #D73A49;\">const</span><span style=\"color: #24292E;\"> </span><span style=\"color: #6F42C1;\">py</span><span style=\"color: #24292E;\">::</span><span style=\"color: #6F42C1;\">object</span><span style=\"color: #D73A49;\">&amp;</span><span style=\"color: #24292E;\"> </span><span style=\"color: #E36209;\">actions</span><span style=\"color: #24292E;\">)</span><span style=\"color: #6A737D;\"> // 步进时会调用环境中所有对象的 step() 方法若干次，并获取返回值</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">58</span><span style=\"color: #24292E;\">    {</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">59</span><span style=\"color: #24292E;\">        </span><span style=\"color: #6F42C1;\">py</span><span style=\"color: #24292E;\">::dict result, info;</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">60</span>&nbsp;</div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">61</span><span style=\"color: #24292E;\">        </span><span style=\"color: #D73A49;\">for</span><span style=\"color: #24292E;\"> (</span><span style=\"color: #D73A49;\">int</span><span style=\"color: #24292E;\"> i </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> </span><span style=\"color: #005CC5;\">0</span><span style=\"color: #24292E;\">; i </span><span style=\"color: #D73A49;\">&lt;</span><span style=\"color: #24292E;\"> integrate_steps; </span><span style=\"color: #D73A49;\">++</span><span style=\"color: #24292E;\">i)</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">62</span><span style=\"color: #24292E;\">        {</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">63</span><span style=\"color: #24292E;\">            </span><span style=\"color: #D73A49;\">for</span><span style=\"color: #24292E;\"> (</span><span style=\"color: #D73A49;\">auto&amp;</span><span style=\"color: #24292E;\"> object : objects)</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">64</span><span style=\"color: #24292E;\">            {</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">65</span><span style=\"color: #24292E;\">                actions[</span><span style=\"color: #6F42C1;\">py</span><span style=\"color: #24292E;\">::</span><span style=\"color: #6F42C1;\">str</span><span style=\"color: #24292E;\">(object-&gt;name)][</span><span style=\"color: #032F62;\">&quot;dt&quot;</span><span style=\"color: #24292E;\">] </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> dt;   </span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">66</span><span style=\"color: #24292E;\">                result[</span><span style=\"color: #6F42C1;\">py</span><span style=\"color: #24292E;\">::</span><span style=\"color: #6F42C1;\">str</span><span style=\"color: #24292E;\">(object-&gt;name)] </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> object-&gt;</span><span style=\"color: #6F42C1;\">step</span><span style=\"color: #24292E;\">(actions[</span><span style=\"color: #6F42C1;\">py</span><span style=\"color: #24292E;\">::</span><span style=\"color: #6F42C1;\">str</span><span style=\"color: #24292E;\">(object-&gt;name)]);</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">67</span><span style=\"color: #24292E;\">            }</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">68</span><span style=\"color: #24292E;\">        }</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">69</span>&nbsp;</div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">70</span><span style=\"color: #24292E;\">        </span><span style=\"color: #D73A49;\">return</span><span style=\"color: #24292E;\"> result;</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">71</span><span style=\"color: #24292E;\">    }</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">72</span><span style=\"color: #24292E;\">};</span></div>","classes":"torchlight","styles":"background-color: #fff; --theme-selection-background: #e2e5e9;"}}
