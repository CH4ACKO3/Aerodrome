{"expires":1743603345.07,"value":{"highlighted":"<!-- Syntax highlighted by torchlight.dev --><div class='line'><span style=\"color: #C792EA;\">class</span><span style=\"color: #F07178;\"> </span><span style=\"color: #FFCB6B;\">MinimalEnv</span><span style=\"color: #F07178;\"> </span><span style=\"color: #89DDFF;\">:</span><span style=\"color: #F07178;\"> </span><span style=\"color: #C792EA;\">public</span><span style=\"color: #F07178;\"> </span><span style=\"color: #FFCB6B;\">BaseEnv</span><span style=\"color: #F07178;\"> </span><span style=\"color: #89DDFF;\">{</span><span style=\"color: #676E95;\"> // 继承自 BaseEnv</span></div><div class='line'><span style=\"color: #C792EA;\">public</span><span style=\"color: #89DDFF;\">:</span></div><div class='line'><span style=\"color: #F07178;\">    </span><span style=\"color: #82AAFF;\">MinimalEnv</span><span style=\"color: #89DDFF;\">()</span><span style=\"color: #F07178;\"> </span><span style=\"color: #89DDFF;\">:</span><span style=\"color: #F07178;\"> </span><span style=\"color: #82AAFF;\">cpp_state</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #F78C6C;\">0</span><span style=\"color: #89DDFF;\">)</span><span style=\"color: #F07178;\"> </span><span style=\"color: #89DDFF;\">{}</span><span style=\"color: #676E95;\"> // 初始化 cpp_state 为 0</span></div><div class='line'>&nbsp;</div><div class='line'><span style=\"color: #F07178;\">    </span><span style=\"color: #82AAFF;\">~MinimalEnv</span><span style=\"color: #89DDFF;\">()</span><span style=\"color: #F07178;\"> </span><span style=\"color: #89DDFF;\">{}</span><span style=\"color: #676E95;\"> // 析构函数</span></div><div class='line'>&nbsp;</div><div class='line'><span style=\"color: #F07178;\">    </span><span style=\"color: #FFCB6B;\">py</span><span style=\"color: #89DDFF;\">::</span><span style=\"color: #FFCB6B;\">object</span><span style=\"color: #F07178;\"> </span><span style=\"color: #82AAFF;\">reset</span><span style=\"color: #89DDFF;\">()</span><span style=\"color: #F07178;\"> override</span><span style=\"color: #676E95;\"> // 重写 BaseEnv 中定义的 reset 方法</span></div><div class='line'><span style=\"color: #F07178;\">    </span><span style=\"color: #89DDFF;\">{</span></div><div class='line'><span style=\"color: #F07178;\">        </span><span style=\"color: #FFCB6B;\">py</span><span style=\"color: #89DDFF;\">::</span><span style=\"color: #F07178;\">dict result</span><span style=\"color: #89DDFF;\">;</span><span style=\"color: #676E95;\"> // 创建一个字典来存储要返回的结果</span></div><div class='line'><span style=\"color: #F07178;\">        cpp_state </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #F07178;\"> </span><span style=\"color: #F78C6C;\">0</span><span style=\"color: #89DDFF;\">;</span><span style=\"color: #676E95;\"> // 将 cpp_state 重置为 0</span></div><div class='line'><span style=\"color: #F07178;\">        </span><span style=\"color: #A6ACCD;\">result</span><span style=\"color: #89DDFF;\">[</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #C3E88D;\">cpp_state</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #89DDFF;\">]</span><span style=\"color: #F07178;\"> </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #F07178;\"> cpp_state</span><span style=\"color: #89DDFF;\">;</span></div><div class='line'><span style=\"color: #F07178;\">        </span><span style=\"color: #A6ACCD;\">result</span><span style=\"color: #89DDFF;\">[</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #C3E88D;\">info</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #89DDFF;\">]</span><span style=\"color: #F07178;\"> </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #F07178;\"> </span><span style=\"color: #89DDFF;\">&quot;&quot;</span><span style=\"color: #89DDFF;\">;</span></div><div class='line'><span style=\"color: #F07178;\">        </span><span style=\"color: #89DDFF;\">return</span><span style=\"color: #F07178;\"> result</span><span style=\"color: #89DDFF;\">;</span></div><div class='line'><span style=\"color: #F07178;\">    </span><span style=\"color: #89DDFF;\">}</span></div><div class='line'>&nbsp;</div><div class='line'><span style=\"color: #F07178;\">    </span><span style=\"color: #FFCB6B;\">py</span><span style=\"color: #89DDFF;\">::</span><span style=\"color: #FFCB6B;\">object</span><span style=\"color: #F07178;\"> </span><span style=\"color: #82AAFF;\">step</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #C792EA;\">const</span><span style=\"color: #F07178;\"> </span><span style=\"color: #FFCB6B;\">py</span><span style=\"color: #89DDFF;\">::</span><span style=\"color: #FFCB6B;\">object</span><span style=\"color: #C792EA;\">&amp;</span><span style=\"color: #F07178;\"> </span><span style=\"color: #A6ACCD;\">action</span><span style=\"color: #89DDFF;\">)</span><span style=\"color: #F07178;\"> override</span><span style=\"color: #676E95;\"> // step 方法从 Python 端接收动作</span></div><div class='line'><span style=\"color: #F07178;\">    </span><span style=\"color: #89DDFF;\">{</span></div><div class='line'><span style=\"color: #676E95;\">        // 在每一步中，环境将 action[&quot;value&quot;] 的值加到其 cpp_state 上</span></div><div class='line'><span style=\"color: #F07178;\">        </span><span style=\"color: #FFCB6B;\">py</span><span style=\"color: #89DDFF;\">::</span><span style=\"color: #F07178;\">dict result</span><span style=\"color: #89DDFF;\">;</span></div><div class='line'><span style=\"color: #F07178;\">        </span><span style=\"color: #89DDFF;\">if</span><span style=\"color: #F07178;\"> </span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #A6ACCD;\">action</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #82AAFF;\">contains</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #C3E88D;\">value</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #89DDFF;\">))</span></div><div class='line'><span style=\"color: #F07178;\">        </span><span style=\"color: #89DDFF;\">{</span></div><div class='line'><span style=\"color: #F07178;\">            </span><span style=\"color: #89DDFF;\">try</span><span style=\"color: #F07178;\"> </span><span style=\"color: #89DDFF;\">{</span></div><div class='line'><span style=\"color: #F07178;\">                </span><span style=\"color: #C792EA;\">int</span><span style=\"color: #F07178;\"> value </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #F07178;\"> </span><span style=\"color: #A6ACCD;\">action</span><span style=\"color: #89DDFF;\">[</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #C3E88D;\">value</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #89DDFF;\">].</span><span style=\"color: #A6ACCD;\">cast</span><span style=\"color: #89DDFF;\">&lt;</span><span style=\"color: #C792EA;\">int</span><span style=\"color: #89DDFF;\">&gt;();</span><span style=\"color: #676E95;\"> // 将 action[&quot;value&quot;] 的值转换为整数</span></div><div class='line'><span style=\"color: #F07178;\">                cpp_state </span><span style=\"color: #89DDFF;\">+=</span><span style=\"color: #F07178;\"> value</span><span style=\"color: #89DDFF;\">;</span><span style=\"color: #676E95;\"> // 将该值加到 cpp_state 上</span></div><div class='line'><span style=\"color: #F07178;\">            </span><span style=\"color: #89DDFF;\">}</span><span style=\"color: #F07178;\"> </span><span style=\"color: #89DDFF;\">catch</span><span style=\"color: #F07178;\"> </span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #C792EA;\">const</span><span style=\"color: #F07178;\"> </span><span style=\"color: #FFCB6B;\">std</span><span style=\"color: #89DDFF;\">::</span><span style=\"color: #F07178;\">exception </span><span style=\"color: #89DDFF;\">&amp;</span><span style=\"color: #F07178;\">e</span><span style=\"color: #89DDFF;\">)</span><span style=\"color: #F07178;\"> </span><span style=\"color: #89DDFF;\">{</span></div><div class='line'><span style=\"color: #F07178;\">                </span><span style=\"color: #A6ACCD;\">result</span><span style=\"color: #89DDFF;\">[</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #C3E88D;\">info</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #89DDFF;\">]</span><span style=\"color: #F07178;\"> </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #F07178;\"> </span><span style=\"color: #FFCB6B;\">std</span><span style=\"color: #89DDFF;\">::</span><span style=\"color: #82AAFF;\">string</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #C3E88D;\">failed to convert value to int: </span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #89DDFF;\">)</span><span style=\"color: #F07178;\"> </span><span style=\"color: #89DDFF;\">+</span><span style=\"color: #F07178;\"> </span><span style=\"color: #A6ACCD;\">e</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #82AAFF;\">what</span><span style=\"color: #89DDFF;\">();</span><span style=\"color: #676E95;\"> // 如果该值不是整数，在结果中添加错误信息</span></div><div class='line'><span style=\"color: #F07178;\">            </span><span style=\"color: #89DDFF;\">}</span></div><div class='line'><span style=\"color: #F07178;\">        </span><span style=\"color: #89DDFF;\">}</span></div><div class='line'><span style=\"color: #F07178;\">        </span><span style=\"color: #89DDFF;\">else</span></div><div class='line'><span style=\"color: #F07178;\">        </span><span style=\"color: #89DDFF;\">{</span></div><div class='line'><span style=\"color: #F07178;\">            </span><span style=\"color: #A6ACCD;\">result</span><span style=\"color: #89DDFF;\">[</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #C3E88D;\">info</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #89DDFF;\">]</span><span style=\"color: #F07178;\"> </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #F07178;\"> </span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #C3E88D;\">error: action must contain &#39;value&#39;</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #89DDFF;\">;</span></div><div class='line'><span style=\"color: #F07178;\">        </span><span style=\"color: #89DDFF;\">}</span></div><div class='line'>&nbsp;</div><div class='line'><span style=\"color: #F07178;\">        </span><span style=\"color: #A6ACCD;\">result</span><span style=\"color: #89DDFF;\">[</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #C3E88D;\">cpp_state</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #89DDFF;\">]</span><span style=\"color: #F07178;\"> </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #F07178;\"> cpp_state</span><span style=\"color: #89DDFF;\">;</span></div><div class='line'><span style=\"color: #F07178;\">        </span><span style=\"color: #89DDFF;\">if</span><span style=\"color: #F07178;\"> </span><span style=\"color: #89DDFF;\">(!</span><span style=\"color: #A6ACCD;\">result</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #82AAFF;\">contains</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #C3E88D;\">info</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #89DDFF;\">))</span></div><div class='line'><span style=\"color: #F07178;\">        </span><span style=\"color: #89DDFF;\">{</span></div><div class='line'><span style=\"color: #676E95;\">            // 如果结果中没有 info 键，添加一个空字符串，以避免 key error</span></div><div class='line'><span style=\"color: #F07178;\">            </span><span style=\"color: #A6ACCD;\">result</span><span style=\"color: #89DDFF;\">[</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #C3E88D;\">info</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #89DDFF;\">]</span><span style=\"color: #F07178;\"> </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #F07178;\"> </span><span style=\"color: #89DDFF;\">&quot;&quot;</span><span style=\"color: #89DDFF;\">;</span></div><div class='line'><span style=\"color: #F07178;\">        </span><span style=\"color: #89DDFF;\">}</span></div><div class='line'><span style=\"color: #F07178;\">        </span><span style=\"color: #89DDFF;\">return</span><span style=\"color: #F07178;\"> result</span><span style=\"color: #89DDFF;\">;</span></div><div class='line'><span style=\"color: #F07178;\">    </span><span style=\"color: #89DDFF;\">}</span></div><div class='line'>&nbsp;</div><div class='line'><span style=\"color: #C792EA;\">private</span><span style=\"color: #89DDFF;\">:</span></div><div class='line'><span style=\"color: #F07178;\">    </span><span style=\"color: #C792EA;\">int</span><span style=\"color: #F07178;\"> cpp_state </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #F07178;\"> </span><span style=\"color: #F78C6C;\">0</span><span style=\"color: #89DDFF;\">;</span><span style=\"color: #676E95;\"> // 私有成员变量，用于存储环境的状态</span></div><div class='line'><span style=\"color: #89DDFF;\">};</span></div>","classes":"torchlight","styles":"background-color: #292D3E; --theme-selection-background: #00000080;"}}
