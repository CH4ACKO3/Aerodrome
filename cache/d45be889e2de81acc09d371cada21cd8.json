{"expires":1743605057.112,"value":{"highlighted":"<!-- Syntax highlighted by torchlight.dev --><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 1</span><span style=\"color: #0991B6;\">def</span><span style=\"color: #002339;\"> </span><span style=\"color: #B1108E;\">layer_init</span><span style=\"color: #002339;\">(</span><span style=\"color: #B1108E;\">layer</span><span style=\"color: #002339;\">, </span><span style=\"color: #B1108E;\">std</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\">np.sqrt(</span><span style=\"color: #174781;\">2</span><span style=\"color: #002339;\">), </span><span style=\"color: #B1108E;\">bias_const</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #174781;\">0.0</span><span style=\"color: #002339;\">):</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 2</span><span style=\"color: #002339;\">    torch.nn.init.orthogonal_(layer.weight, std)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 3</span><span style=\"color: #002339;\">    torch.nn.init.constant_(layer.bias, bias_const)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 4</span><span style=\"color: #002339;\">    </span><span style=\"color: #0991B6;\">return</span><span style=\"color: #002339;\"> layer</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 5</span>&nbsp;</div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 6</span><span style=\"color: #0991B6;\">class</span><span style=\"color: #002339;\"> </span><span style=\"color: #0444AC;\">Agent</span><span style=\"color: #002339;\">(</span><span style=\"color: #B02767;\">nn</span><span style=\"color: #002339;\">.</span><span style=\"color: #B02767;\">Module</span><span style=\"color: #002339;\">):</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 7</span><span style=\"color: #002339;\">    </span><span style=\"color: #0991B6;\">def</span><span style=\"color: #002339;\"> </span><span style=\"color: #08134A;\">__init__</span><span style=\"color: #002339;\">(</span><span style=\"color: #B1108E;\">self</span><span style=\"color: #002339;\">):</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 8</span><span style=\"color: #002339;\">        </span><span style=\"color: #DC3EB7;\">super</span><span style=\"color: #002339;\">().</span><span style=\"color: #08134A;\">__init__</span><span style=\"color: #002339;\">()</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 9</span><span style=\"color: #002339;\">        </span><span style=\"color: #2F86D2;\">self</span><span style=\"color: #002339;\">.critic </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> nn.Sequential(</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">10</span><span style=\"color: #002339;\">            layer_init(nn.Linear(</span><span style=\"color: #174781;\">3</span><span style=\"color: #002339;\">, </span><span style=\"color: #174781;\">256</span><span style=\"color: #002339;\">)),</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">11</span><span style=\"color: #002339;\">            nn.ReLU(),</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">12</span><span style=\"color: #002339;\">            layer_init(nn.Linear(</span><span style=\"color: #174781;\">256</span><span style=\"color: #002339;\">, </span><span style=\"color: #174781;\">256</span><span style=\"color: #002339;\">)),</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">13</span><span style=\"color: #002339;\">            nn.ReLU(),</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">14</span><span style=\"color: #002339;\">            layer_init(nn.Linear(</span><span style=\"color: #174781;\">256</span><span style=\"color: #002339;\">, </span><span style=\"color: #174781;\">256</span><span style=\"color: #002339;\">)),</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">15</span><span style=\"color: #002339;\">            nn.ReLU(),</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">16</span><span style=\"color: #002339;\">            layer_init(nn.Linear(</span><span style=\"color: #174781;\">256</span><span style=\"color: #002339;\">, </span><span style=\"color: #174781;\">1</span><span style=\"color: #002339;\">), </span><span style=\"color: #B1108E;\">std</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #174781;\">1.0</span><span style=\"color: #002339;\">),</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">17</span><span style=\"color: #002339;\">        )</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">18</span><span style=\"color: #002339;\">        </span><span style=\"color: #2F86D2;\">self</span><span style=\"color: #002339;\">.actor_mean </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> nn.Sequential(</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">19</span><span style=\"color: #002339;\">            layer_init(nn.Linear(</span><span style=\"color: #174781;\">3</span><span style=\"color: #002339;\">, </span><span style=\"color: #174781;\">128</span><span style=\"color: #002339;\">)),</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">20</span><span style=\"color: #002339;\">            nn.ReLU(),</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">21</span><span style=\"color: #002339;\">            layer_init(nn.Linear(</span><span style=\"color: #174781;\">128</span><span style=\"color: #002339;\">, </span><span style=\"color: #174781;\">128</span><span style=\"color: #002339;\">)),</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">22</span><span style=\"color: #002339;\">            nn.ReLU(),</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">23</span><span style=\"color: #002339;\">            layer_init(nn.Linear(</span><span style=\"color: #174781;\">128</span><span style=\"color: #002339;\">, </span><span style=\"color: #174781;\">128</span><span style=\"color: #002339;\">)),</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">24</span><span style=\"color: #002339;\">            nn.ReLU(),</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">25</span><span style=\"color: #002339;\">            layer_init(nn.Linear(</span><span style=\"color: #174781;\">128</span><span style=\"color: #002339;\">, </span><span style=\"color: #174781;\">1</span><span style=\"color: #002339;\">), </span><span style=\"color: #B1108E;\">std</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #174781;\">0.01</span><span style=\"color: #002339;\">),</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">26</span><span style=\"color: #002339;\">            nn.Tanh(),</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">27</span><span style=\"color: #002339;\">        )</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">28</span><span style=\"color: #002339;\">        </span><span style=\"color: #2F86D2;\">self</span><span style=\"color: #002339;\">.actor_logstd </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> nn.Parameter(torch.zeros(</span><span style=\"color: #174781;\">1</span><span style=\"color: #002339;\">, </span><span style=\"color: #174781;\">1</span><span style=\"color: #002339;\">))</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">29</span>&nbsp;</div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">30</span><span style=\"color: #002339;\">    </span><span style=\"color: #0991B6;\">def</span><span style=\"color: #002339;\"> </span><span style=\"color: #B1108E;\">get_value</span><span style=\"color: #002339;\">(</span><span style=\"color: #B1108E;\">self</span><span style=\"color: #002339;\">, </span><span style=\"color: #B1108E;\">x</span><span style=\"color: #002339;\">):</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">31</span><span style=\"color: #002339;\">        </span><span style=\"color: #0991B6;\">return</span><span style=\"color: #002339;\"> </span><span style=\"color: #2F86D2;\">self</span><span style=\"color: #002339;\">.critic(x)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">32</span>&nbsp;</div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">33</span><span style=\"color: #002339;\">    </span><span style=\"color: #0991B6;\">def</span><span style=\"color: #002339;\"> </span><span style=\"color: #B1108E;\">get_action_and_value</span><span style=\"color: #002339;\">(</span><span style=\"color: #B1108E;\">self</span><span style=\"color: #002339;\">, </span><span style=\"color: #B1108E;\">x</span><span style=\"color: #002339;\">, </span><span style=\"color: #B1108E;\">action</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #2970C7;\">None</span><span style=\"color: #002339;\">, </span><span style=\"color: #B1108E;\">evaluate</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #2970C7;\">False</span><span style=\"color: #002339;\">):</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">34</span><span style=\"color: #002339;\">        action_mean </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> </span><span style=\"color: #2F86D2;\">self</span><span style=\"color: #002339;\">.actor_mean(x)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">35</span><span style=\"color: #002339;\">        action_logstd </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> </span><span style=\"color: #2F86D2;\">self</span><span style=\"color: #002339;\">.actor_logstd.expand_as(action_mean)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">36</span><span style=\"color: #002339;\">        action_std </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> torch.exp(action_logstd)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">37</span><span style=\"color: #002339;\">        </span><span style=\"color: #0991B6;\">if</span><span style=\"color: #002339;\"> evaluate:</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">38</span><span style=\"color: #002339;\">            probs </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> Normal(action_mean, action_std</span><span style=\"color: #7B30D0;\">*</span><span style=\"color: #174781;\">1e-6</span><span style=\"color: #002339;\">)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">39</span><span style=\"color: #002339;\">        </span><span style=\"color: #0991B6;\">else</span><span style=\"color: #002339;\">:</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">40</span><span style=\"color: #002339;\">            probs </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> Normal(action_mean, action_std)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">41</span><span style=\"color: #002339;\">        </span><span style=\"color: #0991B6;\">if</span><span style=\"color: #002339;\"> action </span><span style=\"color: #7B30D0;\">is</span><span style=\"color: #002339;\"> </span><span style=\"color: #2970C7;\">None</span><span style=\"color: #002339;\">:</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">42</span><span style=\"color: #002339;\">            action </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> probs.sample()</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">43</span><span style=\"color: #002339;\">        action </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> torch.clamp(action, </span><span style=\"color: #7B30D0;\">-</span><span style=\"color: #174781;\">1.0</span><span style=\"color: #002339;\">, </span><span style=\"color: #174781;\">1.0</span><span style=\"color: #002339;\">)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">44</span><span style=\"color: #002339;\">        </span><span style=\"color: #0991B6;\">return</span><span style=\"color: #002339;\"> action, probs.log_prob(action).sum(</span><span style=\"color: #174781;\">1</span><span style=\"color: #002339;\">), probs.entropy().sum(</span><span style=\"color: #174781;\">1</span><span style=\"color: #002339;\">), </span><span style=\"color: #2F86D2;\">self</span><span style=\"color: #002339;\">.critic(x)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">45</span>&nbsp;</div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">46</span>&nbsp;</div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">47</span><span style=\"color: #0991B6;\">def</span><span style=\"color: #002339;\"> </span><span style=\"color: #B1108E;\">linear_schedule</span><span style=\"color: #002339;\">(</span><span style=\"color: #B1108E;\">start_e</span><span style=\"color: #002339;\">, </span><span style=\"color: #B1108E;\">end_e</span><span style=\"color: #002339;\">, </span><span style=\"color: #B1108E;\">duration</span><span style=\"color: #002339;\">, </span><span style=\"color: #B1108E;\">t</span><span style=\"color: #002339;\">):</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">48</span><span style=\"color: #002339;\">    </span><span style=\"color: #0991B6;\">return</span><span style=\"color: #002339;\"> start_e </span><span style=\"color: #7B30D0;\">+</span><span style=\"color: #002339;\"> (end_e </span><span style=\"color: #7B30D0;\">-</span><span style=\"color: #002339;\"> start_e) </span><span style=\"color: #7B30D0;\">*</span><span style=\"color: #002339;\"> </span><span style=\"color: #08134A;\">min</span><span style=\"color: #002339;\">(t </span><span style=\"color: #7B30D0;\">/</span><span style=\"color: #002339;\"> duration, </span><span style=\"color: #174781;\">1</span><span style=\"color: #002339;\">)</span></div>","classes":"torchlight","styles":"background-color: #FFFFFF; --theme-selection-background: #4373c2;"}}
