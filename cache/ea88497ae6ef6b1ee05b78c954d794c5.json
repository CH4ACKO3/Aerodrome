{"expires":1743603347.33,"value":{"highlighted":"<!-- Syntax highlighted by torchlight.dev --><div class='line'><span style=\"color: #C792EA;\">class</span><span style=\"color: #F07178;\"> </span><span style=\"color: #FFCB6B;\">CartPoleEnv</span><span style=\"color: #F07178;\"> </span><span style=\"color: #89DDFF;\">:</span><span style=\"color: #F07178;\"> </span><span style=\"color: #C792EA;\">public</span><span style=\"color: #F07178;\"> </span><span style=\"color: #FFCB6B;\">BaseEnv</span></div><div class='line'><span style=\"color: #89DDFF;\">{</span></div><div class='line'><span style=\"color: #C792EA;\">private</span><span style=\"color: #89DDFF;\">:</span></div><div class='line'><span style=\"color: #F07178;\">    </span><span style=\"color: #C792EA;\">double</span><span style=\"color: #F07178;\"> gravity </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #F07178;\"> </span><span style=\"color: #F78C6C;\">9.81</span><span style=\"color: #89DDFF;\">;</span></div><div class='line'><span style=\"color: #F07178;\">    </span><span style=\"color: #C792EA;\">double</span><span style=\"color: #F07178;\"> masscart </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #F07178;\"> </span><span style=\"color: #F78C6C;\">1.0</span><span style=\"color: #89DDFF;\">;</span></div><div class='line'><span style=\"color: #F07178;\">    </span><span style=\"color: #C792EA;\">double</span><span style=\"color: #F07178;\"> masspole </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #F07178;\"> </span><span style=\"color: #F78C6C;\">0.1</span><span style=\"color: #89DDFF;\">;</span></div><div class='line'><span style=\"color: #F07178;\">    </span><span style=\"color: #C792EA;\">double</span><span style=\"color: #F07178;\"> total_mass </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #F07178;\"> masspole </span><span style=\"color: #89DDFF;\">+</span><span style=\"color: #F07178;\"> masscart</span><span style=\"color: #89DDFF;\">;</span></div><div class='line'><span style=\"color: #F07178;\">    </span><span style=\"color: #C792EA;\">double</span><span style=\"color: #F07178;\"> length </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #F07178;\"> </span><span style=\"color: #F78C6C;\">0.5</span><span style=\"color: #89DDFF;\">;</span><span style=\"color: #676E95;\"> // half the pole&#39;s length</span></div><div class='line'><span style=\"color: #F07178;\">    </span><span style=\"color: #C792EA;\">double</span><span style=\"color: #F07178;\"> polemass_length </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #F07178;\"> masspole </span><span style=\"color: #89DDFF;\">*</span><span style=\"color: #F07178;\"> length</span><span style=\"color: #89DDFF;\">;</span></div><div class='line'><span style=\"color: #F07178;\">    </span><span style=\"color: #C792EA;\">double</span><span style=\"color: #F07178;\"> force_mag </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #F07178;\"> </span><span style=\"color: #F78C6C;\">10.0</span><span style=\"color: #89DDFF;\">;</span></div><div class='line'><span style=\"color: #F07178;\">    </span><span style=\"color: #C792EA;\">double</span><span style=\"color: #F07178;\"> tau </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #F07178;\"> </span><span style=\"color: #F78C6C;\">0.02</span><span style=\"color: #89DDFF;\">;</span><span style=\"color: #676E95;\"> // seconds between state updates</span></div><div class='line'><span style=\"color: #F07178;\">    </span><span style=\"color: #FFCB6B;\">std</span><span style=\"color: #89DDFF;\">::</span><span style=\"color: #F07178;\">string kinematic_integrator </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #F07178;\"> </span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #C3E88D;\">euler</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #89DDFF;\">;</span></div><div class='line'>&nbsp;</div><div class='line'><span style=\"color: #F07178;\">    </span><span style=\"color: #C792EA;\">double</span><span style=\"color: #F07178;\"> theta_threshold_radians </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #F07178;\"> </span><span style=\"color: #F78C6C;\">12</span><span style=\"color: #F07178;\"> </span><span style=\"color: #89DDFF;\">*</span><span style=\"color: #F07178;\"> </span><span style=\"color: #F78C6C;\">2</span><span style=\"color: #F07178;\"> </span><span style=\"color: #89DDFF;\">*</span><span style=\"color: #F07178;\"> </span><span style=\"color: #F78C6C;\">3.1415926</span><span style=\"color: #F07178;\"> </span><span style=\"color: #89DDFF;\">/</span><span style=\"color: #F07178;\"> </span><span style=\"color: #F78C6C;\">360</span><span style=\"color: #89DDFF;\">;</span><span style=\"color: #676E95;\"> // angle at which to fail the episode</span></div><div class='line'><span style=\"color: #F07178;\">    </span><span style=\"color: #C792EA;\">double</span><span style=\"color: #F07178;\"> x_threshold </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #F07178;\"> </span><span style=\"color: #F78C6C;\">2.4</span><span style=\"color: #89DDFF;\">;</span><span style=\"color: #676E95;\"> // distance at which to fail the episode</span></div><div class='line'>&nbsp;</div><div class='line'><span style=\"color: #F07178;\">    </span><span style=\"color: #C792EA;\">double</span><span style=\"color: #F07178;\"> x </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #F07178;\"> </span><span style=\"color: #F78C6C;\">0</span><span style=\"color: #89DDFF;\">;</span></div><div class='line'><span style=\"color: #F07178;\">    </span><span style=\"color: #C792EA;\">double</span><span style=\"color: #F07178;\"> theta </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #F07178;\"> </span><span style=\"color: #F78C6C;\">0</span><span style=\"color: #89DDFF;\">;</span></div><div class='line'><span style=\"color: #F07178;\">    </span><span style=\"color: #C792EA;\">double</span><span style=\"color: #F07178;\"> x_dot </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #F07178;\"> </span><span style=\"color: #F78C6C;\">0</span><span style=\"color: #89DDFF;\">;</span></div><div class='line'><span style=\"color: #F07178;\">    </span><span style=\"color: #C792EA;\">double</span><span style=\"color: #F07178;\"> theta_dot </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #F07178;\"> </span><span style=\"color: #F78C6C;\">0</span><span style=\"color: #89DDFF;\">;</span></div><div class='line'>&nbsp;</div><div class='line'><span style=\"color: #F07178;\">    </span><span style=\"color: #C792EA;\">int</span><span style=\"color: #F07178;\"> time_step </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #F07178;\"> </span><span style=\"color: #F78C6C;\">0</span><span style=\"color: #89DDFF;\">;</span></div><div class='line'><span style=\"color: #F07178;\">    </span><span style=\"color: #C792EA;\">int</span><span style=\"color: #F07178;\"> max_steps </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #F07178;\"> </span><span style=\"color: #F78C6C;\">200</span><span style=\"color: #89DDFF;\">;</span></div><div class='line'><span style=\"color: #F07178;\">    </span><span style=\"color: #C792EA;\">bool</span><span style=\"color: #F07178;\"> steps_beyond_done </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #F07178;\"> </span><span style=\"color: #89DDFF;\">false;</span></div><div class='line'>&nbsp;</div><div class='line'><span style=\"color: #C792EA;\">public</span><span style=\"color: #89DDFF;\">:</span></div><div class='line'><span style=\"color: #F07178;\">    </span><span style=\"color: #82AAFF;\">CartPoleEnv</span><span style=\"color: #89DDFF;\">()</span><span style=\"color: #F07178;\"> </span><span style=\"color: #89DDFF;\">{}</span></div><div class='line'>&nbsp;</div><div class='line'><span style=\"color: #F07178;\">    </span><span style=\"color: #82AAFF;\">~CartPoleEnv</span><span style=\"color: #89DDFF;\">()</span><span style=\"color: #F07178;\"> </span><span style=\"color: #89DDFF;\">{}</span></div><div class='line'>&nbsp;</div><div class='line'><span style=\"color: #F07178;\">    </span><span style=\"color: #FFCB6B;\">py</span><span style=\"color: #89DDFF;\">::</span><span style=\"color: #FFCB6B;\">object</span><span style=\"color: #F07178;\"> </span><span style=\"color: #82AAFF;\">reset</span><span style=\"color: #89DDFF;\">()</span><span style=\"color: #F07178;\"> </span><span style=\"color: #C792EA;\">override</span></div><div class='line'><span style=\"color: #F07178;\">    </span><span style=\"color: #89DDFF;\">{</span></div><div class='line'><span style=\"color: #F07178;\">        </span><span style=\"color: #FFCB6B;\">py</span><span style=\"color: #89DDFF;\">::</span><span style=\"color: #F07178;\">dict result</span><span style=\"color: #89DDFF;\">;</span></div><div class='line'><span style=\"color: #F07178;\">        </span><span style=\"color: #FFCB6B;\">std</span><span style=\"color: #89DDFF;\">::</span><span style=\"color: #F07178;\">random_device rd</span><span style=\"color: #89DDFF;\">;</span></div><div class='line'><span style=\"color: #F07178;\">        </span><span style=\"color: #FFCB6B;\">std</span><span style=\"color: #89DDFF;\">::</span><span style=\"color: #F07178;\">mt19937 </span><span style=\"color: #82AAFF;\">gen</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #82AAFF;\">rd</span><span style=\"color: #89DDFF;\">());</span></div><div class='line'><span style=\"color: #F07178;\">        </span><span style=\"color: #FFCB6B;\">std</span><span style=\"color: #89DDFF;\">::</span><span style=\"color: #F07178;\">uniform_real_distribution</span><span style=\"color: #89DDFF;\">&lt;&gt;</span><span style=\"color: #F07178;\"> </span><span style=\"color: #82AAFF;\">dis</span><span style=\"color: #89DDFF;\">(-</span><span style=\"color: #F78C6C;\">0.05</span><span style=\"color: #89DDFF;\">,</span><span style=\"color: #F07178;\"> </span><span style=\"color: #F78C6C;\">0.05</span><span style=\"color: #89DDFF;\">);</span></div><div class='line'>&nbsp;</div><div class='line'><span style=\"color: #F07178;\">        x </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #F07178;\"> </span><span style=\"color: #82AAFF;\">dis</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #F07178;\">gen</span><span style=\"color: #89DDFF;\">);</span></div><div class='line'><span style=\"color: #F07178;\">        x_dot </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #F07178;\"> </span><span style=\"color: #82AAFF;\">dis</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #F07178;\">gen</span><span style=\"color: #89DDFF;\">);</span></div><div class='line'><span style=\"color: #F07178;\">        theta </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #F07178;\"> </span><span style=\"color: #82AAFF;\">dis</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #F07178;\">gen</span><span style=\"color: #89DDFF;\">);</span></div><div class='line'><span style=\"color: #F07178;\">        theta_dot </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #F07178;\"> </span><span style=\"color: #82AAFF;\">dis</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #F07178;\">gen</span><span style=\"color: #89DDFF;\">);</span></div><div class='line'><span style=\"color: #F07178;\">        time_step </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #F07178;\"> </span><span style=\"color: #F78C6C;\">0</span><span style=\"color: #89DDFF;\">;</span></div><div class='line'><span style=\"color: #F07178;\">        steps_beyond_done </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #F07178;\"> </span><span style=\"color: #89DDFF;\">false;</span></div><div class='line'>&nbsp;</div><div class='line'><span style=\"color: #F07178;\">        </span><span style=\"color: #A6ACCD;\">result</span><span style=\"color: #89DDFF;\">[</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #C3E88D;\">observation</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #89DDFF;\">]</span><span style=\"color: #F07178;\"> </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #F07178;\"> </span><span style=\"color: #FFCB6B;\">py</span><span style=\"color: #89DDFF;\">::</span><span style=\"color: #82AAFF;\">make_tuple</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #F07178;\">x</span><span style=\"color: #89DDFF;\">,</span><span style=\"color: #F07178;\"> x_dot</span><span style=\"color: #89DDFF;\">,</span><span style=\"color: #F07178;\"> theta</span><span style=\"color: #89DDFF;\">,</span><span style=\"color: #F07178;\"> theta_dot</span><span style=\"color: #89DDFF;\">);</span></div><div class='line'><span style=\"color: #F07178;\">        </span><span style=\"color: #A6ACCD;\">result</span><span style=\"color: #89DDFF;\">[</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #C3E88D;\">info</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #89DDFF;\">]</span><span style=\"color: #F07178;\"> </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #F07178;\"> </span><span style=\"color: #89DDFF;\">&quot;&quot;</span><span style=\"color: #89DDFF;\">;</span></div><div class='line'><span style=\"color: #F07178;\">        </span><span style=\"color: #89DDFF;\">return</span><span style=\"color: #F07178;\"> result</span><span style=\"color: #89DDFF;\">;</span></div><div class='line'><span style=\"color: #F07178;\">    </span><span style=\"color: #89DDFF;\">}</span></div><div class='line'>&nbsp;</div><div class='line'><span style=\"color: #F07178;\">    </span><span style=\"color: #FFCB6B;\">py</span><span style=\"color: #89DDFF;\">::</span><span style=\"color: #FFCB6B;\">object</span><span style=\"color: #F07178;\"> </span><span style=\"color: #82AAFF;\">step</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #C792EA;\">const</span><span style=\"color: #F07178;\"> </span><span style=\"color: #FFCB6B;\">py</span><span style=\"color: #89DDFF;\">::</span><span style=\"color: #FFCB6B;\">object</span><span style=\"color: #C792EA;\">&amp;</span><span style=\"color: #F07178;\"> </span><span style=\"color: #A6ACCD;\">input_dict</span><span style=\"color: #89DDFF;\">)</span><span style=\"color: #F07178;\"> </span><span style=\"color: #C792EA;\">override</span></div><div class='line'><span style=\"color: #F07178;\">    </span><span style=\"color: #89DDFF;\">{</span></div><div class='line'><span style=\"color: #F07178;\">        </span><span style=\"color: #FFCB6B;\">py</span><span style=\"color: #89DDFF;\">::</span><span style=\"color: #F07178;\">dict result</span><span style=\"color: #89DDFF;\">;</span></div><div class='line'><span style=\"color: #F07178;\">        </span><span style=\"color: #89DDFF;\">if</span><span style=\"color: #F07178;\"> </span><span style=\"color: #89DDFF;\">(!</span><span style=\"color: #A6ACCD;\">input_dict</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #82AAFF;\">contains</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #C3E88D;\">action</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #89DDFF;\">))</span></div><div class='line'><span style=\"color: #F07178;\">        </span><span style=\"color: #89DDFF;\">{</span></div><div class='line'><span style=\"color: #F07178;\">            </span><span style=\"color: #A6ACCD;\">result</span><span style=\"color: #89DDFF;\">[</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #C3E88D;\">info</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #89DDFF;\">]</span><span style=\"color: #F07178;\"> </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #F07178;\"> </span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #C3E88D;\">input_dict does not contain &#39;action&#39;</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #89DDFF;\">;</span></div><div class='line'><span style=\"color: #F07178;\">            </span><span style=\"color: #89DDFF;\">return</span><span style=\"color: #F07178;\"> result</span><span style=\"color: #89DDFF;\">;</span></div><div class='line'><span style=\"color: #F07178;\">        </span><span style=\"color: #89DDFF;\">}</span></div><div class='line'>&nbsp;</div><div class='line'><span style=\"color: #F07178;\">        </span><span style=\"color: #C792EA;\">int</span><span style=\"color: #F07178;\"> action</span><span style=\"color: #89DDFF;\">;</span></div><div class='line'><span style=\"color: #F07178;\">        </span><span style=\"color: #89DDFF;\">try</span></div><div class='line'><span style=\"color: #F07178;\">        </span><span style=\"color: #89DDFF;\">{</span></div><div class='line'><span style=\"color: #F07178;\">            action </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #F07178;\"> </span><span style=\"color: #A6ACCD;\">input_dict</span><span style=\"color: #89DDFF;\">[</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #C3E88D;\">action</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #89DDFF;\">].</span><span style=\"color: #A6ACCD;\">cast</span><span style=\"color: #89DDFF;\">&lt;</span><span style=\"color: #C792EA;\">int</span><span style=\"color: #89DDFF;\">&gt;();</span></div><div class='line'><span style=\"color: #F07178;\">        </span><span style=\"color: #89DDFF;\">}</span></div><div class='line'><span style=\"color: #F07178;\">        </span><span style=\"color: #89DDFF;\">catch</span><span style=\"color: #F07178;\"> </span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #C792EA;\">const</span><span style=\"color: #F07178;\"> </span><span style=\"color: #FFCB6B;\">std</span><span style=\"color: #89DDFF;\">::</span><span style=\"color: #F07178;\">exception </span><span style=\"color: #89DDFF;\">&amp;</span><span style=\"color: #F07178;\">e</span><span style=\"color: #89DDFF;\">)</span></div><div class='line'><span style=\"color: #F07178;\">        </span><span style=\"color: #89DDFF;\">{</span></div><div class='line'><span style=\"color: #F07178;\">            </span><span style=\"color: #A6ACCD;\">result</span><span style=\"color: #89DDFF;\">[</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #C3E88D;\">info</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #89DDFF;\">]</span><span style=\"color: #F07178;\"> </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #F07178;\"> </span><span style=\"color: #FFCB6B;\">std</span><span style=\"color: #89DDFF;\">::</span><span style=\"color: #82AAFF;\">string</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #C3E88D;\">failed to convert action to int: </span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #89DDFF;\">)</span><span style=\"color: #F07178;\"> </span><span style=\"color: #89DDFF;\">+</span><span style=\"color: #F07178;\"> </span><span style=\"color: #A6ACCD;\">e</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #82AAFF;\">what</span><span style=\"color: #89DDFF;\">();</span></div><div class='line'><span style=\"color: #F07178;\">            </span><span style=\"color: #89DDFF;\">return</span><span style=\"color: #F07178;\"> result</span><span style=\"color: #89DDFF;\">;</span></div><div class='line'><span style=\"color: #F07178;\">        </span><span style=\"color: #89DDFF;\">}</span></div><div class='line'>&nbsp;</div><div class='line'><span style=\"color: #F07178;\">        </span><span style=\"color: #89DDFF;\">if</span><span style=\"color: #F07178;\"> </span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #F07178;\">action </span><span style=\"color: #89DDFF;\">!=</span><span style=\"color: #F07178;\"> </span><span style=\"color: #F78C6C;\">0</span><span style=\"color: #F07178;\"> </span><span style=\"color: #89DDFF;\">&amp;&amp;</span><span style=\"color: #F07178;\"> action </span><span style=\"color: #89DDFF;\">!=</span><span style=\"color: #F07178;\"> </span><span style=\"color: #F78C6C;\">1</span><span style=\"color: #89DDFF;\">)</span></div><div class='line'><span style=\"color: #F07178;\">        </span><span style=\"color: #89DDFF;\">{</span></div><div class='line'><span style=\"color: #F07178;\">            </span><span style=\"color: #A6ACCD;\">result</span><span style=\"color: #89DDFF;\">[</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #C3E88D;\">info</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #89DDFF;\">]</span><span style=\"color: #F07178;\"> </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #F07178;\"> </span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #C3E88D;\">action must be either 0 or 1</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #89DDFF;\">;</span></div><div class='line'><span style=\"color: #F07178;\">            </span><span style=\"color: #89DDFF;\">return</span><span style=\"color: #F07178;\"> result</span><span style=\"color: #89DDFF;\">;</span></div><div class='line'><span style=\"color: #F07178;\">        </span><span style=\"color: #89DDFF;\">}</span></div><div class='line'>&nbsp;</div><div class='line'><span style=\"color: #F07178;\">        </span><span style=\"color: #C792EA;\">double</span><span style=\"color: #F07178;\"> force </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #F07178;\"> action </span><span style=\"color: #89DDFF;\">*</span><span style=\"color: #F07178;\"> force_mag</span><span style=\"color: #89DDFF;\">;</span></div><div class='line'><span style=\"color: #F07178;\">        </span><span style=\"color: #C792EA;\">double</span><span style=\"color: #F07178;\"> costheta </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #F07178;\"> </span><span style=\"color: #82AAFF;\">cos</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #F07178;\">theta</span><span style=\"color: #89DDFF;\">);</span></div><div class='line'><span style=\"color: #F07178;\">        </span><span style=\"color: #C792EA;\">double</span><span style=\"color: #F07178;\"> sintheta </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #F07178;\"> </span><span style=\"color: #82AAFF;\">sin</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #F07178;\">theta</span><span style=\"color: #89DDFF;\">);</span></div><div class='line'>&nbsp;</div><div class='line'><span style=\"color: #676E95;\">        // For the interested reader:</span></div><div class='line'><span style=\"color: #676E95;\">        // https://coneural.org/florian/papers/05_cart_pole.pdf</span></div><div class='line'><span style=\"color: #F07178;\">        </span><span style=\"color: #C792EA;\">double</span><span style=\"color: #F07178;\"> temp </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #F07178;\"> </span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #F07178;\">force </span><span style=\"color: #89DDFF;\">+</span><span style=\"color: #F07178;\"> polemass_length </span><span style=\"color: #89DDFF;\">*</span><span style=\"color: #F07178;\"> theta_dot </span><span style=\"color: #89DDFF;\">*</span><span style=\"color: #F07178;\"> theta_dot </span><span style=\"color: #89DDFF;\">*</span><span style=\"color: #F07178;\"> sintheta</span><span style=\"color: #89DDFF;\">)</span><span style=\"color: #F07178;\"> </span><span style=\"color: #89DDFF;\">/</span><span style=\"color: #F07178;\"> total_mass</span><span style=\"color: #89DDFF;\">;</span></div><div class='line'><span style=\"color: #F07178;\">        </span><span style=\"color: #C792EA;\">double</span><span style=\"color: #F07178;\"> theta_acc </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #F07178;\"> </span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #F07178;\">gravity </span><span style=\"color: #89DDFF;\">*</span><span style=\"color: #F07178;\"> sintheta </span><span style=\"color: #89DDFF;\">-</span><span style=\"color: #F07178;\"> costheta </span><span style=\"color: #89DDFF;\">*</span><span style=\"color: #F07178;\"> temp</span><span style=\"color: #89DDFF;\">)</span><span style=\"color: #F07178;\"> </span><span style=\"color: #89DDFF;\">/</span><span style=\"color: #F07178;\"> </span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #F07178;\">length </span><span style=\"color: #89DDFF;\">*</span><span style=\"color: #F07178;\"> </span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #F78C6C;\">4.0</span><span style=\"color: #F07178;\"> </span><span style=\"color: #89DDFF;\">/</span><span style=\"color: #F07178;\"> </span><span style=\"color: #F78C6C;\">3.0</span><span style=\"color: #F07178;\"> </span><span style=\"color: #89DDFF;\">-</span><span style=\"color: #F07178;\"> masspole </span><span style=\"color: #89DDFF;\">*</span><span style=\"color: #F07178;\"> costheta </span><span style=\"color: #89DDFF;\">*</span><span style=\"color: #F07178;\"> costheta </span><span style=\"color: #89DDFF;\">/</span><span style=\"color: #F07178;\"> total_mass</span><span style=\"color: #89DDFF;\">));</span></div><div class='line'><span style=\"color: #F07178;\">        </span><span style=\"color: #C792EA;\">double</span><span style=\"color: #F07178;\"> x_acc </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #F07178;\"> temp </span><span style=\"color: #89DDFF;\">-</span><span style=\"color: #F07178;\"> polemass_length </span><span style=\"color: #89DDFF;\">*</span><span style=\"color: #F07178;\"> theta_acc </span><span style=\"color: #89DDFF;\">*</span><span style=\"color: #F07178;\"> costheta </span><span style=\"color: #89DDFF;\">/</span><span style=\"color: #F07178;\"> total_mass</span><span style=\"color: #89DDFF;\">;</span></div><div class='line'>&nbsp;</div><div class='line'><span style=\"color: #F07178;\">        </span><span style=\"color: #89DDFF;\">if</span><span style=\"color: #F07178;\"> </span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #F07178;\">kinematic_integrator </span><span style=\"color: #89DDFF;\">==</span><span style=\"color: #F07178;\"> </span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #C3E88D;\">euler</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #89DDFF;\">)</span></div><div class='line'><span style=\"color: #F07178;\">        </span><span style=\"color: #89DDFF;\">{</span></div><div class='line'><span style=\"color: #F07178;\">            x </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #F07178;\"> x </span><span style=\"color: #89DDFF;\">+</span><span style=\"color: #F07178;\"> tau </span><span style=\"color: #89DDFF;\">*</span><span style=\"color: #F07178;\"> x_dot</span><span style=\"color: #89DDFF;\">;</span></div><div class='line'><span style=\"color: #F07178;\">            x_dot </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #F07178;\"> x_dot </span><span style=\"color: #89DDFF;\">+</span><span style=\"color: #F07178;\"> tau </span><span style=\"color: #89DDFF;\">*</span><span style=\"color: #F07178;\"> x_acc</span><span style=\"color: #89DDFF;\">;</span></div><div class='line'><span style=\"color: #F07178;\">            theta </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #F07178;\"> theta </span><span style=\"color: #89DDFF;\">+</span><span style=\"color: #F07178;\"> tau </span><span style=\"color: #89DDFF;\">*</span><span style=\"color: #F07178;\"> theta_dot</span><span style=\"color: #89DDFF;\">;</span></div><div class='line'><span style=\"color: #F07178;\">            theta_dot </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #F07178;\"> theta_dot </span><span style=\"color: #89DDFF;\">+</span><span style=\"color: #F07178;\"> tau </span><span style=\"color: #89DDFF;\">*</span><span style=\"color: #F07178;\"> theta_acc</span><span style=\"color: #89DDFF;\">;</span></div><div class='line'><span style=\"color: #F07178;\">        </span><span style=\"color: #89DDFF;\">}</span></div><div class='line'><span style=\"color: #F07178;\">        </span><span style=\"color: #89DDFF;\">else</span><span style=\"color: #F07178;\"> </span><span style=\"color: #89DDFF;\">if</span><span style=\"color: #F07178;\"> </span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #F07178;\">kinematic_integrator </span><span style=\"color: #89DDFF;\">==</span><span style=\"color: #F07178;\"> </span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #C3E88D;\">semi-implicit-euler</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #89DDFF;\">)</span></div><div class='line'><span style=\"color: #F07178;\">        </span><span style=\"color: #89DDFF;\">{</span></div><div class='line'><span style=\"color: #F07178;\">            x_dot </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #F07178;\"> x_dot </span><span style=\"color: #89DDFF;\">+</span><span style=\"color: #F07178;\"> tau </span><span style=\"color: #89DDFF;\">*</span><span style=\"color: #F07178;\"> x_acc</span><span style=\"color: #89DDFF;\">;</span></div><div class='line'><span style=\"color: #F07178;\">            x </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #F07178;\"> x </span><span style=\"color: #89DDFF;\">+</span><span style=\"color: #F07178;\"> tau </span><span style=\"color: #89DDFF;\">*</span><span style=\"color: #F07178;\"> x_dot</span><span style=\"color: #89DDFF;\">;</span></div><div class='line'><span style=\"color: #F07178;\">            theta_dot </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #F07178;\"> theta_dot </span><span style=\"color: #89DDFF;\">+</span><span style=\"color: #F07178;\"> tau </span><span style=\"color: #89DDFF;\">*</span><span style=\"color: #F07178;\"> theta_acc</span><span style=\"color: #89DDFF;\">;</span></div><div class='line'><span style=\"color: #F07178;\">            theta </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #F07178;\"> theta </span><span style=\"color: #89DDFF;\">+</span><span style=\"color: #F07178;\"> tau </span><span style=\"color: #89DDFF;\">*</span><span style=\"color: #F07178;\"> theta_dot</span><span style=\"color: #89DDFF;\">;</span></div><div class='line'><span style=\"color: #F07178;\">        </span><span style=\"color: #89DDFF;\">}</span></div><div class='line'><span style=\"color: #F07178;\">        </span><span style=\"color: #89DDFF;\">else</span></div><div class='line'><span style=\"color: #F07178;\">        </span><span style=\"color: #89DDFF;\">{</span></div><div class='line'><span style=\"color: #F07178;\">            </span><span style=\"color: #A6ACCD;\">result</span><span style=\"color: #89DDFF;\">[</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #C3E88D;\">info</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #89DDFF;\">]</span><span style=\"color: #F07178;\"> </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #F07178;\"> </span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #C3E88D;\">unknown kinematic integrator</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #89DDFF;\">;</span></div><div class='line'><span style=\"color: #F07178;\">            </span><span style=\"color: #89DDFF;\">return</span><span style=\"color: #F07178;\"> result</span><span style=\"color: #89DDFF;\">;</span></div><div class='line'><span style=\"color: #F07178;\">        </span><span style=\"color: #89DDFF;\">}</span></div><div class='line'>&nbsp;</div><div class='line'><span style=\"color: #F07178;\">        time_step </span><span style=\"color: #89DDFF;\">++;</span></div><div class='line'><span style=\"color: #F07178;\">        </span><span style=\"color: #C792EA;\">bool</span><span style=\"color: #F07178;\"> terminated </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #F07178;\"> </span><span style=\"color: #89DDFF;\">((</span><span style=\"color: #F07178;\">x </span><span style=\"color: #89DDFF;\">&lt;</span><span style=\"color: #F07178;\"> </span><span style=\"color: #89DDFF;\">-</span><span style=\"color: #F07178;\">x_threshold</span><span style=\"color: #89DDFF;\">)</span><span style=\"color: #F07178;\"> </span><span style=\"color: #89DDFF;\">||</span><span style=\"color: #F07178;\"> </span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #F07178;\">x </span><span style=\"color: #89DDFF;\">&gt;</span><span style=\"color: #F07178;\"> x_threshold</span><span style=\"color: #89DDFF;\">)</span><span style=\"color: #F07178;\"> </span><span style=\"color: #89DDFF;\">||</span><span style=\"color: #F07178;\"> </span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #F07178;\">theta </span><span style=\"color: #89DDFF;\">&lt;</span><span style=\"color: #F07178;\"> </span><span style=\"color: #89DDFF;\">-</span><span style=\"color: #F07178;\">theta_threshold_radians</span><span style=\"color: #89DDFF;\">)</span><span style=\"color: #F07178;\"> </span><span style=\"color: #89DDFF;\">||</span><span style=\"color: #F07178;\"> </span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #F07178;\">theta </span><span style=\"color: #89DDFF;\">&gt;</span><span style=\"color: #F07178;\"> theta_threshold_radians</span><span style=\"color: #89DDFF;\">));</span></div><div class='line'><span style=\"color: #F07178;\">        </span><span style=\"color: #C792EA;\">bool</span><span style=\"color: #F07178;\"> truncated </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #F07178;\"> </span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #F07178;\">time_step </span><span style=\"color: #89DDFF;\">&gt;=</span><span style=\"color: #F07178;\"> max_steps</span><span style=\"color: #89DDFF;\">);</span></div><div class='line'>&nbsp;</div><div class='line'><span style=\"color: #F07178;\">        </span><span style=\"color: #C792EA;\">double</span><span style=\"color: #F07178;\"> reward</span><span style=\"color: #89DDFF;\">;</span></div><div class='line'><span style=\"color: #F07178;\">        </span><span style=\"color: #89DDFF;\">if</span><span style=\"color: #F07178;\"> </span><span style=\"color: #89DDFF;\">(!</span><span style=\"color: #F07178;\">terminated </span><span style=\"color: #89DDFF;\">&amp;&amp;</span><span style=\"color: #F07178;\"> </span><span style=\"color: #89DDFF;\">!</span><span style=\"color: #F07178;\">truncated</span><span style=\"color: #89DDFF;\">)</span></div><div class='line'><span style=\"color: #F07178;\">        </span><span style=\"color: #89DDFF;\">{</span></div><div class='line'><span style=\"color: #F07178;\">            reward </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #F07178;\"> </span><span style=\"color: #F78C6C;\">1.0</span><span style=\"color: #89DDFF;\">;</span></div><div class='line'><span style=\"color: #F07178;\">        </span><span style=\"color: #89DDFF;\">}</span></div><div class='line'><span style=\"color: #F07178;\">        </span><span style=\"color: #89DDFF;\">else</span><span style=\"color: #F07178;\"> </span><span style=\"color: #89DDFF;\">if</span><span style=\"color: #F07178;\"> </span><span style=\"color: #89DDFF;\">(!</span><span style=\"color: #F07178;\">steps_beyond_done</span><span style=\"color: #89DDFF;\">)</span></div><div class='line'><span style=\"color: #F07178;\">        </span><span style=\"color: #89DDFF;\">{</span></div><div class='line'><span style=\"color: #F07178;\">            </span><span style=\"color: #89DDFF;\">if</span><span style=\"color: #F07178;\"> </span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #F07178;\">terminated</span><span style=\"color: #89DDFF;\">)</span></div><div class='line'><span style=\"color: #F07178;\">            </span><span style=\"color: #89DDFF;\">{</span></div><div class='line'><span style=\"color: #F07178;\">                reward </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #F07178;\"> </span><span style=\"color: #F78C6C;\">0.0</span><span style=\"color: #89DDFF;\">;</span></div><div class='line'><span style=\"color: #F07178;\">            </span><span style=\"color: #89DDFF;\">}</span></div><div class='line'><span style=\"color: #F07178;\">            </span><span style=\"color: #89DDFF;\">else</span><span style=\"color: #F07178;\"> </span><span style=\"color: #89DDFF;\">if</span><span style=\"color: #F07178;\"> </span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #F07178;\">truncated</span><span style=\"color: #89DDFF;\">)</span></div><div class='line'><span style=\"color: #F07178;\">            </span><span style=\"color: #89DDFF;\">{</span></div><div class='line'><span style=\"color: #F07178;\">                reward </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #F07178;\"> </span><span style=\"color: #F78C6C;\">1.0</span><span style=\"color: #89DDFF;\">;</span></div><div class='line'><span style=\"color: #F07178;\">            </span><span style=\"color: #89DDFF;\">}</span></div><div class='line'><span style=\"color: #F07178;\">            steps_beyond_done </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #F07178;\"> </span><span style=\"color: #89DDFF;\">true;</span></div><div class='line'><span style=\"color: #F07178;\">        </span><span style=\"color: #89DDFF;\">}</span></div><div class='line'><span style=\"color: #F07178;\">        </span><span style=\"color: #89DDFF;\">else</span></div><div class='line'><span style=\"color: #F07178;\">        </span><span style=\"color: #89DDFF;\">{</span></div><div class='line'><span style=\"color: #F07178;\">            reward </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #F07178;\"> </span><span style=\"color: #F78C6C;\">0.0</span><span style=\"color: #89DDFF;\">;</span></div><div class='line'><span style=\"color: #F07178;\">            </span><span style=\"color: #A6ACCD;\">result</span><span style=\"color: #89DDFF;\">[</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #C3E88D;\">info</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #89DDFF;\">]</span><span style=\"color: #F07178;\"> </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #F07178;\"> </span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #C3E88D;\">You are calling &#39;step()&#39; even though this environment has already returned terminated = True. </span><span style=\"color: #89DDFF;\">&quot;</span></div><div class='line'><span style=\"color: #F07178;\">                              </span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #C3E88D;\">You should always call &#39;reset()&#39; once you receive &#39;terminated = True&#39; -- any further steps are undefined behavior.</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #89DDFF;\">;</span></div><div class='line'><span style=\"color: #F07178;\">        </span><span style=\"color: #89DDFF;\">}</span></div><div class='line'>&nbsp;</div><div class='line'><span style=\"color: #F07178;\">        </span><span style=\"color: #A6ACCD;\">result</span><span style=\"color: #89DDFF;\">[</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #C3E88D;\">observation</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #89DDFF;\">]</span><span style=\"color: #F07178;\"> </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #F07178;\"> </span><span style=\"color: #FFCB6B;\">py</span><span style=\"color: #89DDFF;\">::</span><span style=\"color: #82AAFF;\">make_tuple</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #F07178;\">x</span><span style=\"color: #89DDFF;\">,</span><span style=\"color: #F07178;\"> x_dot</span><span style=\"color: #89DDFF;\">,</span><span style=\"color: #F07178;\"> theta</span><span style=\"color: #89DDFF;\">,</span><span style=\"color: #F07178;\"> theta_dot</span><span style=\"color: #89DDFF;\">);</span></div><div class='line'><span style=\"color: #F07178;\">        </span><span style=\"color: #A6ACCD;\">result</span><span style=\"color: #89DDFF;\">[</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #C3E88D;\">reward</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #89DDFF;\">]</span><span style=\"color: #F07178;\"> </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #F07178;\"> reward</span><span style=\"color: #89DDFF;\">;</span></div><div class='line'><span style=\"color: #F07178;\">        </span><span style=\"color: #A6ACCD;\">result</span><span style=\"color: #89DDFF;\">[</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #C3E88D;\">terminated</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #89DDFF;\">]</span><span style=\"color: #F07178;\"> </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #F07178;\"> terminated</span><span style=\"color: #89DDFF;\">;</span></div><div class='line'><span style=\"color: #F07178;\">        </span><span style=\"color: #A6ACCD;\">result</span><span style=\"color: #89DDFF;\">[</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #C3E88D;\">truncated</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #89DDFF;\">]</span><span style=\"color: #F07178;\"> </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #F07178;\"> truncated</span><span style=\"color: #89DDFF;\">;</span></div><div class='line'>&nbsp;</div><div class='line'><span style=\"color: #F07178;\">        </span><span style=\"color: #89DDFF;\">if</span><span style=\"color: #F07178;\"> </span><span style=\"color: #89DDFF;\">(!</span><span style=\"color: #A6ACCD;\">result</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #82AAFF;\">contains</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #C3E88D;\">info</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #89DDFF;\">))</span></div><div class='line'><span style=\"color: #F07178;\">        </span><span style=\"color: #89DDFF;\">{</span></div><div class='line'><span style=\"color: #F07178;\">            </span><span style=\"color: #A6ACCD;\">result</span><span style=\"color: #89DDFF;\">[</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #C3E88D;\">info</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #89DDFF;\">]</span><span style=\"color: #F07178;\"> </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #F07178;\"> </span><span style=\"color: #89DDFF;\">&quot;&quot;</span><span style=\"color: #89DDFF;\">;</span></div><div class='line'><span style=\"color: #F07178;\">        </span><span style=\"color: #89DDFF;\">}</span></div><div class='line'>&nbsp;</div><div class='line'><span style=\"color: #F07178;\">        </span><span style=\"color: #89DDFF;\">return</span><span style=\"color: #F07178;\"> result</span><span style=\"color: #89DDFF;\">;</span></div><div class='line'><span style=\"color: #F07178;\">    </span><span style=\"color: #89DDFF;\">}</span></div><div class='line'><span style=\"color: #89DDFF;\">};</span></div>","classes":"torchlight","styles":"background-color: #292D3E; --theme-selection-background: #00000080;"}}
