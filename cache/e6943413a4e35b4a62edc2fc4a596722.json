{"expires":1743604763.237,"value":{"highlighted":"<!-- Syntax highlighted by torchlight.dev --><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">  1</span><span style=\"color: #D73A49;\">def</span><span style=\"color: #24292E;\"> </span><span style=\"color: #6F42C1;\">main</span><span style=\"color: #24292E;\">():</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">  2</span><span style=\"color: #24292E;\">    parser </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> argparse.ArgumentParser()</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">  3</span><span style=\"color: #24292E;\">    parser.add_argument(</span><span style=\"color: #032F62;\">&quot;--seed&quot;</span><span style=\"color: #24292E;\">, </span><span style=\"color: #E36209;\">type</span><span style=\"color: #D73A49;\">=</span><span style=\"color: #005CC5;\">int</span><span style=\"color: #24292E;\">, </span><span style=\"color: #E36209;\">default</span><span style=\"color: #D73A49;\">=</span><span style=\"color: #005CC5;\">0</span><span style=\"color: #24292E;\">,</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">  4</span><span style=\"color: #24292E;\">                        </span><span style=\"color: #E36209;\">help</span><span style=\"color: #D73A49;\">=</span><span style=\"color: #032F62;\">&quot;random seed of the experiment&quot;</span><span style=\"color: #24292E;\">)</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">  5</span><span style=\"color: #24292E;\">    parser.add_argument(</span><span style=\"color: #032F62;\">&quot;--num_steps&quot;</span><span style=\"color: #24292E;\">, </span><span style=\"color: #E36209;\">type</span><span style=\"color: #D73A49;\">=</span><span style=\"color: #005CC5;\">int</span><span style=\"color: #24292E;\">, </span><span style=\"color: #E36209;\">default</span><span style=\"color: #D73A49;\">=</span><span style=\"color: #005CC5;\">1024</span><span style=\"color: #24292E;\">,</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">  6</span><span style=\"color: #24292E;\">                        </span><span style=\"color: #E36209;\">help</span><span style=\"color: #D73A49;\">=</span><span style=\"color: #032F62;\">&quot;the number of steps to run per policy rollout&quot;</span><span style=\"color: #24292E;\">)</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">  7</span><span style=\"color: #24292E;\">    parser.add_argument(</span><span style=\"color: #032F62;\">&quot;--total_timesteps&quot;</span><span style=\"color: #24292E;\">, </span><span style=\"color: #E36209;\">type</span><span style=\"color: #D73A49;\">=</span><span style=\"color: #005CC5;\">int</span><span style=\"color: #24292E;\">, </span><span style=\"color: #E36209;\">default</span><span style=\"color: #D73A49;\">=</span><span style=\"color: #005CC5;\">300_000</span><span style=\"color: #24292E;\">,</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">  8</span><span style=\"color: #24292E;\">                        </span><span style=\"color: #E36209;\">help</span><span style=\"color: #D73A49;\">=</span><span style=\"color: #032F62;\">&quot;the number of iterations&quot;</span><span style=\"color: #24292E;\">)</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">  9</span><span style=\"color: #24292E;\">    parser.add_argument(</span><span style=\"color: #032F62;\">&quot;--batch_size&quot;</span><span style=\"color: #24292E;\">, </span><span style=\"color: #E36209;\">type</span><span style=\"color: #D73A49;\">=</span><span style=\"color: #005CC5;\">int</span><span style=\"color: #24292E;\">, </span><span style=\"color: #E36209;\">default</span><span style=\"color: #D73A49;\">=</span><span style=\"color: #005CC5;\">256</span><span style=\"color: #24292E;\">,</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 10</span><span style=\"color: #24292E;\">                        </span><span style=\"color: #E36209;\">help</span><span style=\"color: #D73A49;\">=</span><span style=\"color: #032F62;\">&quot;the batch size of sample from the replay memory&quot;</span><span style=\"color: #24292E;\">)</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 11</span><span style=\"color: #24292E;\">    parser.add_argument(</span><span style=\"color: #032F62;\">&quot;--gamma&quot;</span><span style=\"color: #24292E;\">, </span><span style=\"color: #E36209;\">type</span><span style=\"color: #D73A49;\">=</span><span style=\"color: #005CC5;\">float</span><span style=\"color: #24292E;\">, </span><span style=\"color: #E36209;\">default</span><span style=\"color: #D73A49;\">=</span><span style=\"color: #005CC5;\">0.99</span><span style=\"color: #24292E;\">,</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 12</span><span style=\"color: #24292E;\">                        </span><span style=\"color: #E36209;\">help</span><span style=\"color: #D73A49;\">=</span><span style=\"color: #032F62;\">&quot;discount factor&quot;</span><span style=\"color: #24292E;\">)</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 13</span><span style=\"color: #24292E;\">    parser.add_argument(</span><span style=\"color: #032F62;\">&quot;--gae_lambda&quot;</span><span style=\"color: #24292E;\">, </span><span style=\"color: #E36209;\">type</span><span style=\"color: #D73A49;\">=</span><span style=\"color: #005CC5;\">float</span><span style=\"color: #24292E;\">, </span><span style=\"color: #E36209;\">default</span><span style=\"color: #D73A49;\">=</span><span style=\"color: #005CC5;\">0.95</span><span style=\"color: #24292E;\">,</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 14</span><span style=\"color: #24292E;\">                        </span><span style=\"color: #E36209;\">help</span><span style=\"color: #D73A49;\">=</span><span style=\"color: #032F62;\">&quot;lambda for the general advantage estimation&quot;</span><span style=\"color: #24292E;\">)</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 15</span><span style=\"color: #24292E;\">    parser.add_argument(</span><span style=\"color: #032F62;\">&quot;--num_minibatches&quot;</span><span style=\"color: #24292E;\">, </span><span style=\"color: #E36209;\">type</span><span style=\"color: #D73A49;\">=</span><span style=\"color: #005CC5;\">int</span><span style=\"color: #24292E;\">, </span><span style=\"color: #E36209;\">default</span><span style=\"color: #D73A49;\">=</span><span style=\"color: #005CC5;\">1</span><span style=\"color: #24292E;\">,</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 16</span><span style=\"color: #24292E;\">                        </span><span style=\"color: #E36209;\">help</span><span style=\"color: #D73A49;\">=</span><span style=\"color: #032F62;\">&quot;the number of mini-batches&quot;</span><span style=\"color: #24292E;\">)</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 17</span><span style=\"color: #24292E;\">    parser.add_argument(</span><span style=\"color: #032F62;\">&quot;--update_epochs&quot;</span><span style=\"color: #24292E;\">, </span><span style=\"color: #E36209;\">type</span><span style=\"color: #D73A49;\">=</span><span style=\"color: #005CC5;\">int</span><span style=\"color: #24292E;\">, </span><span style=\"color: #E36209;\">default</span><span style=\"color: #D73A49;\">=</span><span style=\"color: #005CC5;\">20</span><span style=\"color: #24292E;\">,</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 18</span><span style=\"color: #24292E;\">                        </span><span style=\"color: #E36209;\">help</span><span style=\"color: #D73A49;\">=</span><span style=\"color: #032F62;\">&quot;the K epochs to update the policy&quot;</span><span style=\"color: #24292E;\">)</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 19</span><span style=\"color: #24292E;\">    parser.add_argument(</span><span style=\"color: #032F62;\">&quot;--norm_adv&quot;</span><span style=\"color: #24292E;\">, </span><span style=\"color: #E36209;\">type</span><span style=\"color: #D73A49;\">=</span><span style=\"color: #005CC5;\">bool</span><span style=\"color: #24292E;\">, </span><span style=\"color: #E36209;\">default</span><span style=\"color: #D73A49;\">=</span><span style=\"color: #005CC5;\">True</span><span style=\"color: #24292E;\">,</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 20</span><span style=\"color: #24292E;\">                        </span><span style=\"color: #E36209;\">help</span><span style=\"color: #D73A49;\">=</span><span style=\"color: #032F62;\">&quot;Toggles advantages normalization&quot;</span><span style=\"color: #24292E;\">)</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 21</span><span style=\"color: #24292E;\">    parser.add_argument(</span><span style=\"color: #032F62;\">&quot;--clip_coef&quot;</span><span style=\"color: #24292E;\">, </span><span style=\"color: #E36209;\">type</span><span style=\"color: #D73A49;\">=</span><span style=\"color: #005CC5;\">float</span><span style=\"color: #24292E;\">, </span><span style=\"color: #E36209;\">default</span><span style=\"color: #D73A49;\">=</span><span style=\"color: #005CC5;\">0.2</span><span style=\"color: #24292E;\">,</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 22</span><span style=\"color: #24292E;\">                        </span><span style=\"color: #E36209;\">help</span><span style=\"color: #D73A49;\">=</span><span style=\"color: #032F62;\">&quot;the surrogate clipping coefficient&quot;</span><span style=\"color: #24292E;\">)</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 23</span><span style=\"color: #24292E;\">    parser.add_argument(</span><span style=\"color: #032F62;\">&quot;--clip_vloss&quot;</span><span style=\"color: #24292E;\">, </span><span style=\"color: #E36209;\">type</span><span style=\"color: #D73A49;\">=</span><span style=\"color: #005CC5;\">bool</span><span style=\"color: #24292E;\">, </span><span style=\"color: #E36209;\">default</span><span style=\"color: #D73A49;\">=</span><span style=\"color: #005CC5;\">True</span><span style=\"color: #24292E;\">,</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 24</span><span style=\"color: #24292E;\">                        </span><span style=\"color: #E36209;\">help</span><span style=\"color: #D73A49;\">=</span><span style=\"color: #032F62;\">&quot;Toggles whether or not to use a clipped loss for the value function&quot;</span><span style=\"color: #24292E;\">)</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 25</span><span style=\"color: #24292E;\">    parser.add_argument(</span><span style=\"color: #032F62;\">&quot;--ent_coef&quot;</span><span style=\"color: #24292E;\">, </span><span style=\"color: #E36209;\">type</span><span style=\"color: #D73A49;\">=</span><span style=\"color: #005CC5;\">float</span><span style=\"color: #24292E;\">, </span><span style=\"color: #E36209;\">default</span><span style=\"color: #D73A49;\">=</span><span style=\"color: #005CC5;\">0.2</span><span style=\"color: #24292E;\">,</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 26</span><span style=\"color: #24292E;\">                        </span><span style=\"color: #E36209;\">help</span><span style=\"color: #D73A49;\">=</span><span style=\"color: #032F62;\">&quot;coefficient of the entropy&quot;</span><span style=\"color: #24292E;\">)</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 27</span><span style=\"color: #24292E;\">    parser.add_argument(</span><span style=\"color: #032F62;\">&quot;--vf_coef&quot;</span><span style=\"color: #24292E;\">, </span><span style=\"color: #E36209;\">type</span><span style=\"color: #D73A49;\">=</span><span style=\"color: #005CC5;\">float</span><span style=\"color: #24292E;\">, </span><span style=\"color: #E36209;\">default</span><span style=\"color: #D73A49;\">=</span><span style=\"color: #005CC5;\">2</span><span style=\"color: #24292E;\">.,</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 28</span><span style=\"color: #24292E;\">                        </span><span style=\"color: #E36209;\">help</span><span style=\"color: #D73A49;\">=</span><span style=\"color: #032F62;\">&quot;coefficient of the value function&quot;</span><span style=\"color: #24292E;\">)</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 29</span><span style=\"color: #24292E;\">    parser.add_argument(</span><span style=\"color: #032F62;\">&quot;--max_grad_norm&quot;</span><span style=\"color: #24292E;\">, </span><span style=\"color: #E36209;\">type</span><span style=\"color: #D73A49;\">=</span><span style=\"color: #005CC5;\">float</span><span style=\"color: #24292E;\">, </span><span style=\"color: #E36209;\">default</span><span style=\"color: #D73A49;\">=</span><span style=\"color: #005CC5;\">0.5</span><span style=\"color: #24292E;\">,</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 30</span><span style=\"color: #24292E;\">                        </span><span style=\"color: #E36209;\">help</span><span style=\"color: #D73A49;\">=</span><span style=\"color: #032F62;\">&quot;the maximum norm for the gradient clipping&quot;</span><span style=\"color: #24292E;\">)</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 31</span><span style=\"color: #24292E;\">    parser.add_argument(</span><span style=\"color: #032F62;\">&quot;--target_kl&quot;</span><span style=\"color: #24292E;\">, </span><span style=\"color: #E36209;\">type</span><span style=\"color: #D73A49;\">=</span><span style=\"color: #005CC5;\">float</span><span style=\"color: #24292E;\">, </span><span style=\"color: #E36209;\">default</span><span style=\"color: #D73A49;\">=</span><span style=\"color: #005CC5;\">None</span><span style=\"color: #24292E;\">,</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 32</span><span style=\"color: #24292E;\">                        </span><span style=\"color: #E36209;\">help</span><span style=\"color: #D73A49;\">=</span><span style=\"color: #032F62;\">&quot;the target KL divergence threshold&quot;</span><span style=\"color: #24292E;\">)</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 33</span>&nbsp;</div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 34</span><span style=\"color: #24292E;\">    parser.add_argument(</span><span style=\"color: #032F62;\">&quot;--learning_rate&quot;</span><span style=\"color: #24292E;\">, </span><span style=\"color: #E36209;\">type</span><span style=\"color: #D73A49;\">=</span><span style=\"color: #005CC5;\">float</span><span style=\"color: #24292E;\">, </span><span style=\"color: #E36209;\">default</span><span style=\"color: #D73A49;\">=</span><span style=\"color: #005CC5;\">1e-4</span><span style=\"color: #24292E;\">,</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 35</span><span style=\"color: #24292E;\">                        </span><span style=\"color: #E36209;\">help</span><span style=\"color: #D73A49;\">=</span><span style=\"color: #032F62;\">&quot;learning rate&quot;</span><span style=\"color: #24292E;\">)</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 36</span><span style=\"color: #24292E;\">    parser.add_argument(</span><span style=\"color: #032F62;\">&quot;--device&quot;</span><span style=\"color: #24292E;\">, </span><span style=\"color: #E36209;\">type</span><span style=\"color: #D73A49;\">=</span><span style=\"color: #005CC5;\">str</span><span style=\"color: #24292E;\">, </span><span style=\"color: #E36209;\">default</span><span style=\"color: #D73A49;\">=</span><span style=\"color: #032F62;\">&quot;cuda&quot;</span><span style=\"color: #24292E;\"> </span><span style=\"color: #D73A49;\">if</span><span style=\"color: #24292E;\"> torch.cuda.is_available() </span><span style=\"color: #D73A49;\">else</span><span style=\"color: #24292E;\"> </span><span style=\"color: #032F62;\">&quot;cpu&quot;</span><span style=\"color: #24292E;\">,</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 37</span><span style=\"color: #24292E;\">                        </span><span style=\"color: #E36209;\">help</span><span style=\"color: #D73A49;\">=</span><span style=\"color: #032F62;\">&quot;Device to run the experiment on&quot;</span><span style=\"color: #24292E;\">)</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 38</span><span style=\"color: #24292E;\">    args </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> parser.parse_args()</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 39</span>&nbsp;</div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 40</span><span style=\"color: #24292E;\">    args.batch_size </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> args.num_steps</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 41</span><span style=\"color: #24292E;\">    args.minibatch_size </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> </span><span style=\"color: #005CC5;\">int</span><span style=\"color: #24292E;\">(args.batch_size </span><span style=\"color: #D73A49;\">//</span><span style=\"color: #24292E;\"> args.num_minibatches)</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 42</span><span style=\"color: #24292E;\">    args.num_iterations </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> args.total_timesteps </span><span style=\"color: #D73A49;\">//</span><span style=\"color: #24292E;\"> args.batch_size</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 43</span>&nbsp;</div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 44</span><span style=\"color: #24292E;\">    random.seed(args.seed)</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 45</span><span style=\"color: #24292E;\">    np.random.seed(args.seed)</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 46</span><span style=\"color: #24292E;\">    torch.manual_seed(args.seed)</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 47</span><span style=\"color: #24292E;\">    torch.backends.cudnn.deterministic </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> </span><span style=\"color: #005CC5;\">True</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 48</span>&nbsp;</div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 49</span><span style=\"color: #24292E;\">    device </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> torch.device(args.device)</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 50</span><span style=\"color: #24292E;\">    </span><span style=\"color: #005CC5;\">print</span><span style=\"color: #24292E;\">(</span><span style=\"color: #D73A49;\">f</span><span style=\"color: #032F62;\">&quot;Using device: </span><span style=\"color: #005CC5;\">{</span><span style=\"color: #24292E;\">device</span><span style=\"color: #005CC5;\">}</span><span style=\"color: #032F62;\">&quot;</span><span style=\"color: #24292E;\">)</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 51</span>&nbsp;</div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 52</span><span style=\"color: #24292E;\">    env </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> aerodrome.make(</span><span style=\"color: #032F62;\">&quot;wingedcone-v0&quot;</span><span style=\"color: #24292E;\">)</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 53</span><span style=\"color: #24292E;\">    object_dict </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> {</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 54</span><span style=\"color: #24292E;\">        </span><span style=\"color: #032F62;\">&quot;name&quot;</span><span style=\"color: #24292E;\">: </span><span style=\"color: #032F62;\">&quot;test&quot;</span><span style=\"color: #24292E;\">,</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 55</span><span style=\"color: #24292E;\">        </span><span style=\"color: #032F62;\">&quot;integrator&quot;</span><span style=\"color: #24292E;\">: </span><span style=\"color: #032F62;\">&quot;rk45&quot;</span><span style=\"color: #24292E;\">,</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 56</span><span style=\"color: #24292E;\">        </span><span style=\"color: #032F62;\">&quot;S&quot;</span><span style=\"color: #24292E;\">: </span><span style=\"color: #005CC5;\">3603.0</span><span style=\"color: #24292E;\">,</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 57</span><span style=\"color: #24292E;\">        </span><span style=\"color: #032F62;\">&quot;c&quot;</span><span style=\"color: #24292E;\">: </span><span style=\"color: #005CC5;\">80.0</span><span style=\"color: #24292E;\">,</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 58</span><span style=\"color: #24292E;\">        </span><span style=\"color: #032F62;\">&quot;m&quot;</span><span style=\"color: #24292E;\">: </span><span style=\"color: #005CC5;\">9375.0</span><span style=\"color: #24292E;\">,</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 59</span>&nbsp;</div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 60</span><span style=\"color: #24292E;\">        </span><span style=\"color: #032F62;\">&quot;pos&quot;</span><span style=\"color: #24292E;\">: [</span><span style=\"color: #005CC5;\">0.0</span><span style=\"color: #24292E;\">, </span><span style=\"color: #005CC5;\">33528.0</span><span style=\"color: #24292E;\">, </span><span style=\"color: #005CC5;\">0.0</span><span style=\"color: #24292E;\">],</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 61</span><span style=\"color: #24292E;\">        </span><span style=\"color: #032F62;\">&quot;vel&quot;</span><span style=\"color: #24292E;\">: [</span><span style=\"color: #005CC5;\">4590.29</span><span style=\"color: #24292E;\">, </span><span style=\"color: #005CC5;\">0.0</span><span style=\"color: #24292E;\">, </span><span style=\"color: #005CC5;\">0.0</span><span style=\"color: #24292E;\">],</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 62</span><span style=\"color: #24292E;\">        </span><span style=\"color: #032F62;\">&quot;ang_vel&quot;</span><span style=\"color: #24292E;\">: [</span><span style=\"color: #005CC5;\">0.0</span><span style=\"color: #24292E;\">, </span><span style=\"color: #005CC5;\">0.0</span><span style=\"color: #24292E;\">, </span><span style=\"color: #005CC5;\">0.0</span><span style=\"color: #24292E;\">],</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 63</span><span style=\"color: #24292E;\">        </span><span style=\"color: #032F62;\">&quot;J&quot;</span><span style=\"color: #24292E;\">: [</span><span style=\"color: #005CC5;\">1.0</span><span style=\"color: #24292E;\">, </span><span style=\"color: #005CC5;\">7</span><span style=\"color: #D73A49;\">*</span><span style=\"color: #005CC5;\">10</span><span style=\"color: #D73A49;\">**</span><span style=\"color: #005CC5;\">6</span><span style=\"color: #24292E;\">, </span><span style=\"color: #005CC5;\">7</span><span style=\"color: #D73A49;\">*</span><span style=\"color: #005CC5;\">10</span><span style=\"color: #D73A49;\">**</span><span style=\"color: #005CC5;\">6</span><span style=\"color: #24292E;\">],</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 64</span><span style=\"color: #24292E;\">        </span><span style=\"color: #032F62;\">&quot;theta&quot;</span><span style=\"color: #24292E;\">: </span><span style=\"color: #005CC5;\">0.00</span><span style=\"color: #D73A49;\">/</span><span style=\"color: #005CC5;\">180</span><span style=\"color: #D73A49;\">*</span><span style=\"color: #24292E;\">pi,</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 65</span><span style=\"color: #24292E;\">        </span><span style=\"color: #032F62;\">&quot;phi&quot;</span><span style=\"color: #24292E;\">: </span><span style=\"color: #005CC5;\">0.0</span><span style=\"color: #24292E;\">,</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 66</span><span style=\"color: #24292E;\">        </span><span style=\"color: #032F62;\">&quot;gamma&quot;</span><span style=\"color: #24292E;\">: </span><span style=\"color: #005CC5;\">0.0</span><span style=\"color: #24292E;\">,   </span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 67</span><span style=\"color: #24292E;\">        </span><span style=\"color: #032F62;\">&quot;theta_v&quot;</span><span style=\"color: #24292E;\">: </span><span style=\"color: #005CC5;\">0.0</span><span style=\"color: #24292E;\">,</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 68</span><span style=\"color: #24292E;\">        </span><span style=\"color: #032F62;\">&quot;phi_v&quot;</span><span style=\"color: #24292E;\">: </span><span style=\"color: #005CC5;\">0.0</span><span style=\"color: #24292E;\">,</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 69</span><span style=\"color: #24292E;\">        </span><span style=\"color: #032F62;\">&quot;gamma_v&quot;</span><span style=\"color: #24292E;\">: </span><span style=\"color: #005CC5;\">0.0</span><span style=\"color: #24292E;\">,</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 70</span><span style=\"color: #24292E;\">        </span><span style=\"color: #032F62;\">&quot;alpha&quot;</span><span style=\"color: #24292E;\">: </span><span style=\"color: #005CC5;\">0.00</span><span style=\"color: #D73A49;\">/</span><span style=\"color: #005CC5;\">180</span><span style=\"color: #D73A49;\">*</span><span style=\"color: #24292E;\">pi,</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 71</span><span style=\"color: #24292E;\">        </span><span style=\"color: #032F62;\">&quot;beta&quot;</span><span style=\"color: #24292E;\">: </span><span style=\"color: #005CC5;\">0.0</span><span style=\"color: #24292E;\">,</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 72</span>&nbsp;</div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 73</span><span style=\"color: #24292E;\">        </span><span style=\"color: #032F62;\">&quot;Kiz&quot;</span><span style=\"color: #24292E;\">: </span><span style=\"color: #005CC5;\">0.2597</span><span style=\"color: #24292E;\">,</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 74</span><span style=\"color: #24292E;\">        </span><span style=\"color: #032F62;\">&quot;Kwz&quot;</span><span style=\"color: #24292E;\">: </span><span style=\"color: #005CC5;\">1.6</span><span style=\"color: #24292E;\">,</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 75</span><span style=\"color: #24292E;\">        </span><span style=\"color: #032F62;\">&quot;Kaz&quot;</span><span style=\"color: #24292E;\">: </span><span style=\"color: #005CC5;\">13</span><span style=\"color: #D73A49;\">/</span><span style=\"color: #005CC5;\">2</span><span style=\"color: #24292E;\">,</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 76</span><span style=\"color: #24292E;\">        </span><span style=\"color: #032F62;\">&quot;Kpz&quot;</span><span style=\"color: #24292E;\">: </span><span style=\"color: #005CC5;\">0.14</span><span style=\"color: #24292E;\">,</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 77</span><span style=\"color: #24292E;\">        </span><span style=\"color: #032F62;\">&quot;Kp_V&quot;</span><span style=\"color: #24292E;\">: </span><span style=\"color: #005CC5;\">5.0</span><span style=\"color: #24292E;\">,</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 78</span><span style=\"color: #24292E;\">        </span><span style=\"color: #032F62;\">&quot;Ki_V&quot;</span><span style=\"color: #24292E;\">: </span><span style=\"color: #005CC5;\">1.0</span><span style=\"color: #24292E;\">,</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 79</span><span style=\"color: #24292E;\">        </span><span style=\"color: #032F62;\">&quot;Kd_V&quot;</span><span style=\"color: #24292E;\">: </span><span style=\"color: #005CC5;\">0.3</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 80</span><span style=\"color: #24292E;\">    }</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 81</span>&nbsp;</div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 82</span><span style=\"color: #24292E;\">    </span><span style=\"color: #005CC5;\">object</span><span style=\"color: #24292E;\"> </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> WingedCone2D_RL(object_dict)</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 83</span><span style=\"color: #24292E;\">    env.add_object(</span><span style=\"color: #005CC5;\">object</span><span style=\"color: #24292E;\">)</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 84</span>&nbsp;</div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 85</span><span style=\"color: #24292E;\">    agent </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> Agent().to(device)</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 86</span><span style=\"color: #24292E;\">    optimizer </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> optim.Adam(agent.parameters(), </span><span style=\"color: #E36209;\">lr</span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\">args.learning_rate, </span><span style=\"color: #E36209;\">eps</span><span style=\"color: #D73A49;\">=</span><span style=\"color: #005CC5;\">1e-5</span><span style=\"color: #24292E;\">)</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 87</span><span style=\"color: #24292E;\">    cos_annealing_scheduler </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> CosineAnnealingLR(optimizer, </span><span style=\"color: #E36209;\">T_max</span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\">args.num_iterations, </span><span style=\"color: #E36209;\">eta_min</span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\">args.learning_rate</span><span style=\"color: #D73A49;\">/</span><span style=\"color: #005CC5;\">10</span><span style=\"color: #24292E;\">)</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 88</span>&nbsp;</div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 89</span><span style=\"color: #24292E;\">    </span><span style=\"color: #6A737D;\"># Storage setup</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 90</span><span style=\"color: #24292E;\">    obs </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> torch.zeros((args.num_steps, </span><span style=\"color: #005CC5;\">3</span><span style=\"color: #24292E;\">)).to(device)</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 91</span><span style=\"color: #24292E;\">    actions </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> torch.zeros((args.num_steps, </span><span style=\"color: #005CC5;\">1</span><span style=\"color: #24292E;\">)).to(device)</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 92</span><span style=\"color: #24292E;\">    logprobs </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> torch.zeros((args.num_steps, </span><span style=\"color: #005CC5;\">1</span><span style=\"color: #24292E;\">)).to(device)</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 93</span><span style=\"color: #24292E;\">    rewards </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> torch.zeros((args.num_steps, </span><span style=\"color: #005CC5;\">1</span><span style=\"color: #24292E;\">)).to(device)</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 94</span><span style=\"color: #24292E;\">    dones </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> torch.zeros((args.num_steps, </span><span style=\"color: #005CC5;\">1</span><span style=\"color: #24292E;\">)).to(device)</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 95</span><span style=\"color: #24292E;\">    values </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> torch.zeros((args.num_steps, </span><span style=\"color: #005CC5;\">1</span><span style=\"color: #24292E;\">)).to(device)</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 96</span>&nbsp;</div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 97</span><span style=\"color: #24292E;\">    global_step </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> </span><span style=\"color: #005CC5;\">0</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 98</span>&nbsp;</div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 99</span><span style=\"color: #24292E;\">    records </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> {</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">100</span><span style=\"color: #24292E;\">        </span><span style=\"color: #032F62;\">&quot;reward&quot;</span><span style=\"color: #24292E;\">: np.zeros(args.num_iterations),</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">101</span><span style=\"color: #24292E;\">        </span><span style=\"color: #032F62;\">&quot;learning_rate&quot;</span><span style=\"color: #24292E;\">: np.zeros(args.num_iterations),</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">102</span><span style=\"color: #24292E;\">        </span><span style=\"color: #032F62;\">&quot;value_loss&quot;</span><span style=\"color: #24292E;\">: np.zeros(args.num_iterations),</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">103</span><span style=\"color: #24292E;\">        </span><span style=\"color: #032F62;\">&quot;policy_loss&quot;</span><span style=\"color: #24292E;\">: np.zeros(args.num_iterations),</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">104</span><span style=\"color: #24292E;\">        </span><span style=\"color: #032F62;\">&quot;entropy&quot;</span><span style=\"color: #24292E;\">: np.zeros(args.num_iterations),</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">105</span><span style=\"color: #24292E;\">    }</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">106</span>&nbsp;</div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">107</span><span style=\"color: #24292E;\">    </span><span style=\"color: #D73A49;\">for</span><span style=\"color: #24292E;\"> iteration </span><span style=\"color: #D73A49;\">in</span><span style=\"color: #24292E;\"> tqdm(</span><span style=\"color: #005CC5;\">range</span><span style=\"color: #24292E;\">(</span><span style=\"color: #005CC5;\">1</span><span style=\"color: #24292E;\">, args.num_iterations </span><span style=\"color: #D73A49;\">+</span><span style=\"color: #24292E;\"> </span><span style=\"color: #005CC5;\">1</span><span style=\"color: #24292E;\">)):</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">108</span><span style=\"color: #24292E;\">        env </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> aerodrome.make(</span><span style=\"color: #032F62;\">&quot;wingedcone-v0&quot;</span><span style=\"color: #24292E;\">)</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">109</span><span style=\"color: #24292E;\">        </span><span style=\"color: #005CC5;\">object</span><span style=\"color: #24292E;\"> </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> WingedCone2D_RL(object_dict)</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">110</span><span style=\"color: #24292E;\">        env.add_object(</span><span style=\"color: #005CC5;\">object</span><span style=\"color: #24292E;\">)</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">111</span>&nbsp;</div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">112</span><span style=\"color: #24292E;\">        next_obs, info </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> env.reset()</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">113</span><span style=\"color: #24292E;\">        next_obs </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> torch.Tensor(next_obs).reshape((</span><span style=\"color: #005CC5;\">1</span><span style=\"color: #24292E;\">, </span><span style=\"color: #D73A49;\">-</span><span style=\"color: #005CC5;\">1</span><span style=\"color: #24292E;\">)).to(device)</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">114</span><span style=\"color: #24292E;\">        first_rollout </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> </span><span style=\"color: #005CC5;\">True</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">115</span><span style=\"color: #24292E;\">        rollout_return </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> </span><span style=\"color: #005CC5;\">0.0</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">116</span><span style=\"color: #24292E;\">        </span><span style=\"color: #D73A49;\">for</span><span style=\"color: #24292E;\"> step </span><span style=\"color: #D73A49;\">in</span><span style=\"color: #24292E;\"> </span><span style=\"color: #005CC5;\">range</span><span style=\"color: #24292E;\">(</span><span style=\"color: #005CC5;\">0</span><span style=\"color: #24292E;\">, args.num_steps):</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">117</span><span style=\"color: #24292E;\">            global_step </span><span style=\"color: #D73A49;\">+=</span><span style=\"color: #24292E;\"> </span><span style=\"color: #005CC5;\">1</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">118</span><span style=\"color: #24292E;\">            obs[step] </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> next_obs</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">119</span>&nbsp;</div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">120</span><span style=\"color: #24292E;\">            </span><span style=\"color: #6A737D;\"># ALGO LOGIC: action logic</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">121</span><span style=\"color: #24292E;\">            </span><span style=\"color: #D73A49;\">with</span><span style=\"color: #24292E;\"> torch.no_grad():</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">122</span><span style=\"color: #24292E;\">                action, logprob, _, value </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> agent.get_action_and_value(next_obs)</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">123</span><span style=\"color: #24292E;\">                values[step] </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> value.flatten()</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">124</span><span style=\"color: #24292E;\">            actions[step] </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> action</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">125</span><span style=\"color: #24292E;\">            logprobs[step] </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> logprob</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">126</span>&nbsp;</div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">127</span><span style=\"color: #24292E;\">            </span><span style=\"color: #6A737D;\"># TRY NOT TO MODIFY: execute the game and log data.</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">128</span><span style=\"color: #24292E;\">            step_action </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> {</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">129</span><span style=\"color: #24292E;\">                </span><span style=\"color: #032F62;\">&quot;test&quot;</span><span style=\"color: #24292E;\">: {</span><span style=\"color: #032F62;\">&quot;Nyc&quot;</span><span style=\"color: #24292E;\">:</span><span style=\"color: #005CC5;\">1.0</span><span style=\"color: #24292E;\">, </span><span style=\"color: #032F62;\">&quot;Vc&quot;</span><span style=\"color: #24292E;\">:</span><span style=\"color: #005CC5;\">4590.29</span><span style=\"color: #24292E;\">, </span><span style=\"color: #032F62;\">&quot;nn_control&quot;</span><span style=\"color: #24292E;\">:action.item()},</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">130</span><span style=\"color: #24292E;\">            }</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">131</span><span style=\"color: #24292E;\">            next_obs, reward, terminations, truncations, infos </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> env.step(step_action)</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">132</span><span style=\"color: #24292E;\">            next_done </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> np.logical_or(terminations, truncations)</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">133</span><span style=\"color: #24292E;\">            rewards[step] </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> torch.tensor(reward).to(device).view(</span><span style=\"color: #D73A49;\">-</span><span style=\"color: #005CC5;\">1</span><span style=\"color: #24292E;\">)</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">134</span><span style=\"color: #24292E;\">            next_obs, next_done </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> torch.Tensor(next_obs).reshape((</span><span style=\"color: #005CC5;\">1</span><span style=\"color: #24292E;\">, </span><span style=\"color: #D73A49;\">-</span><span style=\"color: #005CC5;\">1</span><span style=\"color: #24292E;\">)).to(device), torch.Tensor(next_done).reshape((</span><span style=\"color: #005CC5;\">1</span><span style=\"color: #24292E;\">, </span><span style=\"color: #D73A49;\">-</span><span style=\"color: #005CC5;\">1</span><span style=\"color: #24292E;\">)).to(device)</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">135</span>&nbsp;</div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">136</span><span style=\"color: #24292E;\">            dones[step] </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> next_done</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">137</span>&nbsp;</div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">138</span><span style=\"color: #24292E;\">            </span><span style=\"color: #D73A49;\">if</span><span style=\"color: #24292E;\"> first_rollout:</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">139</span><span style=\"color: #24292E;\">                rollout_return </span><span style=\"color: #D73A49;\">+=</span><span style=\"color: #24292E;\"> reward</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">140</span><span style=\"color: #24292E;\">                </span><span style=\"color: #D73A49;\">if</span><span style=\"color: #24292E;\"> next_done </span><span style=\"color: #D73A49;\">or</span><span style=\"color: #24292E;\"> step </span><span style=\"color: #D73A49;\">==</span><span style=\"color: #24292E;\"> args.num_steps </span><span style=\"color: #D73A49;\">-</span><span style=\"color: #24292E;\"> </span><span style=\"color: #005CC5;\">1</span><span style=\"color: #24292E;\">:</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">141</span><span style=\"color: #24292E;\">                    first_rollout </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> </span><span style=\"color: #005CC5;\">False</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">142</span><span style=\"color: #24292E;\">                    rewards[step] </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> rollout_return</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">143</span>&nbsp;</div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">144</span><span style=\"color: #24292E;\">            </span><span style=\"color: #D73A49;\">if</span><span style=\"color: #24292E;\"> next_done:</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">145</span><span style=\"color: #24292E;\">                env </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> aerodrome.make(</span><span style=\"color: #032F62;\">&quot;wingedcone-v0&quot;</span><span style=\"color: #24292E;\">)</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">146</span><span style=\"color: #24292E;\">                </span><span style=\"color: #005CC5;\">object</span><span style=\"color: #24292E;\"> </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> WingedCone2D_RL(object_dict)</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">147</span><span style=\"color: #24292E;\">                env.add_object(</span><span style=\"color: #005CC5;\">object</span><span style=\"color: #24292E;\">)</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">148</span>&nbsp;</div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">149</span><span style=\"color: #24292E;\">                next_obs, info </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> env.reset()</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">150</span><span style=\"color: #24292E;\">                next_obs </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> torch.Tensor(next_obs).to(device)</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">151</span>&nbsp;</div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">152</span><span style=\"color: #24292E;\">        </span><span style=\"color: #6A737D;\"># bootstrap value if not done</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">153</span><span style=\"color: #24292E;\">        </span><span style=\"color: #D73A49;\">with</span><span style=\"color: #24292E;\"> torch.no_grad():</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">154</span><span style=\"color: #24292E;\">            next_value </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> agent.get_value(next_obs).reshape(</span><span style=\"color: #005CC5;\">1</span><span style=\"color: #24292E;\">, </span><span style=\"color: #D73A49;\">-</span><span style=\"color: #005CC5;\">1</span><span style=\"color: #24292E;\">)</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">155</span><span style=\"color: #24292E;\">            advantages </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> torch.zeros_like(rewards).to(device)</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">156</span><span style=\"color: #24292E;\">            lastgaelam </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> </span><span style=\"color: #005CC5;\">0</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">157</span><span style=\"color: #24292E;\">            </span><span style=\"color: #D73A49;\">for</span><span style=\"color: #24292E;\"> t </span><span style=\"color: #D73A49;\">in</span><span style=\"color: #24292E;\"> </span><span style=\"color: #005CC5;\">reversed</span><span style=\"color: #24292E;\">(</span><span style=\"color: #005CC5;\">range</span><span style=\"color: #24292E;\">(args.num_steps)):</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">158</span><span style=\"color: #24292E;\">                </span><span style=\"color: #D73A49;\">if</span><span style=\"color: #24292E;\"> t </span><span style=\"color: #D73A49;\">==</span><span style=\"color: #24292E;\"> args.num_steps </span><span style=\"color: #D73A49;\">-</span><span style=\"color: #24292E;\"> </span><span style=\"color: #005CC5;\">1</span><span style=\"color: #24292E;\">:</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">159</span><span style=\"color: #24292E;\">                    nextnonterminal </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> </span><span style=\"color: #005CC5;\">1.0</span><span style=\"color: #24292E;\"> </span><span style=\"color: #D73A49;\">-</span><span style=\"color: #24292E;\"> next_done</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">160</span><span style=\"color: #24292E;\">                    nextvalues </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> next_value</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">161</span><span style=\"color: #24292E;\">                </span><span style=\"color: #D73A49;\">else</span><span style=\"color: #24292E;\">:</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">162</span><span style=\"color: #24292E;\">                    nextnonterminal </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> </span><span style=\"color: #005CC5;\">1.0</span><span style=\"color: #24292E;\"> </span><span style=\"color: #D73A49;\">-</span><span style=\"color: #24292E;\"> dones[t]</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">163</span><span style=\"color: #24292E;\">                    nextvalues </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> values[t </span><span style=\"color: #D73A49;\">+</span><span style=\"color: #24292E;\"> </span><span style=\"color: #005CC5;\">1</span><span style=\"color: #24292E;\">]</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">164</span><span style=\"color: #24292E;\">                delta </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> rewards[t] </span><span style=\"color: #D73A49;\">+</span><span style=\"color: #24292E;\"> args.gamma </span><span style=\"color: #D73A49;\">*</span><span style=\"color: #24292E;\"> nextvalues </span><span style=\"color: #D73A49;\">*</span><span style=\"color: #24292E;\"> nextnonterminal </span><span style=\"color: #D73A49;\">-</span><span style=\"color: #24292E;\"> values[t]</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">165</span><span style=\"color: #24292E;\">                advantages[t] </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> lastgaelam </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> delta </span><span style=\"color: #D73A49;\">+</span><span style=\"color: #24292E;\"> args.gamma </span><span style=\"color: #D73A49;\">*</span><span style=\"color: #24292E;\"> args.gae_lambda </span><span style=\"color: #D73A49;\">*</span><span style=\"color: #24292E;\"> nextnonterminal </span><span style=\"color: #D73A49;\">*</span><span style=\"color: #24292E;\"> lastgaelam</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">166</span><span style=\"color: #24292E;\">            returns </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> advantages </span><span style=\"color: #D73A49;\">+</span><span style=\"color: #24292E;\"> values</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">167</span>&nbsp;</div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">168</span><span style=\"color: #24292E;\">        </span><span style=\"color: #6A737D;\"># flatten the batch</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">169</span><span style=\"color: #24292E;\">        b_obs </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> obs.reshape((</span><span style=\"color: #D73A49;\">-</span><span style=\"color: #005CC5;\">1</span><span style=\"color: #24292E;\">, </span><span style=\"color: #005CC5;\">3</span><span style=\"color: #24292E;\">))</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">170</span><span style=\"color: #24292E;\">        b_logprobs </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> logprobs.reshape(</span><span style=\"color: #D73A49;\">-</span><span style=\"color: #005CC5;\">1</span><span style=\"color: #24292E;\">)</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">171</span><span style=\"color: #24292E;\">        b_actions </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> actions.reshape((</span><span style=\"color: #D73A49;\">-</span><span style=\"color: #005CC5;\">1</span><span style=\"color: #24292E;\">, </span><span style=\"color: #005CC5;\">1</span><span style=\"color: #24292E;\">))</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">172</span><span style=\"color: #24292E;\">        b_advantages </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> advantages.reshape(</span><span style=\"color: #D73A49;\">-</span><span style=\"color: #005CC5;\">1</span><span style=\"color: #24292E;\">)</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">173</span><span style=\"color: #24292E;\">        b_returns </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> returns.reshape(</span><span style=\"color: #D73A49;\">-</span><span style=\"color: #005CC5;\">1</span><span style=\"color: #24292E;\">)</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">174</span><span style=\"color: #24292E;\">        b_values </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> values.reshape(</span><span style=\"color: #D73A49;\">-</span><span style=\"color: #005CC5;\">1</span><span style=\"color: #24292E;\">)</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">175</span>&nbsp;</div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">176</span><span style=\"color: #24292E;\">        </span><span style=\"color: #6A737D;\"># Optimizing the policy and value network</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">177</span><span style=\"color: #24292E;\">        b_inds </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> np.arange(args.batch_size)</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">178</span><span style=\"color: #24292E;\">        clipfracs </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> []</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">179</span><span style=\"color: #24292E;\">        </span><span style=\"color: #D73A49;\">for</span><span style=\"color: #24292E;\"> epoch </span><span style=\"color: #D73A49;\">in</span><span style=\"color: #24292E;\"> </span><span style=\"color: #005CC5;\">range</span><span style=\"color: #24292E;\">(args.update_epochs):</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">180</span><span style=\"color: #24292E;\">            np.random.shuffle(b_inds)</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">181</span><span style=\"color: #24292E;\">            </span><span style=\"color: #D73A49;\">for</span><span style=\"color: #24292E;\"> start </span><span style=\"color: #D73A49;\">in</span><span style=\"color: #24292E;\"> </span><span style=\"color: #005CC5;\">range</span><span style=\"color: #24292E;\">(</span><span style=\"color: #005CC5;\">0</span><span style=\"color: #24292E;\">, args.batch_size, args.minibatch_size):</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">182</span><span style=\"color: #24292E;\">                end </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> start </span><span style=\"color: #D73A49;\">+</span><span style=\"color: #24292E;\"> args.minibatch_size</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">183</span><span style=\"color: #24292E;\">                mb_inds </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> b_inds[start:end]</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">184</span>&nbsp;</div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">185</span><span style=\"color: #24292E;\">                _, newlogprob, entropy, newvalue </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> agent.get_action_and_value(b_obs[mb_inds], b_actions[mb_inds])</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">186</span><span style=\"color: #24292E;\">                logratio </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> newlogprob </span><span style=\"color: #D73A49;\">-</span><span style=\"color: #24292E;\"> b_logprobs[mb_inds]</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">187</span><span style=\"color: #24292E;\">                ratio </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> logratio.exp()</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">188</span>&nbsp;</div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">189</span><span style=\"color: #24292E;\">                </span><span style=\"color: #D73A49;\">with</span><span style=\"color: #24292E;\"> torch.no_grad():</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">190</span><span style=\"color: #24292E;\">                    </span><span style=\"color: #6A737D;\"># calculate approx_kl http://joschu.net/blog/kl-approx.html</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">191</span><span style=\"color: #24292E;\">                    old_approx_kl </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> (</span><span style=\"color: #D73A49;\">-</span><span style=\"color: #24292E;\">logratio).mean()</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">192</span><span style=\"color: #24292E;\">                    approx_kl </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> ((ratio </span><span style=\"color: #D73A49;\">-</span><span style=\"color: #24292E;\"> </span><span style=\"color: #005CC5;\">1</span><span style=\"color: #24292E;\">) </span><span style=\"color: #D73A49;\">-</span><span style=\"color: #24292E;\"> logratio).mean()</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">193</span><span style=\"color: #24292E;\">                    clipfracs </span><span style=\"color: #D73A49;\">+=</span><span style=\"color: #24292E;\"> [((ratio </span><span style=\"color: #D73A49;\">-</span><span style=\"color: #24292E;\"> </span><span style=\"color: #005CC5;\">1.0</span><span style=\"color: #24292E;\">).abs() </span><span style=\"color: #D73A49;\">&gt;</span><span style=\"color: #24292E;\"> args.clip_coef).float().mean().item()]</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">194</span>&nbsp;</div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">195</span><span style=\"color: #24292E;\">                mb_advantages </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> b_advantages[mb_inds]</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">196</span><span style=\"color: #24292E;\">                </span><span style=\"color: #D73A49;\">if</span><span style=\"color: #24292E;\"> args.norm_adv:</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">197</span><span style=\"color: #24292E;\">                    mb_advantages </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> (mb_advantages </span><span style=\"color: #D73A49;\">-</span><span style=\"color: #24292E;\"> mb_advantages.mean()) </span><span style=\"color: #D73A49;\">/</span><span style=\"color: #24292E;\"> (mb_advantages.std() </span><span style=\"color: #D73A49;\">+</span><span style=\"color: #24292E;\"> </span><span style=\"color: #005CC5;\">1e-8</span><span style=\"color: #24292E;\">)</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">198</span>&nbsp;</div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">199</span><span style=\"color: #24292E;\">                </span><span style=\"color: #6A737D;\"># Policy loss</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">200</span><span style=\"color: #24292E;\">                pg_loss1 </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> </span><span style=\"color: #D73A49;\">-</span><span style=\"color: #24292E;\">mb_advantages </span><span style=\"color: #D73A49;\">*</span><span style=\"color: #24292E;\"> ratio</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">201</span><span style=\"color: #24292E;\">                pg_loss2 </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> </span><span style=\"color: #D73A49;\">-</span><span style=\"color: #24292E;\">mb_advantages </span><span style=\"color: #D73A49;\">*</span><span style=\"color: #24292E;\"> torch.clamp(ratio, </span><span style=\"color: #005CC5;\">1</span><span style=\"color: #24292E;\"> </span><span style=\"color: #D73A49;\">-</span><span style=\"color: #24292E;\"> args.clip_coef, </span><span style=\"color: #005CC5;\">1</span><span style=\"color: #24292E;\"> </span><span style=\"color: #D73A49;\">+</span><span style=\"color: #24292E;\"> args.clip_coef)</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">202</span><span style=\"color: #24292E;\">                pg_loss </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> torch.max(pg_loss1, pg_loss2).mean()</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">203</span>&nbsp;</div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">204</span><span style=\"color: #24292E;\">                </span><span style=\"color: #6A737D;\"># Value loss</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">205</span><span style=\"color: #24292E;\">                newvalue </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> newvalue.view(</span><span style=\"color: #D73A49;\">-</span><span style=\"color: #005CC5;\">1</span><span style=\"color: #24292E;\">)</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">206</span><span style=\"color: #24292E;\">                </span><span style=\"color: #D73A49;\">if</span><span style=\"color: #24292E;\"> args.clip_vloss:</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">207</span><span style=\"color: #24292E;\">                    v_loss_unclipped </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> (newvalue </span><span style=\"color: #D73A49;\">-</span><span style=\"color: #24292E;\"> b_returns[mb_inds]) </span><span style=\"color: #D73A49;\">**</span><span style=\"color: #24292E;\"> </span><span style=\"color: #005CC5;\">2</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">208</span><span style=\"color: #24292E;\">                    v_clipped </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> b_values[mb_inds] </span><span style=\"color: #D73A49;\">+</span><span style=\"color: #24292E;\"> torch.clamp(</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">209</span><span style=\"color: #24292E;\">                        newvalue </span><span style=\"color: #D73A49;\">-</span><span style=\"color: #24292E;\"> b_values[mb_inds],</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">210</span><span style=\"color: #24292E;\">                        </span><span style=\"color: #D73A49;\">-</span><span style=\"color: #24292E;\">args.clip_coef,</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">211</span><span style=\"color: #24292E;\">                        args.clip_coef,</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">212</span><span style=\"color: #24292E;\">                    )</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">213</span><span style=\"color: #24292E;\">                    v_loss_clipped </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> (v_clipped </span><span style=\"color: #D73A49;\">-</span><span style=\"color: #24292E;\"> b_returns[mb_inds]) </span><span style=\"color: #D73A49;\">**</span><span style=\"color: #24292E;\"> </span><span style=\"color: #005CC5;\">2</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">214</span><span style=\"color: #24292E;\">                    v_loss_max </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> torch.max(v_loss_unclipped, v_loss_clipped)</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">215</span><span style=\"color: #24292E;\">                    v_loss </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> </span><span style=\"color: #005CC5;\">0.5</span><span style=\"color: #24292E;\"> </span><span style=\"color: #D73A49;\">*</span><span style=\"color: #24292E;\"> v_loss_max.mean()</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">216</span><span style=\"color: #24292E;\">                </span><span style=\"color: #D73A49;\">else</span><span style=\"color: #24292E;\">:</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">217</span><span style=\"color: #24292E;\">                    v_loss </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> </span><span style=\"color: #005CC5;\">0.5</span><span style=\"color: #24292E;\"> </span><span style=\"color: #D73A49;\">*</span><span style=\"color: #24292E;\"> ((newvalue </span><span style=\"color: #D73A49;\">-</span><span style=\"color: #24292E;\"> b_returns[mb_inds]) </span><span style=\"color: #D73A49;\">**</span><span style=\"color: #24292E;\"> </span><span style=\"color: #005CC5;\">2</span><span style=\"color: #24292E;\">).mean()</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">218</span>&nbsp;</div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">219</span><span style=\"color: #24292E;\">                entropy_loss </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> entropy.mean()</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">220</span><span style=\"color: #24292E;\">                loss </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> pg_loss </span><span style=\"color: #D73A49;\">-</span><span style=\"color: #24292E;\"> args.ent_coef </span><span style=\"color: #D73A49;\">*</span><span style=\"color: #24292E;\"> entropy_loss </span><span style=\"color: #D73A49;\">+</span><span style=\"color: #24292E;\"> v_loss </span><span style=\"color: #D73A49;\">*</span><span style=\"color: #24292E;\"> args.vf_coef</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">221</span>&nbsp;</div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">222</span><span style=\"color: #24292E;\">                optimizer.zero_grad()</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">223</span><span style=\"color: #24292E;\">                loss.backward()</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">224</span><span style=\"color: #24292E;\">                nn.utils.clip_grad_norm_(agent.parameters(), args.max_grad_norm)</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">225</span><span style=\"color: #24292E;\">                optimizer.step()</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">226</span>&nbsp;</div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">227</span><span style=\"color: #24292E;\">            </span><span style=\"color: #D73A49;\">if</span><span style=\"color: #24292E;\"> args.target_kl </span><span style=\"color: #D73A49;\">is</span><span style=\"color: #24292E;\"> </span><span style=\"color: #D73A49;\">not</span><span style=\"color: #24292E;\"> </span><span style=\"color: #005CC5;\">None</span><span style=\"color: #24292E;\"> </span><span style=\"color: #D73A49;\">and</span><span style=\"color: #24292E;\"> approx_kl </span><span style=\"color: #D73A49;\">&gt;</span><span style=\"color: #24292E;\"> args.target_kl:</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">228</span><span style=\"color: #24292E;\">                </span><span style=\"color: #D73A49;\">break</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">229</span>&nbsp;</div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">230</span><span style=\"color: #24292E;\">        y_pred, y_true </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> b_values.cpu().numpy(), b_returns.cpu().numpy()</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">231</span><span style=\"color: #24292E;\">        var_y </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> np.var(y_true)</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">232</span><span style=\"color: #24292E;\">        explained_var </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> np.nan </span><span style=\"color: #D73A49;\">if</span><span style=\"color: #24292E;\"> var_y </span><span style=\"color: #D73A49;\">==</span><span style=\"color: #24292E;\"> </span><span style=\"color: #005CC5;\">0</span><span style=\"color: #24292E;\"> </span><span style=\"color: #D73A49;\">else</span><span style=\"color: #24292E;\"> </span><span style=\"color: #005CC5;\">1</span><span style=\"color: #24292E;\"> </span><span style=\"color: #D73A49;\">-</span><span style=\"color: #24292E;\"> np.var(y_true </span><span style=\"color: #D73A49;\">-</span><span style=\"color: #24292E;\"> y_pred) </span><span style=\"color: #D73A49;\">/</span><span style=\"color: #24292E;\"> var_y</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">233</span>&nbsp;</div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">234</span><span style=\"color: #24292E;\">        records[</span><span style=\"color: #032F62;\">&quot;reward&quot;</span><span style=\"color: #24292E;\">][iteration </span><span style=\"color: #D73A49;\">-</span><span style=\"color: #24292E;\"> </span><span style=\"color: #005CC5;\">1</span><span style=\"color: #24292E;\">] </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> rewards.sum().item()</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">235</span><span style=\"color: #24292E;\">        records[</span><span style=\"color: #032F62;\">&quot;learning_rate&quot;</span><span style=\"color: #24292E;\">][iteration </span><span style=\"color: #D73A49;\">-</span><span style=\"color: #24292E;\"> </span><span style=\"color: #005CC5;\">1</span><span style=\"color: #24292E;\">] </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> optimizer.param_groups[</span><span style=\"color: #005CC5;\">0</span><span style=\"color: #24292E;\">][</span><span style=\"color: #032F62;\">&quot;lr&quot;</span><span style=\"color: #24292E;\">]</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">236</span><span style=\"color: #24292E;\">        records[</span><span style=\"color: #032F62;\">&quot;value_loss&quot;</span><span style=\"color: #24292E;\">][iteration </span><span style=\"color: #D73A49;\">-</span><span style=\"color: #24292E;\"> </span><span style=\"color: #005CC5;\">1</span><span style=\"color: #24292E;\">] </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> v_loss.item()</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">237</span><span style=\"color: #24292E;\">        records[</span><span style=\"color: #032F62;\">&quot;policy_loss&quot;</span><span style=\"color: #24292E;\">][iteration </span><span style=\"color: #D73A49;\">-</span><span style=\"color: #24292E;\"> </span><span style=\"color: #005CC5;\">1</span><span style=\"color: #24292E;\">] </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> pg_loss.item()</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">238</span><span style=\"color: #24292E;\">        records[</span><span style=\"color: #032F62;\">&quot;entropy&quot;</span><span style=\"color: #24292E;\">][iteration </span><span style=\"color: #D73A49;\">-</span><span style=\"color: #24292E;\"> </span><span style=\"color: #005CC5;\">1</span><span style=\"color: #24292E;\">] </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> entropy_loss.item()</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">239</span>&nbsp;</div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">240</span><span style=\"color: #24292E;\">        cos_annealing_scheduler.step()</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">241</span>&nbsp;</div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">242</span><span style=\"color: #24292E;\">        </span><span style=\"color: #D73A49;\">if</span><span style=\"color: #24292E;\"> iteration </span><span style=\"color: #D73A49;\">==</span><span style=\"color: #24292E;\"> args.num_iterations:</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">243</span><span style=\"color: #24292E;\">            states </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> []</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">244</span><span style=\"color: #24292E;\">            rewards </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> []</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">245</span><span style=\"color: #24292E;\">            env </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> aerodrome.make(</span><span style=\"color: #032F62;\">&quot;wingedcone-v0&quot;</span><span style=\"color: #24292E;\">)</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">246</span><span style=\"color: #24292E;\">            </span><span style=\"color: #005CC5;\">object</span><span style=\"color: #24292E;\"> </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> WingedCone2D_RL(object_dict)</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">247</span><span style=\"color: #24292E;\">            env.add_object(</span><span style=\"color: #005CC5;\">object</span><span style=\"color: #24292E;\">)</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">248</span><span style=\"color: #24292E;\">            next_obs, info </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> env.reset()</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">249</span><span style=\"color: #24292E;\">            next_obs </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> torch.Tensor(next_obs).reshape((</span><span style=\"color: #005CC5;\">1</span><span style=\"color: #24292E;\">, </span><span style=\"color: #D73A49;\">-</span><span style=\"color: #005CC5;\">1</span><span style=\"color: #24292E;\">)).to(device)</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">250</span><span style=\"color: #24292E;\">            step </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> </span><span style=\"color: #005CC5;\">0</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">251</span><span style=\"color: #24292E;\">            </span><span style=\"color: #D73A49;\">while</span><span style=\"color: #24292E;\"> </span><span style=\"color: #005CC5;\">True</span><span style=\"color: #24292E;\">:</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">252</span><span style=\"color: #24292E;\">                step </span><span style=\"color: #D73A49;\">+=</span><span style=\"color: #24292E;\"> </span><span style=\"color: #005CC5;\">1</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">253</span><span style=\"color: #24292E;\">                </span><span style=\"color: #6A737D;\"># ALGO LOGIC: action logic</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">254</span><span style=\"color: #24292E;\">                states.append(env.get_state())</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">255</span><span style=\"color: #24292E;\">                </span><span style=\"color: #D73A49;\">with</span><span style=\"color: #24292E;\"> torch.no_grad():</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">256</span><span style=\"color: #24292E;\">                    action, logprob, _, value </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> agent.get_action_and_value(next_obs, </span><span style=\"color: #E36209;\">evaluate</span><span style=\"color: #D73A49;\">=</span><span style=\"color: #005CC5;\">True</span><span style=\"color: #24292E;\">)</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">257</span>&nbsp;</div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">258</span><span style=\"color: #24292E;\">                </span><span style=\"color: #6A737D;\"># TRY NOT TO MODIFY: execute the game and log data.</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">259</span><span style=\"color: #24292E;\">                step_action </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> {</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">260</span><span style=\"color: #24292E;\">                    </span><span style=\"color: #032F62;\">&quot;test&quot;</span><span style=\"color: #24292E;\">: {</span><span style=\"color: #032F62;\">&quot;Nyc&quot;</span><span style=\"color: #24292E;\">:</span><span style=\"color: #005CC5;\">1.0</span><span style=\"color: #24292E;\">, </span><span style=\"color: #032F62;\">&quot;Vc&quot;</span><span style=\"color: #24292E;\">:</span><span style=\"color: #005CC5;\">4590.29</span><span style=\"color: #24292E;\">, </span><span style=\"color: #032F62;\">&quot;nn_control&quot;</span><span style=\"color: #24292E;\">:action.item()},</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">261</span><span style=\"color: #24292E;\">                }</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">262</span><span style=\"color: #24292E;\">                next_obs, reward, terminations, truncations, infos </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> env.step(step_action)</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">263</span><span style=\"color: #24292E;\">                next_done </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> np.logical_or(terminations, truncations)</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">264</span><span style=\"color: #24292E;\">                next_obs </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> torch.Tensor(next_obs).reshape((</span><span style=\"color: #005CC5;\">1</span><span style=\"color: #24292E;\">, </span><span style=\"color: #D73A49;\">-</span><span style=\"color: #005CC5;\">1</span><span style=\"color: #24292E;\">)).to(device)</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">265</span><span style=\"color: #24292E;\">                rewards.append(reward)</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">266</span><span style=\"color: #24292E;\">                </span><span style=\"color: #D73A49;\">if</span><span style=\"color: #24292E;\"> next_done </span><span style=\"color: #D73A49;\">or</span><span style=\"color: #24292E;\"> step </span><span style=\"color: #D73A49;\">&gt;=</span><span style=\"color: #24292E;\"> </span><span style=\"color: #005CC5;\">1000</span><span style=\"color: #24292E;\">:</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">267</span><span style=\"color: #24292E;\">                    </span><span style=\"color: #D73A49;\">break</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">268</span><span style=\"color: #24292E;\">            fig, ax </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> plt.subplots(</span><span style=\"color: #005CC5;\">1</span><span style=\"color: #24292E;\">, </span><span style=\"color: #005CC5;\">1</span><span style=\"color: #24292E;\">)</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">269</span><span style=\"color: #24292E;\">            x </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> np.array([states[i][</span><span style=\"color: #032F62;\">&quot;pos&quot;</span><span style=\"color: #24292E;\">][</span><span style=\"color: #005CC5;\">0</span><span style=\"color: #24292E;\">] </span><span style=\"color: #D73A49;\">for</span><span style=\"color: #24292E;\"> i </span><span style=\"color: #D73A49;\">in</span><span style=\"color: #24292E;\"> </span><span style=\"color: #005CC5;\">range</span><span style=\"color: #24292E;\">(</span><span style=\"color: #005CC5;\">len</span><span style=\"color: #24292E;\">(states))])</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">270</span><span style=\"color: #24292E;\">            y </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> np.array([states[i][</span><span style=\"color: #032F62;\">&quot;Ny&quot;</span><span style=\"color: #24292E;\">] </span><span style=\"color: #D73A49;\">for</span><span style=\"color: #24292E;\"> i </span><span style=\"color: #D73A49;\">in</span><span style=\"color: #24292E;\"> </span><span style=\"color: #005CC5;\">range</span><span style=\"color: #24292E;\">(</span><span style=\"color: #005CC5;\">len</span><span style=\"color: #24292E;\">(states))])</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">271</span><span style=\"color: #24292E;\">            ax.plot(x, y)</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">272</span><span style=\"color: #24292E;\">            ax.plot(x, rewards)</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">273</span><span style=\"color: #24292E;\">            plt.show()</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">274</span>&nbsp;</div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">275</span><span style=\"color: #24292E;\">    fig, ax </span><span style=\"color: #D73A49;\">=</span><span style=\"color: #24292E;\"> plt.subplots(</span><span style=\"color: #005CC5;\">1</span><span style=\"color: #24292E;\">, </span><span style=\"color: #005CC5;\">1</span><span style=\"color: #24292E;\">)</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">276</span><span style=\"color: #24292E;\">    ax.plot(records[</span><span style=\"color: #032F62;\">&quot;reward&quot;</span><span style=\"color: #24292E;\">])</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">277</span><span style=\"color: #24292E;\">    ax.set_xlabel(</span><span style=\"color: #032F62;\">&quot;Iteration&quot;</span><span style=\"color: #24292E;\">)</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">278</span><span style=\"color: #24292E;\">    ax.set_ylabel(</span><span style=\"color: #032F62;\">&quot;Reward&quot;</span><span style=\"color: #24292E;\">)</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">279</span><span style=\"color: #24292E;\">    plt.show()</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">280</span>&nbsp;</div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">281</span><span style=\"color: #24292E;\">    torch.save(agent.state_dict(), </span><span style=\"color: #032F62;\">&quot;models/wingedcone_ppo.pth&quot;</span><span style=\"color: #24292E;\">)</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">282</span>&nbsp;</div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">283</span><span style=\"color: #D73A49;\">if</span><span style=\"color: #24292E;\"> </span><span style=\"color: #005CC5;\">__name__</span><span style=\"color: #24292E;\"> </span><span style=\"color: #D73A49;\">==</span><span style=\"color: #24292E;\"> </span><span style=\"color: #032F62;\">&quot;__main__&quot;</span><span style=\"color: #24292E;\">:</span></div><div class='line'><span style=\"color:#1b1f234d; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">284</span><span style=\"color: #24292E;\">    main()</span></div>","classes":"torchlight","styles":"background-color: #fff; --theme-selection-background: #e2e5e9;"}}
