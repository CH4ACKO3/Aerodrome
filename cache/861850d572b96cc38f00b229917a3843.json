{"expires":1743603349.587,"value":{"highlighted":"<!-- Syntax highlighted by torchlight.dev --><div class='line'><span style=\"color: #C792EA;\">class</span><span style=\"color: #F07178;\"> </span><span style=\"color: #FFCB6B;\">Space3D</span><span style=\"color: #F07178;\"> </span><span style=\"color: #89DDFF;\">:</span><span style=\"color: #F07178;\"> </span><span style=\"color: #C792EA;\">public</span><span style=\"color: #F07178;\"> </span><span style=\"color: #FFCB6B;\">BaseEnv</span></div><div class='line'><span style=\"color: #89DDFF;\">{</span></div><div class='line'><span style=\"color: #C792EA;\">private</span><span style=\"color: #89DDFF;\">:</span></div><div class='line'><span style=\"color: #F07178;\">    </span><span style=\"color: #C792EA;\">double</span><span style=\"color: #F07178;\"> tau</span><span style=\"color: #89DDFF;\">;</span><span style=\"color: #676E95;\"> // 每次积分的时间长度，tau = dt / integrate_steps</span></div><div class='line'><span style=\"color: #F07178;\">    </span><span style=\"color: #C792EA;\">double</span><span style=\"color: #F07178;\"> dt</span><span style=\"color: #89DDFF;\">;</span><span style=\"color: #676E95;\"> // 每次被调用 step() 方法时，步进的时间长度</span></div><div class='line'><span style=\"color: #F07178;\">    </span><span style=\"color: #C792EA;\">double</span><span style=\"color: #F07178;\"> eps</span><span style=\"color: #89DDFF;\">;</span><span style=\"color: #676E95;\"> // 容差，可以用于检查动力学积分的精度，未实装</span></div><div class='line'><span style=\"color: #F07178;\">    </span><span style=\"color: #C792EA;\">int</span><span style=\"color: #F07178;\"> integrate_steps</span><span style=\"color: #89DDFF;\">;</span><span style=\"color: #676E95;\"> // 每次被调用 step() 方法时，调用环境内对象的 step() 方法的次数（将每次步进划分为几次积分）</span></div><div class='line'>&nbsp;</div><div class='line'><span style=\"color: #C792EA;\">public</span><span style=\"color: #89DDFF;\">:</span></div><div class='line'><span style=\"color: #F07178;\">    </span><span style=\"color: #FFCB6B;\">std</span><span style=\"color: #89DDFF;\">::</span><span style=\"color: #F07178;\">vector</span><span style=\"color: #89DDFF;\">&lt;</span><span style=\"color: #FFCB6B;\">std</span><span style=\"color: #89DDFF;\">::</span><span style=\"color: #F07178;\">shared_ptr</span><span style=\"color: #89DDFF;\">&lt;</span><span style=\"color: #F07178;\">Object3D</span><span style=\"color: #89DDFF;\">&gt;&gt;</span><span style=\"color: #F07178;\"> objects</span><span style=\"color: #89DDFF;\">;</span></div><div class='line'>&nbsp;</div><div class='line'><span style=\"color: #F07178;\">    </span><span style=\"color: #82AAFF;\">Space3D</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #C792EA;\">double</span><span style=\"color: #F07178;\"> </span><span style=\"color: #A6ACCD;\">tau</span><span style=\"color: #89DDFF;\">,</span><span style=\"color: #F07178;\"> </span><span style=\"color: #C792EA;\">double</span><span style=\"color: #F07178;\"> </span><span style=\"color: #A6ACCD;\">eps</span><span style=\"color: #89DDFF;\">,</span><span style=\"color: #F07178;\"> </span><span style=\"color: #C792EA;\">int</span><span style=\"color: #F07178;\"> </span><span style=\"color: #A6ACCD;\">integrate_steps</span><span style=\"color: #89DDFF;\">)</span></div><div class='line'><span style=\"color: #F07178;\">        </span><span style=\"color: #89DDFF;\">:</span><span style=\"color: #F07178;\"> </span><span style=\"color: #82AAFF;\">tau</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #F07178;\">tau</span><span style=\"color: #89DDFF;\">),</span><span style=\"color: #F07178;\"> </span><span style=\"color: #82AAFF;\">eps</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #F07178;\">eps</span><span style=\"color: #89DDFF;\">),</span><span style=\"color: #F07178;\"> </span><span style=\"color: #82AAFF;\">integrate_steps</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #F07178;\">integrate_steps</span><span style=\"color: #89DDFF;\">)</span></div><div class='line'><span style=\"color: #F07178;\">    </span><span style=\"color: #89DDFF;\">{</span></div><div class='line'><span style=\"color: #F07178;\">        dt </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #F07178;\"> tau </span><span style=\"color: #89DDFF;\">/</span><span style=\"color: #F07178;\"> integrate_steps</span><span style=\"color: #89DDFF;\">;</span></div><div class='line'><span style=\"color: #F07178;\">    </span><span style=\"color: #89DDFF;\">}</span></div><div class='line'>&nbsp;</div><div class='line'><span style=\"color: #F07178;\">    </span><span style=\"color: #FFCB6B;\">py</span><span style=\"color: #89DDFF;\">::</span><span style=\"color: #FFCB6B;\">object</span><span style=\"color: #F07178;\"> </span><span style=\"color: #82AAFF;\">reset</span><span style=\"color: #89DDFF;\">()</span></div><div class='line'><span style=\"color: #F07178;\">    </span><span style=\"color: #89DDFF;\">{</span></div><div class='line'><span style=\"color: #F07178;\">        </span><span style=\"color: #89DDFF;\">for</span><span style=\"color: #F07178;\"> </span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #C792EA;\">auto</span><span style=\"color: #89DDFF;\">&amp;</span><span style=\"color: #F07178;\"> object </span><span style=\"color: #89DDFF;\">:</span><span style=\"color: #F07178;\"> objects</span><span style=\"color: #89DDFF;\">)</span></div><div class='line'><span style=\"color: #F07178;\">        </span><span style=\"color: #89DDFF;\">{</span></div><div class='line'><span style=\"color: #F07178;\">            </span><span style=\"color: #A6ACCD;\">object</span><span style=\"color: #89DDFF;\">-&gt;</span><span style=\"color: #82AAFF;\">reset</span><span style=\"color: #89DDFF;\">();</span></div><div class='line'><span style=\"color: #F07178;\">        </span><span style=\"color: #89DDFF;\">}</span></div><div class='line'><span style=\"color: #F07178;\">        </span><span style=\"color: #89DDFF;\">return</span><span style=\"color: #F07178;\"> </span><span style=\"color: #82AAFF;\">to_dict</span><span style=\"color: #89DDFF;\">();</span></div><div class='line'><span style=\"color: #F07178;\">    </span><span style=\"color: #89DDFF;\">}</span></div><div class='line'>&nbsp;</div><div class='line'><span style=\"color: #F07178;\">    </span><span style=\"color: #C792EA;\">void</span><span style=\"color: #F07178;\"> </span><span style=\"color: #82AAFF;\">add_object</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #FFCB6B;\">std</span><span style=\"color: #89DDFF;\">::</span><span style=\"color: #FFCB6B;\">shared_ptr</span><span style=\"color: #89DDFF;\">&lt;</span><span style=\"color: #FFCB6B;\">Object3D</span><span style=\"color: #89DDFF;\">&gt;</span><span style=\"color: #F07178;\"> </span><span style=\"color: #A6ACCD;\">object</span><span style=\"color: #89DDFF;\">)</span></div><div class='line'><span style=\"color: #F07178;\">    </span><span style=\"color: #89DDFF;\">{</span></div><div class='line'><span style=\"color: #F07178;\">        </span><span style=\"color: #A6ACCD;\">objects</span><span style=\"color: #89DDFF;\">.</span><span style=\"color: #82AAFF;\">push_back</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #F07178;\">object</span><span style=\"color: #89DDFF;\">);</span><span style=\"color: #676E95;\"> // 将传入的对象(Object3D及其子类)存入列表中</span></div><div class='line'><span style=\"color: #F07178;\">    </span><span style=\"color: #89DDFF;\">}</span></div><div class='line'>&nbsp;</div><div class='line'><span style=\"color: #F07178;\">    </span><span style=\"color: #C792EA;\">bool</span><span style=\"color: #F07178;\"> </span><span style=\"color: #82AAFF;\">check_consistency</span><span style=\"color: #89DDFF;\">()</span></div><div class='line'><span style=\"color: #F07178;\">    </span><span style=\"color: #89DDFF;\">{</span></div><div class='line'><span style=\"color: #F07178;\">        </span><span style=\"color: #89DDFF;\">return</span><span style=\"color: #F07178;\"> </span><span style=\"color: #89DDFF;\">true;</span></div><div class='line'><span style=\"color: #F07178;\">    </span><span style=\"color: #89DDFF;\">}</span></div><div class='line'>&nbsp;</div><div class='line'><span style=\"color: #F07178;\">    </span><span style=\"color: #FFCB6B;\">py</span><span style=\"color: #89DDFF;\">::</span><span style=\"color: #FFCB6B;\">dict</span><span style=\"color: #F07178;\"> </span><span style=\"color: #82AAFF;\">to_dict</span><span style=\"color: #89DDFF;\">()</span><span style=\"color: #676E95;\"> // 调用环境中每个对象的 to_dict() 方法，并将所有返回值存入一个字典中并返回</span></div><div class='line'><span style=\"color: #F07178;\">    </span><span style=\"color: #89DDFF;\">{</span></div><div class='line'><span style=\"color: #F07178;\">        </span><span style=\"color: #FFCB6B;\">py</span><span style=\"color: #89DDFF;\">::</span><span style=\"color: #F07178;\">dict output_dict</span><span style=\"color: #89DDFF;\">;</span></div><div class='line'><span style=\"color: #F07178;\">        </span><span style=\"color: #89DDFF;\">for</span><span style=\"color: #F07178;\"> </span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #C792EA;\">auto</span><span style=\"color: #89DDFF;\">&amp;</span><span style=\"color: #F07178;\"> object </span><span style=\"color: #89DDFF;\">:</span><span style=\"color: #F07178;\"> objects</span><span style=\"color: #89DDFF;\">)</span></div><div class='line'><span style=\"color: #F07178;\">        </span><span style=\"color: #89DDFF;\">{</span></div><div class='line'><span style=\"color: #F07178;\">            </span><span style=\"color: #A6ACCD;\">output_dict</span><span style=\"color: #89DDFF;\">[</span><span style=\"color: #FFCB6B;\">py</span><span style=\"color: #89DDFF;\">::</span><span style=\"color: #82AAFF;\">str</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #A6ACCD;\">object</span><span style=\"color: #89DDFF;\">-&gt;</span><span style=\"color: #A6ACCD;\">name</span><span style=\"color: #89DDFF;\">)]</span><span style=\"color: #F07178;\"> </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #F07178;\"> </span><span style=\"color: #A6ACCD;\">object</span><span style=\"color: #89DDFF;\">-&gt;</span><span style=\"color: #82AAFF;\">to_dict</span><span style=\"color: #89DDFF;\">();</span><span style=\"color: #F07178;\"> </span></div><div class='line'><span style=\"color: #F07178;\">        </span><span style=\"color: #89DDFF;\">}</span></div><div class='line'><span style=\"color: #F07178;\">        </span><span style=\"color: #89DDFF;\">return</span><span style=\"color: #F07178;\"> output_dict</span><span style=\"color: #89DDFF;\">;</span></div><div class='line'><span style=\"color: #F07178;\">    </span><span style=\"color: #89DDFF;\">}</span></div><div class='line'>&nbsp;</div><div class='line'><span style=\"color: #F07178;\">    </span><span style=\"color: #FFCB6B;\">py</span><span style=\"color: #89DDFF;\">::</span><span style=\"color: #FFCB6B;\">dict</span><span style=\"color: #F07178;\"> </span><span style=\"color: #82AAFF;\">get_d</span><span style=\"color: #89DDFF;\">()</span><span style=\"color: #676E95;\"> // 获取环境中所有对象的运动学导数，用于 debug</span></div><div class='line'><span style=\"color: #F07178;\">    </span><span style=\"color: #89DDFF;\">{</span></div><div class='line'><span style=\"color: #F07178;\">        </span><span style=\"color: #FFCB6B;\">py</span><span style=\"color: #89DDFF;\">::</span><span style=\"color: #F07178;\">dict output_dict</span><span style=\"color: #89DDFF;\">;</span></div><div class='line'><span style=\"color: #F07178;\">        </span><span style=\"color: #89DDFF;\">for</span><span style=\"color: #F07178;\"> </span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #C792EA;\">auto</span><span style=\"color: #89DDFF;\">&amp;</span><span style=\"color: #F07178;\"> object </span><span style=\"color: #89DDFF;\">:</span><span style=\"color: #F07178;\"> objects</span><span style=\"color: #89DDFF;\">)</span></div><div class='line'><span style=\"color: #F07178;\">        </span><span style=\"color: #89DDFF;\">{</span></div><div class='line'><span style=\"color: #F07178;\">            </span><span style=\"color: #A6ACCD;\">output_dict</span><span style=\"color: #89DDFF;\">[</span><span style=\"color: #FFCB6B;\">py</span><span style=\"color: #89DDFF;\">::</span><span style=\"color: #82AAFF;\">str</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #A6ACCD;\">object</span><span style=\"color: #89DDFF;\">-&gt;</span><span style=\"color: #A6ACCD;\">name</span><span style=\"color: #89DDFF;\">)]</span><span style=\"color: #F07178;\"> </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #F07178;\"> </span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #A6ACCD;\">object</span><span style=\"color: #89DDFF;\">-&gt;</span><span style=\"color: #82AAFF;\">d</span><span style=\"color: #89DDFF;\">()).</span><span style=\"color: #82AAFF;\">to_dict</span><span style=\"color: #89DDFF;\">();</span><span style=\"color: #F07178;\"> </span></div><div class='line'><span style=\"color: #F07178;\">        </span><span style=\"color: #89DDFF;\">}</span></div><div class='line'><span style=\"color: #F07178;\">        </span><span style=\"color: #89DDFF;\">return</span><span style=\"color: #F07178;\"> output_dict</span><span style=\"color: #89DDFF;\">;</span></div><div class='line'><span style=\"color: #F07178;\">    </span><span style=\"color: #89DDFF;\">}</span></div><div class='line'>&nbsp;</div><div class='line'><span style=\"color: #F07178;\">    </span><span style=\"color: #FFCB6B;\">py</span><span style=\"color: #89DDFF;\">::</span><span style=\"color: #FFCB6B;\">object</span><span style=\"color: #F07178;\"> </span><span style=\"color: #82AAFF;\">step</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #C792EA;\">const</span><span style=\"color: #F07178;\"> </span><span style=\"color: #FFCB6B;\">py</span><span style=\"color: #89DDFF;\">::</span><span style=\"color: #FFCB6B;\">object</span><span style=\"color: #C792EA;\">&amp;</span><span style=\"color: #F07178;\"> </span><span style=\"color: #A6ACCD;\">actions</span><span style=\"color: #89DDFF;\">)</span><span style=\"color: #676E95;\"> // 步进时会调用环境中所有对象的 step() 方法若干次，并获取返回值</span></div><div class='line'><span style=\"color: #F07178;\">    </span><span style=\"color: #89DDFF;\">{</span></div><div class='line'><span style=\"color: #F07178;\">        </span><span style=\"color: #FFCB6B;\">py</span><span style=\"color: #89DDFF;\">::</span><span style=\"color: #F07178;\">dict result</span><span style=\"color: #89DDFF;\">,</span><span style=\"color: #F07178;\"> info</span><span style=\"color: #89DDFF;\">;</span></div><div class='line'>&nbsp;</div><div class='line'><span style=\"color: #F07178;\">        </span><span style=\"color: #89DDFF;\">for</span><span style=\"color: #F07178;\"> </span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #C792EA;\">int</span><span style=\"color: #F07178;\"> i </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #F07178;\"> </span><span style=\"color: #F78C6C;\">0</span><span style=\"color: #89DDFF;\">;</span><span style=\"color: #F07178;\"> i </span><span style=\"color: #89DDFF;\">&lt;</span><span style=\"color: #F07178;\"> integrate_steps</span><span style=\"color: #89DDFF;\">;</span><span style=\"color: #F07178;\"> </span><span style=\"color: #89DDFF;\">++</span><span style=\"color: #F07178;\">i</span><span style=\"color: #89DDFF;\">)</span></div><div class='line'><span style=\"color: #F07178;\">        </span><span style=\"color: #89DDFF;\">{</span></div><div class='line'><span style=\"color: #F07178;\">            </span><span style=\"color: #89DDFF;\">for</span><span style=\"color: #F07178;\"> </span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #C792EA;\">auto</span><span style=\"color: #89DDFF;\">&amp;</span><span style=\"color: #F07178;\"> object </span><span style=\"color: #89DDFF;\">:</span><span style=\"color: #F07178;\"> objects</span><span style=\"color: #89DDFF;\">)</span></div><div class='line'><span style=\"color: #F07178;\">            </span><span style=\"color: #89DDFF;\">{</span></div><div class='line'><span style=\"color: #F07178;\">                </span><span style=\"color: #A6ACCD;\">actions</span><span style=\"color: #89DDFF;\">[</span><span style=\"color: #FFCB6B;\">py</span><span style=\"color: #89DDFF;\">::</span><span style=\"color: #82AAFF;\">str</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #A6ACCD;\">object</span><span style=\"color: #89DDFF;\">-&gt;</span><span style=\"color: #A6ACCD;\">name</span><span style=\"color: #89DDFF;\">)][</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #C3E88D;\">dt</span><span style=\"color: #89DDFF;\">&quot;</span><span style=\"color: #89DDFF;\">]</span><span style=\"color: #F07178;\"> </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #F07178;\"> dt</span><span style=\"color: #89DDFF;\">;</span><span style=\"color: #F07178;\">   </span></div><div class='line'><span style=\"color: #F07178;\">                </span><span style=\"color: #A6ACCD;\">result</span><span style=\"color: #89DDFF;\">[</span><span style=\"color: #FFCB6B;\">py</span><span style=\"color: #89DDFF;\">::</span><span style=\"color: #82AAFF;\">str</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #A6ACCD;\">object</span><span style=\"color: #89DDFF;\">-&gt;</span><span style=\"color: #A6ACCD;\">name</span><span style=\"color: #89DDFF;\">)]</span><span style=\"color: #F07178;\"> </span><span style=\"color: #89DDFF;\">=</span><span style=\"color: #F07178;\"> </span><span style=\"color: #A6ACCD;\">object</span><span style=\"color: #89DDFF;\">-&gt;</span><span style=\"color: #82AAFF;\">step</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #A6ACCD;\">actions</span><span style=\"color: #89DDFF;\">[</span><span style=\"color: #FFCB6B;\">py</span><span style=\"color: #89DDFF;\">::</span><span style=\"color: #82AAFF;\">str</span><span style=\"color: #89DDFF;\">(</span><span style=\"color: #A6ACCD;\">object</span><span style=\"color: #89DDFF;\">-&gt;</span><span style=\"color: #A6ACCD;\">name</span><span style=\"color: #89DDFF;\">)]);</span></div><div class='line'><span style=\"color: #F07178;\">            </span><span style=\"color: #89DDFF;\">}</span></div><div class='line'><span style=\"color: #F07178;\">        </span><span style=\"color: #89DDFF;\">}</span></div><div class='line'>&nbsp;</div><div class='line'><span style=\"color: #F07178;\">        </span><span style=\"color: #89DDFF;\">return</span><span style=\"color: #F07178;\"> result</span><span style=\"color: #89DDFF;\">;</span></div><div class='line'><span style=\"color: #F07178;\">    </span><span style=\"color: #89DDFF;\">}</span></div><div class='line'><span style=\"color: #89DDFF;\">};</span></div>","classes":"torchlight","styles":"background-color: #292D3E; --theme-selection-background: #00000080;"}}
