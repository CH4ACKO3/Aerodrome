{"expires":1743605057.934,"value":{"highlighted":"<!-- Syntax highlighted by torchlight.dev --><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 1</span><span style=\"color: #0991B6;\">class</span><span style=\"color: #002339;\"> </span><span style=\"color: #0444AC;\">Space3D</span><span style=\"color: #002339;\"> : </span><span style=\"color: #0991B6;\">public</span><span style=\"color: #002339;\"> </span><span style=\"color: #0444AC;\">BaseEnv</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 2</span><span style=\"color: #002339;\">{</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 3</span><span style=\"color: #0991B6;\">private:</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 4</span><span style=\"color: #002339;\">    </span><span style=\"color: #0991B6;\">double</span><span style=\"color: #002339;\"> tau;</span><span style=\"color: #357B42;\"> // 每次积分的时间长度，tau = dt / integrate_steps</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 5</span><span style=\"color: #002339;\">    </span><span style=\"color: #0991B6;\">double</span><span style=\"color: #002339;\"> dt;</span><span style=\"color: #357B42;\"> // 每次被调用 step() 方法时，步进的时间长度</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 6</span><span style=\"color: #002339;\">    </span><span style=\"color: #0991B6;\">double</span><span style=\"color: #002339;\"> eps;</span><span style=\"color: #357B42;\"> // 容差，可以用于检查动力学积分的精度，未实装</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 7</span><span style=\"color: #002339;\">    </span><span style=\"color: #0991B6;\">int</span><span style=\"color: #002339;\"> integrate_steps;</span><span style=\"color: #357B42;\"> // 每次被调用 step() 方法时，调用环境内对象的 step() 方法的次数（将每次步进划分为几次积分）</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 8</span>&nbsp;</div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 9</span><span style=\"color: #0991B6;\">public:</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">10</span><span style=\"color: #002339;\">    std::vector</span><span style=\"color: #7B30D0;\">&lt;</span><span style=\"color: #002339;\">std::shared_ptr</span><span style=\"color: #7B30D0;\">&lt;</span><span style=\"color: #002339;\">Object3D</span><span style=\"color: #7B30D0;\">&gt;&gt;</span><span style=\"color: #002339;\"> objects;</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">11</span>&nbsp;</div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">12</span><span style=\"color: #002339;\">    </span><span style=\"color: #B1108E;\">Space3D</span><span style=\"color: #002339;\">(</span><span style=\"color: #0991B6;\">double</span><span style=\"color: #002339;\"> </span><span style=\"color: #B1108E;\">tau</span><span style=\"color: #002339;\">, </span><span style=\"color: #0991B6;\">double</span><span style=\"color: #002339;\"> </span><span style=\"color: #B1108E;\">eps</span><span style=\"color: #002339;\">, </span><span style=\"color: #0991B6;\">int</span><span style=\"color: #002339;\"> </span><span style=\"color: #B1108E;\">integrate_steps</span><span style=\"color: #002339;\">)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">13</span><span style=\"color: #002339;\">        : </span><span style=\"color: #B1108E;\">tau</span><span style=\"color: #002339;\">(tau), </span><span style=\"color: #B1108E;\">eps</span><span style=\"color: #002339;\">(eps), </span><span style=\"color: #B1108E;\">integrate_steps</span><span style=\"color: #002339;\">(integrate_steps)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">14</span><span style=\"color: #002339;\">    {</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">15</span><span style=\"color: #002339;\">        dt </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> tau </span><span style=\"color: #7B30D0;\">/</span><span style=\"color: #002339;\"> integrate_steps;</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">16</span><span style=\"color: #002339;\">    }</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">17</span>&nbsp;</div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">18</span><span style=\"color: #002339;\">    py::</span><span style=\"color: #0444AC;\">object</span><span style=\"color: #002339;\"> </span><span style=\"color: #B1108E;\">reset</span><span style=\"color: #002339;\">()</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">19</span><span style=\"color: #002339;\">    {</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">20</span><span style=\"color: #002339;\">        </span><span style=\"color: #0991B6;\">for</span><span style=\"color: #002339;\"> (</span><span style=\"color: #0991B6;\">auto</span><span style=\"color: #7B30D0;\">&amp;</span><span style=\"color: #002339;\"> object : objects)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">21</span><span style=\"color: #002339;\">        {</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">22</span><span style=\"color: #002339;\">            </span><span style=\"color: #2F86D2;\">object</span><span style=\"color: #002339;\">-&gt;</span><span style=\"color: #B1108E;\">reset</span><span style=\"color: #002339;\">();</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">23</span><span style=\"color: #002339;\">        }</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">24</span><span style=\"color: #002339;\">        </span><span style=\"color: #0991B6;\">return</span><span style=\"color: #002339;\"> </span><span style=\"color: #B1108E;\">to_dict</span><span style=\"color: #002339;\">();</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">25</span><span style=\"color: #002339;\">    }</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">26</span>&nbsp;</div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">27</span><span style=\"color: #002339;\">    </span><span style=\"color: #0991B6;\">void</span><span style=\"color: #002339;\"> </span><span style=\"color: #B1108E;\">add_object</span><span style=\"color: #002339;\">(std::</span><span style=\"color: #0444AC;\">shared_ptr</span><span style=\"color: #002339;\">&lt;</span><span style=\"color: #0444AC;\">Object3D</span><span style=\"color: #002339;\">&gt; </span><span style=\"color: #B1108E;\">object</span><span style=\"color: #002339;\">)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">28</span><span style=\"color: #002339;\">    {</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">29</span><span style=\"color: #002339;\">        </span><span style=\"color: #2F86D2;\">objects</span><span style=\"color: #002339;\">.</span><span style=\"color: #B1108E;\">push_back</span><span style=\"color: #002339;\">(object);</span><span style=\"color: #357B42;\"> // 将传入的对象(Object3D及其子类)存入列表中</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">30</span><span style=\"color: #002339;\">    }</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">31</span>&nbsp;</div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">32</span><span style=\"color: #002339;\">    </span><span style=\"color: #0991B6;\">bool</span><span style=\"color: #002339;\"> </span><span style=\"color: #B1108E;\">check_consistency</span><span style=\"color: #002339;\">()</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">33</span><span style=\"color: #002339;\">    {</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">34</span><span style=\"color: #002339;\">        </span><span style=\"color: #0991B6;\">return</span><span style=\"color: #002339;\"> </span><span style=\"color: #2970C7;\">true</span><span style=\"color: #002339;\">;</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">35</span><span style=\"color: #002339;\">    }</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">36</span>&nbsp;</div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">37</span><span style=\"color: #002339;\">    py::</span><span style=\"color: #0444AC;\">dict</span><span style=\"color: #002339;\"> </span><span style=\"color: #B1108E;\">to_dict</span><span style=\"color: #002339;\">()</span><span style=\"color: #357B42;\"> // 调用环境中每个对象的 to_dict() 方法，并将所有返回值存入一个字典中并返回</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">38</span><span style=\"color: #002339;\">    {</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">39</span><span style=\"color: #002339;\">        py::dict output_dict;</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">40</span><span style=\"color: #002339;\">        </span><span style=\"color: #0991B6;\">for</span><span style=\"color: #002339;\"> (</span><span style=\"color: #0991B6;\">auto</span><span style=\"color: #7B30D0;\">&amp;</span><span style=\"color: #002339;\"> object : objects)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">41</span><span style=\"color: #002339;\">        {</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">42</span><span style=\"color: #002339;\">            </span><span style=\"color: #2F86D2;\">output_dict</span><span style=\"color: #002339;\">[py::</span><span style=\"color: #B1108E;\">str</span><span style=\"color: #002339;\">(</span><span style=\"color: #2F86D2;\">object</span><span style=\"color: #002339;\">-&gt;</span><span style=\"color: #7FDBCA;\">name</span><span style=\"color: #002339;\">)] </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> </span><span style=\"color: #2F86D2;\">object</span><span style=\"color: #002339;\">-&gt;</span><span style=\"color: #B1108E;\">to_dict</span><span style=\"color: #002339;\">(); </span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">43</span><span style=\"color: #002339;\">        }</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">44</span><span style=\"color: #002339;\">        </span><span style=\"color: #0991B6;\">return</span><span style=\"color: #002339;\"> output_dict;</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">45</span><span style=\"color: #002339;\">    }</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">46</span>&nbsp;</div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">47</span><span style=\"color: #002339;\">    py::</span><span style=\"color: #0444AC;\">dict</span><span style=\"color: #002339;\"> </span><span style=\"color: #B1108E;\">get_d</span><span style=\"color: #002339;\">()</span><span style=\"color: #357B42;\"> // 获取环境中所有对象的运动学导数，用于 debug</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">48</span><span style=\"color: #002339;\">    {</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">49</span><span style=\"color: #002339;\">        py::dict output_dict;</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">50</span><span style=\"color: #002339;\">        </span><span style=\"color: #0991B6;\">for</span><span style=\"color: #002339;\"> (</span><span style=\"color: #0991B6;\">auto</span><span style=\"color: #7B30D0;\">&amp;</span><span style=\"color: #002339;\"> object : objects)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">51</span><span style=\"color: #002339;\">        {</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">52</span><span style=\"color: #002339;\">            </span><span style=\"color: #2F86D2;\">output_dict</span><span style=\"color: #002339;\">[py::</span><span style=\"color: #B1108E;\">str</span><span style=\"color: #002339;\">(</span><span style=\"color: #2F86D2;\">object</span><span style=\"color: #002339;\">-&gt;</span><span style=\"color: #7FDBCA;\">name</span><span style=\"color: #002339;\">)] </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> (</span><span style=\"color: #2F86D2;\">object</span><span style=\"color: #002339;\">-&gt;</span><span style=\"color: #B1108E;\">d</span><span style=\"color: #002339;\">()).</span><span style=\"color: #B1108E;\">to_dict</span><span style=\"color: #002339;\">(); </span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">53</span><span style=\"color: #002339;\">        }</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">54</span><span style=\"color: #002339;\">        </span><span style=\"color: #0991B6;\">return</span><span style=\"color: #002339;\"> output_dict;</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">55</span><span style=\"color: #002339;\">    }</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">56</span>&nbsp;</div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">57</span><span style=\"color: #002339;\">    py::</span><span style=\"color: #0444AC;\">object</span><span style=\"color: #002339;\"> </span><span style=\"color: #B1108E;\">step</span><span style=\"color: #002339;\">(</span><span style=\"color: #0991B6;\">const</span><span style=\"color: #002339;\"> py::</span><span style=\"color: #0444AC;\">object</span><span style=\"color: #0991B6;\">&amp;</span><span style=\"color: #002339;\"> </span><span style=\"color: #B1108E;\">actions</span><span style=\"color: #002339;\">)</span><span style=\"color: #357B42;\"> // 步进时会调用环境中所有对象的 step() 方法若干次，并获取返回值</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">58</span><span style=\"color: #002339;\">    {</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">59</span><span style=\"color: #002339;\">        py::dict result, info;</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">60</span>&nbsp;</div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">61</span><span style=\"color: #002339;\">        </span><span style=\"color: #0991B6;\">for</span><span style=\"color: #002339;\"> (</span><span style=\"color: #0991B6;\">int</span><span style=\"color: #002339;\"> i </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> </span><span style=\"color: #174781;\">0</span><span style=\"color: #002339;\">; i </span><span style=\"color: #7B30D0;\">&lt;</span><span style=\"color: #002339;\"> integrate_steps; </span><span style=\"color: #7B30D0;\">++</span><span style=\"color: #002339;\">i)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">62</span><span style=\"color: #002339;\">        {</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">63</span><span style=\"color: #002339;\">            </span><span style=\"color: #0991B6;\">for</span><span style=\"color: #002339;\"> (</span><span style=\"color: #0991B6;\">auto</span><span style=\"color: #7B30D0;\">&amp;</span><span style=\"color: #002339;\"> object : objects)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">64</span><span style=\"color: #002339;\">            {</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">65</span><span style=\"color: #002339;\">                </span><span style=\"color: #2F86D2;\">actions</span><span style=\"color: #002339;\">[py::</span><span style=\"color: #B1108E;\">str</span><span style=\"color: #002339;\">(</span><span style=\"color: #2F86D2;\">object</span><span style=\"color: #002339;\">-&gt;</span><span style=\"color: #7FDBCA;\">name</span><span style=\"color: #002339;\">)][</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">dt</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">] </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> dt;   </span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">66</span><span style=\"color: #002339;\">                </span><span style=\"color: #2F86D2;\">result</span><span style=\"color: #002339;\">[py::</span><span style=\"color: #B1108E;\">str</span><span style=\"color: #002339;\">(</span><span style=\"color: #2F86D2;\">object</span><span style=\"color: #002339;\">-&gt;</span><span style=\"color: #7FDBCA;\">name</span><span style=\"color: #002339;\">)] </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> </span><span style=\"color: #2F86D2;\">object</span><span style=\"color: #002339;\">-&gt;</span><span style=\"color: #B1108E;\">step</span><span style=\"color: #002339;\">(</span><span style=\"color: #2F86D2;\">actions</span><span style=\"color: #002339;\">[py::</span><span style=\"color: #B1108E;\">str</span><span style=\"color: #002339;\">(</span><span style=\"color: #2F86D2;\">object</span><span style=\"color: #002339;\">-&gt;</span><span style=\"color: #7FDBCA;\">name</span><span style=\"color: #002339;\">)]);</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">67</span><span style=\"color: #002339;\">            }</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">68</span><span style=\"color: #002339;\">        }</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">69</span>&nbsp;</div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">70</span><span style=\"color: #002339;\">        </span><span style=\"color: #0991B6;\">return</span><span style=\"color: #002339;\"> result;</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">71</span><span style=\"color: #002339;\">    }</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">72</span><span style=\"color: #002339;\">};</span></div>","classes":"torchlight","styles":"background-color: #FFFFFF; --theme-selection-background: #4373c2;"}}
