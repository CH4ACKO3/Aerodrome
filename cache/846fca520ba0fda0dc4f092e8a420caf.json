{"expires":1743605057.113,"value":{"highlighted":"<!-- Syntax highlighted by torchlight.dev --><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">  1</span><span style=\"color: #0991B6;\">def</span><span style=\"color: #002339;\"> </span><span style=\"color: #B1108E;\">main</span><span style=\"color: #002339;\">():</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">  2</span><span style=\"color: #002339;\">    parser </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> argparse.ArgumentParser()</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">  3</span><span style=\"color: #002339;\">    parser.add_argument(</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">--seed</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">, </span><span style=\"color: #B1108E;\">type</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #DC3EB7;\">int</span><span style=\"color: #002339;\">, </span><span style=\"color: #B1108E;\">default</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #174781;\">0</span><span style=\"color: #002339;\">,</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">  4</span><span style=\"color: #002339;\">                        </span><span style=\"color: #B1108E;\">help</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">random seed of the experiment</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">  5</span><span style=\"color: #002339;\">    parser.add_argument(</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">--num_steps</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">, </span><span style=\"color: #B1108E;\">type</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #DC3EB7;\">int</span><span style=\"color: #002339;\">, </span><span style=\"color: #B1108E;\">default</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #174781;\">1024</span><span style=\"color: #002339;\">,</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">  6</span><span style=\"color: #002339;\">                        </span><span style=\"color: #B1108E;\">help</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">the number of steps to run per policy rollout</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">  7</span><span style=\"color: #002339;\">    parser.add_argument(</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">--total_timesteps</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">, </span><span style=\"color: #B1108E;\">type</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #DC3EB7;\">int</span><span style=\"color: #002339;\">, </span><span style=\"color: #B1108E;\">default</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #174781;\">300_000</span><span style=\"color: #002339;\">,</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">  8</span><span style=\"color: #002339;\">                        </span><span style=\"color: #B1108E;\">help</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">the number of iterations</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">  9</span><span style=\"color: #002339;\">    parser.add_argument(</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">--batch_size</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">, </span><span style=\"color: #B1108E;\">type</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #DC3EB7;\">int</span><span style=\"color: #002339;\">, </span><span style=\"color: #B1108E;\">default</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #174781;\">256</span><span style=\"color: #002339;\">,</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 10</span><span style=\"color: #002339;\">                        </span><span style=\"color: #B1108E;\">help</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">the batch size of sample from the replay memory</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 11</span><span style=\"color: #002339;\">    parser.add_argument(</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">--gamma</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">, </span><span style=\"color: #B1108E;\">type</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #DC3EB7;\">float</span><span style=\"color: #002339;\">, </span><span style=\"color: #B1108E;\">default</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #174781;\">0.99</span><span style=\"color: #002339;\">,</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 12</span><span style=\"color: #002339;\">                        </span><span style=\"color: #B1108E;\">help</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">discount factor</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 13</span><span style=\"color: #002339;\">    parser.add_argument(</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">--gae_lambda</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">, </span><span style=\"color: #B1108E;\">type</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #DC3EB7;\">float</span><span style=\"color: #002339;\">, </span><span style=\"color: #B1108E;\">default</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #174781;\">0.95</span><span style=\"color: #002339;\">,</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 14</span><span style=\"color: #002339;\">                        </span><span style=\"color: #B1108E;\">help</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">lambda for the general advantage estimation</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 15</span><span style=\"color: #002339;\">    parser.add_argument(</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">--num_minibatches</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">, </span><span style=\"color: #B1108E;\">type</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #DC3EB7;\">int</span><span style=\"color: #002339;\">, </span><span style=\"color: #B1108E;\">default</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #174781;\">1</span><span style=\"color: #002339;\">,</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 16</span><span style=\"color: #002339;\">                        </span><span style=\"color: #B1108E;\">help</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">the number of mini-batches</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 17</span><span style=\"color: #002339;\">    parser.add_argument(</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">--update_epochs</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">, </span><span style=\"color: #B1108E;\">type</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #DC3EB7;\">int</span><span style=\"color: #002339;\">, </span><span style=\"color: #B1108E;\">default</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #174781;\">20</span><span style=\"color: #002339;\">,</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 18</span><span style=\"color: #002339;\">                        </span><span style=\"color: #B1108E;\">help</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">the K epochs to update the policy</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 19</span><span style=\"color: #002339;\">    parser.add_argument(</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">--norm_adv</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">, </span><span style=\"color: #B1108E;\">type</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #DC3EB7;\">bool</span><span style=\"color: #002339;\">, </span><span style=\"color: #B1108E;\">default</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #2970C7;\">True</span><span style=\"color: #002339;\">,</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 20</span><span style=\"color: #002339;\">                        </span><span style=\"color: #B1108E;\">help</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">Toggles advantages normalization</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 21</span><span style=\"color: #002339;\">    parser.add_argument(</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">--clip_coef</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">, </span><span style=\"color: #B1108E;\">type</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #DC3EB7;\">float</span><span style=\"color: #002339;\">, </span><span style=\"color: #B1108E;\">default</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #174781;\">0.2</span><span style=\"color: #002339;\">,</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 22</span><span style=\"color: #002339;\">                        </span><span style=\"color: #B1108E;\">help</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">the surrogate clipping coefficient</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 23</span><span style=\"color: #002339;\">    parser.add_argument(</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">--clip_vloss</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">, </span><span style=\"color: #B1108E;\">type</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #DC3EB7;\">bool</span><span style=\"color: #002339;\">, </span><span style=\"color: #B1108E;\">default</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #2970C7;\">True</span><span style=\"color: #002339;\">,</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 24</span><span style=\"color: #002339;\">                        </span><span style=\"color: #B1108E;\">help</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">Toggles whether or not to use a clipped loss for the value function</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 25</span><span style=\"color: #002339;\">    parser.add_argument(</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">--ent_coef</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">, </span><span style=\"color: #B1108E;\">type</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #DC3EB7;\">float</span><span style=\"color: #002339;\">, </span><span style=\"color: #B1108E;\">default</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #174781;\">0.2</span><span style=\"color: #002339;\">,</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 26</span><span style=\"color: #002339;\">                        </span><span style=\"color: #B1108E;\">help</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">coefficient of the entropy</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 27</span><span style=\"color: #002339;\">    parser.add_argument(</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">--vf_coef</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">, </span><span style=\"color: #B1108E;\">type</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #DC3EB7;\">float</span><span style=\"color: #002339;\">, </span><span style=\"color: #B1108E;\">default</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #174781;\">2</span><span style=\"color: #002339;\">.,</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 28</span><span style=\"color: #002339;\">                        </span><span style=\"color: #B1108E;\">help</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">coefficient of the value function</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 29</span><span style=\"color: #002339;\">    parser.add_argument(</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">--max_grad_norm</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">, </span><span style=\"color: #B1108E;\">type</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #DC3EB7;\">float</span><span style=\"color: #002339;\">, </span><span style=\"color: #B1108E;\">default</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #174781;\">0.5</span><span style=\"color: #002339;\">,</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 30</span><span style=\"color: #002339;\">                        </span><span style=\"color: #B1108E;\">help</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">the maximum norm for the gradient clipping</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 31</span><span style=\"color: #002339;\">    parser.add_argument(</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">--target_kl</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">, </span><span style=\"color: #B1108E;\">type</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #DC3EB7;\">float</span><span style=\"color: #002339;\">, </span><span style=\"color: #B1108E;\">default</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #2970C7;\">None</span><span style=\"color: #002339;\">,</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 32</span><span style=\"color: #002339;\">                        </span><span style=\"color: #B1108E;\">help</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">the target KL divergence threshold</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 33</span>&nbsp;</div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 34</span><span style=\"color: #002339;\">    parser.add_argument(</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">--learning_rate</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">, </span><span style=\"color: #B1108E;\">type</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #DC3EB7;\">float</span><span style=\"color: #002339;\">, </span><span style=\"color: #B1108E;\">default</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #174781;\">1e-4</span><span style=\"color: #002339;\">,</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 35</span><span style=\"color: #002339;\">                        </span><span style=\"color: #B1108E;\">help</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">learning rate</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 36</span><span style=\"color: #002339;\">    parser.add_argument(</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">--device</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">, </span><span style=\"color: #B1108E;\">type</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #DC3EB7;\">str</span><span style=\"color: #002339;\">, </span><span style=\"color: #B1108E;\">default</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">cuda</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\"> </span><span style=\"color: #0991B6;\">if</span><span style=\"color: #002339;\"> torch.cuda.is_available() </span><span style=\"color: #0991B6;\">else</span><span style=\"color: #002339;\"> </span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">cpu</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">,</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 37</span><span style=\"color: #002339;\">                        </span><span style=\"color: #B1108E;\">help</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">Device to run the experiment on</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 38</span><span style=\"color: #002339;\">    args </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> parser.parse_args()</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 39</span>&nbsp;</div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 40</span><span style=\"color: #002339;\">    args.batch_size </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> args.num_steps</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 41</span><span style=\"color: #002339;\">    args.minibatch_size </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> </span><span style=\"color: #DC3EB7;\">int</span><span style=\"color: #002339;\">(args.batch_size </span><span style=\"color: #7B30D0;\">//</span><span style=\"color: #002339;\"> args.num_minibatches)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 42</span><span style=\"color: #002339;\">    args.num_iterations </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> args.total_timesteps </span><span style=\"color: #7B30D0;\">//</span><span style=\"color: #002339;\"> args.batch_size</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 43</span>&nbsp;</div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 44</span><span style=\"color: #002339;\">    random.seed(args.seed)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 45</span><span style=\"color: #002339;\">    np.random.seed(args.seed)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 46</span><span style=\"color: #002339;\">    torch.manual_seed(args.seed)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 47</span><span style=\"color: #002339;\">    torch.backends.cudnn.deterministic </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> </span><span style=\"color: #2970C7;\">True</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 48</span>&nbsp;</div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 49</span><span style=\"color: #002339;\">    device </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> torch.device(args.device)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 50</span><span style=\"color: #002339;\">    </span><span style=\"color: #08134A;\">print</span><span style=\"color: #002339;\">(</span><span style=\"color: #0991B6;\">f</span><span style=\"color: #A44185;\">&quot;Using device: </span><span style=\"color: #2970C7;\">{</span><span style=\"color: #002339;\">device</span><span style=\"color: #2970C7;\">}</span><span style=\"color: #A44185;\">&quot;</span><span style=\"color: #002339;\">)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 51</span>&nbsp;</div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 52</span><span style=\"color: #002339;\">    env </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> aerodrome.make(</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">wingedcone-v0</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 53</span><span style=\"color: #002339;\">    object_dict </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> {</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 54</span><span style=\"color: #002339;\">        </span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">name</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">: </span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">test</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">,</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 55</span><span style=\"color: #002339;\">        </span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">integrator</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">: </span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">rk45</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">,</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 56</span><span style=\"color: #002339;\">        </span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">S</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">: </span><span style=\"color: #174781;\">3603.0</span><span style=\"color: #002339;\">,</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 57</span><span style=\"color: #002339;\">        </span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">c</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">: </span><span style=\"color: #174781;\">80.0</span><span style=\"color: #002339;\">,</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 58</span><span style=\"color: #002339;\">        </span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">m</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">: </span><span style=\"color: #174781;\">9375.0</span><span style=\"color: #002339;\">,</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 59</span>&nbsp;</div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 60</span><span style=\"color: #002339;\">        </span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">pos</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">: [</span><span style=\"color: #174781;\">0.0</span><span style=\"color: #002339;\">, </span><span style=\"color: #174781;\">33528.0</span><span style=\"color: #002339;\">, </span><span style=\"color: #174781;\">0.0</span><span style=\"color: #002339;\">],</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 61</span><span style=\"color: #002339;\">        </span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">vel</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">: [</span><span style=\"color: #174781;\">4590.29</span><span style=\"color: #002339;\">, </span><span style=\"color: #174781;\">0.0</span><span style=\"color: #002339;\">, </span><span style=\"color: #174781;\">0.0</span><span style=\"color: #002339;\">],</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 62</span><span style=\"color: #002339;\">        </span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">ang_vel</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">: [</span><span style=\"color: #174781;\">0.0</span><span style=\"color: #002339;\">, </span><span style=\"color: #174781;\">0.0</span><span style=\"color: #002339;\">, </span><span style=\"color: #174781;\">0.0</span><span style=\"color: #002339;\">],</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 63</span><span style=\"color: #002339;\">        </span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">J</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">: [</span><span style=\"color: #174781;\">1.0</span><span style=\"color: #002339;\">, </span><span style=\"color: #174781;\">7</span><span style=\"color: #7B30D0;\">*</span><span style=\"color: #174781;\">10</span><span style=\"color: #7B30D0;\">**</span><span style=\"color: #174781;\">6</span><span style=\"color: #002339;\">, </span><span style=\"color: #174781;\">7</span><span style=\"color: #7B30D0;\">*</span><span style=\"color: #174781;\">10</span><span style=\"color: #7B30D0;\">**</span><span style=\"color: #174781;\">6</span><span style=\"color: #002339;\">],</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 64</span><span style=\"color: #002339;\">        </span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">theta</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">: </span><span style=\"color: #174781;\">0.00</span><span style=\"color: #7B30D0;\">/</span><span style=\"color: #174781;\">180</span><span style=\"color: #7B30D0;\">*</span><span style=\"color: #002339;\">pi,</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 65</span><span style=\"color: #002339;\">        </span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">phi</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">: </span><span style=\"color: #174781;\">0.0</span><span style=\"color: #002339;\">,</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 66</span><span style=\"color: #002339;\">        </span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">gamma</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">: </span><span style=\"color: #174781;\">0.0</span><span style=\"color: #002339;\">,   </span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 67</span><span style=\"color: #002339;\">        </span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">theta_v</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">: </span><span style=\"color: #174781;\">0.0</span><span style=\"color: #002339;\">,</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 68</span><span style=\"color: #002339;\">        </span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">phi_v</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">: </span><span style=\"color: #174781;\">0.0</span><span style=\"color: #002339;\">,</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 69</span><span style=\"color: #002339;\">        </span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">gamma_v</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">: </span><span style=\"color: #174781;\">0.0</span><span style=\"color: #002339;\">,</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 70</span><span style=\"color: #002339;\">        </span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">alpha</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">: </span><span style=\"color: #174781;\">0.00</span><span style=\"color: #7B30D0;\">/</span><span style=\"color: #174781;\">180</span><span style=\"color: #7B30D0;\">*</span><span style=\"color: #002339;\">pi,</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 71</span><span style=\"color: #002339;\">        </span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">beta</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">: </span><span style=\"color: #174781;\">0.0</span><span style=\"color: #002339;\">,</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 72</span>&nbsp;</div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 73</span><span style=\"color: #002339;\">        </span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">Kiz</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">: </span><span style=\"color: #174781;\">0.2597</span><span style=\"color: #002339;\">,</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 74</span><span style=\"color: #002339;\">        </span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">Kwz</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">: </span><span style=\"color: #174781;\">1.6</span><span style=\"color: #002339;\">,</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 75</span><span style=\"color: #002339;\">        </span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">Kaz</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">: </span><span style=\"color: #174781;\">13</span><span style=\"color: #7B30D0;\">/</span><span style=\"color: #174781;\">2</span><span style=\"color: #002339;\">,</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 76</span><span style=\"color: #002339;\">        </span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">Kpz</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">: </span><span style=\"color: #174781;\">0.14</span><span style=\"color: #002339;\">,</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 77</span><span style=\"color: #002339;\">        </span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">Kp_V</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">: </span><span style=\"color: #174781;\">5.0</span><span style=\"color: #002339;\">,</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 78</span><span style=\"color: #002339;\">        </span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">Ki_V</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">: </span><span style=\"color: #174781;\">1.0</span><span style=\"color: #002339;\">,</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 79</span><span style=\"color: #002339;\">        </span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">Kd_V</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">: </span><span style=\"color: #174781;\">0.3</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 80</span><span style=\"color: #002339;\">    }</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 81</span>&nbsp;</div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 82</span><span style=\"color: #002339;\">    </span><span style=\"color: #DC3EB7;\">object</span><span style=\"color: #002339;\"> </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> WingedCone2D_RL(object_dict)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 83</span><span style=\"color: #002339;\">    env.add_object(</span><span style=\"color: #DC3EB7;\">object</span><span style=\"color: #002339;\">)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 84</span>&nbsp;</div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 85</span><span style=\"color: #002339;\">    agent </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> Agent().to(device)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 86</span><span style=\"color: #002339;\">    optimizer </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> optim.Adam(agent.parameters(), </span><span style=\"color: #B1108E;\">lr</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\">args.learning_rate, </span><span style=\"color: #B1108E;\">eps</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #174781;\">1e-5</span><span style=\"color: #002339;\">)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 87</span><span style=\"color: #002339;\">    cos_annealing_scheduler </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> CosineAnnealingLR(optimizer, </span><span style=\"color: #B1108E;\">T_max</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\">args.num_iterations, </span><span style=\"color: #B1108E;\">eta_min</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\">args.learning_rate</span><span style=\"color: #7B30D0;\">/</span><span style=\"color: #174781;\">10</span><span style=\"color: #002339;\">)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 88</span>&nbsp;</div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 89</span><span style=\"color: #002339;\">    </span><span style=\"color: #357B42;\"># Storage setup</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 90</span><span style=\"color: #002339;\">    obs </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> torch.zeros((args.num_steps, </span><span style=\"color: #174781;\">3</span><span style=\"color: #002339;\">)).to(device)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 91</span><span style=\"color: #002339;\">    actions </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> torch.zeros((args.num_steps, </span><span style=\"color: #174781;\">1</span><span style=\"color: #002339;\">)).to(device)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 92</span><span style=\"color: #002339;\">    logprobs </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> torch.zeros((args.num_steps, </span><span style=\"color: #174781;\">1</span><span style=\"color: #002339;\">)).to(device)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 93</span><span style=\"color: #002339;\">    rewards </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> torch.zeros((args.num_steps, </span><span style=\"color: #174781;\">1</span><span style=\"color: #002339;\">)).to(device)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 94</span><span style=\"color: #002339;\">    dones </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> torch.zeros((args.num_steps, </span><span style=\"color: #174781;\">1</span><span style=\"color: #002339;\">)).to(device)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 95</span><span style=\"color: #002339;\">    values </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> torch.zeros((args.num_steps, </span><span style=\"color: #174781;\">1</span><span style=\"color: #002339;\">)).to(device)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 96</span>&nbsp;</div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 97</span><span style=\"color: #002339;\">    global_step </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> </span><span style=\"color: #174781;\">0</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 98</span>&nbsp;</div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\"> 99</span><span style=\"color: #002339;\">    records </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> {</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">100</span><span style=\"color: #002339;\">        </span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">reward</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">: np.zeros(args.num_iterations),</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">101</span><span style=\"color: #002339;\">        </span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">learning_rate</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">: np.zeros(args.num_iterations),</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">102</span><span style=\"color: #002339;\">        </span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">value_loss</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">: np.zeros(args.num_iterations),</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">103</span><span style=\"color: #002339;\">        </span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">policy_loss</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">: np.zeros(args.num_iterations),</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">104</span><span style=\"color: #002339;\">        </span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">entropy</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">: np.zeros(args.num_iterations),</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">105</span><span style=\"color: #002339;\">    }</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">106</span>&nbsp;</div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">107</span><span style=\"color: #002339;\">    </span><span style=\"color: #0991B6;\">for</span><span style=\"color: #002339;\"> iteration </span><span style=\"color: #0991B6;\">in</span><span style=\"color: #002339;\"> tqdm(</span><span style=\"color: #08134A;\">range</span><span style=\"color: #002339;\">(</span><span style=\"color: #174781;\">1</span><span style=\"color: #002339;\">, args.num_iterations </span><span style=\"color: #7B30D0;\">+</span><span style=\"color: #002339;\"> </span><span style=\"color: #174781;\">1</span><span style=\"color: #002339;\">)):</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">108</span><span style=\"color: #002339;\">        env </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> aerodrome.make(</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">wingedcone-v0</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">109</span><span style=\"color: #002339;\">        </span><span style=\"color: #DC3EB7;\">object</span><span style=\"color: #002339;\"> </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> WingedCone2D_RL(object_dict)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">110</span><span style=\"color: #002339;\">        env.add_object(</span><span style=\"color: #DC3EB7;\">object</span><span style=\"color: #002339;\">)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">111</span>&nbsp;</div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">112</span><span style=\"color: #002339;\">        next_obs, info </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> env.reset()</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">113</span><span style=\"color: #002339;\">        next_obs </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> torch.Tensor(next_obs).reshape((</span><span style=\"color: #174781;\">1</span><span style=\"color: #002339;\">, </span><span style=\"color: #7B30D0;\">-</span><span style=\"color: #174781;\">1</span><span style=\"color: #002339;\">)).to(device)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">114</span><span style=\"color: #002339;\">        first_rollout </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> </span><span style=\"color: #2970C7;\">True</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">115</span><span style=\"color: #002339;\">        rollout_return </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> </span><span style=\"color: #174781;\">0.0</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">116</span><span style=\"color: #002339;\">        </span><span style=\"color: #0991B6;\">for</span><span style=\"color: #002339;\"> step </span><span style=\"color: #0991B6;\">in</span><span style=\"color: #002339;\"> </span><span style=\"color: #08134A;\">range</span><span style=\"color: #002339;\">(</span><span style=\"color: #174781;\">0</span><span style=\"color: #002339;\">, args.num_steps):</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">117</span><span style=\"color: #002339;\">            global_step </span><span style=\"color: #7B30D0;\">+=</span><span style=\"color: #002339;\"> </span><span style=\"color: #174781;\">1</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">118</span><span style=\"color: #002339;\">            obs[step] </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> next_obs</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">119</span>&nbsp;</div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">120</span><span style=\"color: #002339;\">            </span><span style=\"color: #357B42;\"># ALGO LOGIC: action logic</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">121</span><span style=\"color: #002339;\">            </span><span style=\"color: #0991B6;\">with</span><span style=\"color: #002339;\"> torch.no_grad():</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">122</span><span style=\"color: #002339;\">                action, logprob, _, value </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> agent.get_action_and_value(next_obs)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">123</span><span style=\"color: #002339;\">                values[step] </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> value.flatten()</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">124</span><span style=\"color: #002339;\">            actions[step] </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> action</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">125</span><span style=\"color: #002339;\">            logprobs[step] </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> logprob</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">126</span>&nbsp;</div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">127</span><span style=\"color: #002339;\">            </span><span style=\"color: #357B42;\"># TRY NOT TO MODIFY: execute the game and log data.</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">128</span><span style=\"color: #002339;\">            step_action </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> {</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">129</span><span style=\"color: #002339;\">                </span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">test</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">: {</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">Nyc</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">:</span><span style=\"color: #174781;\">1.0</span><span style=\"color: #002339;\">, </span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">Vc</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">:</span><span style=\"color: #174781;\">4590.29</span><span style=\"color: #002339;\">, </span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">nn_control</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">:action.item()},</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">130</span><span style=\"color: #002339;\">            }</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">131</span><span style=\"color: #002339;\">            next_obs, reward, terminations, truncations, infos </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> env.step(step_action)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">132</span><span style=\"color: #002339;\">            next_done </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> np.logical_or(terminations, truncations)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">133</span><span style=\"color: #002339;\">            rewards[step] </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> torch.tensor(reward).to(device).view(</span><span style=\"color: #7B30D0;\">-</span><span style=\"color: #174781;\">1</span><span style=\"color: #002339;\">)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">134</span><span style=\"color: #002339;\">            next_obs, next_done </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> torch.Tensor(next_obs).reshape((</span><span style=\"color: #174781;\">1</span><span style=\"color: #002339;\">, </span><span style=\"color: #7B30D0;\">-</span><span style=\"color: #174781;\">1</span><span style=\"color: #002339;\">)).to(device), torch.Tensor(next_done).reshape((</span><span style=\"color: #174781;\">1</span><span style=\"color: #002339;\">, </span><span style=\"color: #7B30D0;\">-</span><span style=\"color: #174781;\">1</span><span style=\"color: #002339;\">)).to(device)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">135</span>&nbsp;</div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">136</span><span style=\"color: #002339;\">            dones[step] </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> next_done</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">137</span>&nbsp;</div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">138</span><span style=\"color: #002339;\">            </span><span style=\"color: #0991B6;\">if</span><span style=\"color: #002339;\"> first_rollout:</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">139</span><span style=\"color: #002339;\">                rollout_return </span><span style=\"color: #7B30D0;\">+=</span><span style=\"color: #002339;\"> reward</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">140</span><span style=\"color: #002339;\">                </span><span style=\"color: #0991B6;\">if</span><span style=\"color: #002339;\"> next_done </span><span style=\"color: #7B30D0;\">or</span><span style=\"color: #002339;\"> step </span><span style=\"color: #7B30D0;\">==</span><span style=\"color: #002339;\"> args.num_steps </span><span style=\"color: #7B30D0;\">-</span><span style=\"color: #002339;\"> </span><span style=\"color: #174781;\">1</span><span style=\"color: #002339;\">:</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">141</span><span style=\"color: #002339;\">                    first_rollout </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> </span><span style=\"color: #2970C7;\">False</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">142</span><span style=\"color: #002339;\">                    rewards[step] </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> rollout_return</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">143</span>&nbsp;</div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">144</span><span style=\"color: #002339;\">            </span><span style=\"color: #0991B6;\">if</span><span style=\"color: #002339;\"> next_done:</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">145</span><span style=\"color: #002339;\">                env </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> aerodrome.make(</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">wingedcone-v0</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">146</span><span style=\"color: #002339;\">                </span><span style=\"color: #DC3EB7;\">object</span><span style=\"color: #002339;\"> </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> WingedCone2D_RL(object_dict)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">147</span><span style=\"color: #002339;\">                env.add_object(</span><span style=\"color: #DC3EB7;\">object</span><span style=\"color: #002339;\">)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">148</span>&nbsp;</div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">149</span><span style=\"color: #002339;\">                next_obs, info </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> env.reset()</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">150</span><span style=\"color: #002339;\">                next_obs </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> torch.Tensor(next_obs).to(device)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">151</span>&nbsp;</div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">152</span><span style=\"color: #002339;\">        </span><span style=\"color: #357B42;\"># bootstrap value if not done</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">153</span><span style=\"color: #002339;\">        </span><span style=\"color: #0991B6;\">with</span><span style=\"color: #002339;\"> torch.no_grad():</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">154</span><span style=\"color: #002339;\">            next_value </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> agent.get_value(next_obs).reshape(</span><span style=\"color: #174781;\">1</span><span style=\"color: #002339;\">, </span><span style=\"color: #7B30D0;\">-</span><span style=\"color: #174781;\">1</span><span style=\"color: #002339;\">)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">155</span><span style=\"color: #002339;\">            advantages </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> torch.zeros_like(rewards).to(device)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">156</span><span style=\"color: #002339;\">            lastgaelam </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> </span><span style=\"color: #174781;\">0</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">157</span><span style=\"color: #002339;\">            </span><span style=\"color: #0991B6;\">for</span><span style=\"color: #002339;\"> t </span><span style=\"color: #0991B6;\">in</span><span style=\"color: #002339;\"> </span><span style=\"color: #08134A;\">reversed</span><span style=\"color: #002339;\">(</span><span style=\"color: #08134A;\">range</span><span style=\"color: #002339;\">(args.num_steps)):</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">158</span><span style=\"color: #002339;\">                </span><span style=\"color: #0991B6;\">if</span><span style=\"color: #002339;\"> t </span><span style=\"color: #7B30D0;\">==</span><span style=\"color: #002339;\"> args.num_steps </span><span style=\"color: #7B30D0;\">-</span><span style=\"color: #002339;\"> </span><span style=\"color: #174781;\">1</span><span style=\"color: #002339;\">:</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">159</span><span style=\"color: #002339;\">                    nextnonterminal </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> </span><span style=\"color: #174781;\">1.0</span><span style=\"color: #002339;\"> </span><span style=\"color: #7B30D0;\">-</span><span style=\"color: #002339;\"> next_done</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">160</span><span style=\"color: #002339;\">                    nextvalues </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> next_value</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">161</span><span style=\"color: #002339;\">                </span><span style=\"color: #0991B6;\">else</span><span style=\"color: #002339;\">:</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">162</span><span style=\"color: #002339;\">                    nextnonterminal </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> </span><span style=\"color: #174781;\">1.0</span><span style=\"color: #002339;\"> </span><span style=\"color: #7B30D0;\">-</span><span style=\"color: #002339;\"> dones[t]</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">163</span><span style=\"color: #002339;\">                    nextvalues </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> values[t </span><span style=\"color: #7B30D0;\">+</span><span style=\"color: #002339;\"> </span><span style=\"color: #174781;\">1</span><span style=\"color: #002339;\">]</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">164</span><span style=\"color: #002339;\">                delta </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> rewards[t] </span><span style=\"color: #7B30D0;\">+</span><span style=\"color: #002339;\"> args.gamma </span><span style=\"color: #7B30D0;\">*</span><span style=\"color: #002339;\"> nextvalues </span><span style=\"color: #7B30D0;\">*</span><span style=\"color: #002339;\"> nextnonterminal </span><span style=\"color: #7B30D0;\">-</span><span style=\"color: #002339;\"> values[t]</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">165</span><span style=\"color: #002339;\">                advantages[t] </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> lastgaelam </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> delta </span><span style=\"color: #7B30D0;\">+</span><span style=\"color: #002339;\"> args.gamma </span><span style=\"color: #7B30D0;\">*</span><span style=\"color: #002339;\"> args.gae_lambda </span><span style=\"color: #7B30D0;\">*</span><span style=\"color: #002339;\"> nextnonterminal </span><span style=\"color: #7B30D0;\">*</span><span style=\"color: #002339;\"> lastgaelam</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">166</span><span style=\"color: #002339;\">            returns </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> advantages </span><span style=\"color: #7B30D0;\">+</span><span style=\"color: #002339;\"> values</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">167</span>&nbsp;</div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">168</span><span style=\"color: #002339;\">        </span><span style=\"color: #357B42;\"># flatten the batch</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">169</span><span style=\"color: #002339;\">        b_obs </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> obs.reshape((</span><span style=\"color: #7B30D0;\">-</span><span style=\"color: #174781;\">1</span><span style=\"color: #002339;\">, </span><span style=\"color: #174781;\">3</span><span style=\"color: #002339;\">))</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">170</span><span style=\"color: #002339;\">        b_logprobs </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> logprobs.reshape(</span><span style=\"color: #7B30D0;\">-</span><span style=\"color: #174781;\">1</span><span style=\"color: #002339;\">)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">171</span><span style=\"color: #002339;\">        b_actions </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> actions.reshape((</span><span style=\"color: #7B30D0;\">-</span><span style=\"color: #174781;\">1</span><span style=\"color: #002339;\">, </span><span style=\"color: #174781;\">1</span><span style=\"color: #002339;\">))</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">172</span><span style=\"color: #002339;\">        b_advantages </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> advantages.reshape(</span><span style=\"color: #7B30D0;\">-</span><span style=\"color: #174781;\">1</span><span style=\"color: #002339;\">)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">173</span><span style=\"color: #002339;\">        b_returns </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> returns.reshape(</span><span style=\"color: #7B30D0;\">-</span><span style=\"color: #174781;\">1</span><span style=\"color: #002339;\">)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">174</span><span style=\"color: #002339;\">        b_values </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> values.reshape(</span><span style=\"color: #7B30D0;\">-</span><span style=\"color: #174781;\">1</span><span style=\"color: #002339;\">)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">175</span>&nbsp;</div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">176</span><span style=\"color: #002339;\">        </span><span style=\"color: #357B42;\"># Optimizing the policy and value network</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">177</span><span style=\"color: #002339;\">        b_inds </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> np.arange(args.batch_size)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">178</span><span style=\"color: #002339;\">        clipfracs </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> []</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">179</span><span style=\"color: #002339;\">        </span><span style=\"color: #0991B6;\">for</span><span style=\"color: #002339;\"> epoch </span><span style=\"color: #0991B6;\">in</span><span style=\"color: #002339;\"> </span><span style=\"color: #08134A;\">range</span><span style=\"color: #002339;\">(args.update_epochs):</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">180</span><span style=\"color: #002339;\">            np.random.shuffle(b_inds)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">181</span><span style=\"color: #002339;\">            </span><span style=\"color: #0991B6;\">for</span><span style=\"color: #002339;\"> start </span><span style=\"color: #0991B6;\">in</span><span style=\"color: #002339;\"> </span><span style=\"color: #08134A;\">range</span><span style=\"color: #002339;\">(</span><span style=\"color: #174781;\">0</span><span style=\"color: #002339;\">, args.batch_size, args.minibatch_size):</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">182</span><span style=\"color: #002339;\">                end </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> start </span><span style=\"color: #7B30D0;\">+</span><span style=\"color: #002339;\"> args.minibatch_size</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">183</span><span style=\"color: #002339;\">                mb_inds </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> b_inds[start:end]</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">184</span>&nbsp;</div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">185</span><span style=\"color: #002339;\">                _, newlogprob, entropy, newvalue </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> agent.get_action_and_value(b_obs[mb_inds], b_actions[mb_inds])</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">186</span><span style=\"color: #002339;\">                logratio </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> newlogprob </span><span style=\"color: #7B30D0;\">-</span><span style=\"color: #002339;\"> b_logprobs[mb_inds]</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">187</span><span style=\"color: #002339;\">                ratio </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> logratio.exp()</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">188</span>&nbsp;</div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">189</span><span style=\"color: #002339;\">                </span><span style=\"color: #0991B6;\">with</span><span style=\"color: #002339;\"> torch.no_grad():</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">190</span><span style=\"color: #002339;\">                    </span><span style=\"color: #357B42;\"># calculate approx_kl http://joschu.net/blog/kl-approx.html</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">191</span><span style=\"color: #002339;\">                    old_approx_kl </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> (</span><span style=\"color: #7B30D0;\">-</span><span style=\"color: #002339;\">logratio).mean()</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">192</span><span style=\"color: #002339;\">                    approx_kl </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> ((ratio </span><span style=\"color: #7B30D0;\">-</span><span style=\"color: #002339;\"> </span><span style=\"color: #174781;\">1</span><span style=\"color: #002339;\">) </span><span style=\"color: #7B30D0;\">-</span><span style=\"color: #002339;\"> logratio).mean()</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">193</span><span style=\"color: #002339;\">                    clipfracs </span><span style=\"color: #7B30D0;\">+=</span><span style=\"color: #002339;\"> [((ratio </span><span style=\"color: #7B30D0;\">-</span><span style=\"color: #002339;\"> </span><span style=\"color: #174781;\">1.0</span><span style=\"color: #002339;\">).abs() </span><span style=\"color: #7B30D0;\">&gt;</span><span style=\"color: #002339;\"> args.clip_coef).float().mean().item()]</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">194</span>&nbsp;</div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">195</span><span style=\"color: #002339;\">                mb_advantages </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> b_advantages[mb_inds]</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">196</span><span style=\"color: #002339;\">                </span><span style=\"color: #0991B6;\">if</span><span style=\"color: #002339;\"> args.norm_adv:</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">197</span><span style=\"color: #002339;\">                    mb_advantages </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> (mb_advantages </span><span style=\"color: #7B30D0;\">-</span><span style=\"color: #002339;\"> mb_advantages.mean()) </span><span style=\"color: #7B30D0;\">/</span><span style=\"color: #002339;\"> (mb_advantages.std() </span><span style=\"color: #7B30D0;\">+</span><span style=\"color: #002339;\"> </span><span style=\"color: #174781;\">1e-8</span><span style=\"color: #002339;\">)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">198</span>&nbsp;</div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">199</span><span style=\"color: #002339;\">                </span><span style=\"color: #357B42;\"># Policy loss</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">200</span><span style=\"color: #002339;\">                pg_loss1 </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> </span><span style=\"color: #7B30D0;\">-</span><span style=\"color: #002339;\">mb_advantages </span><span style=\"color: #7B30D0;\">*</span><span style=\"color: #002339;\"> ratio</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">201</span><span style=\"color: #002339;\">                pg_loss2 </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> </span><span style=\"color: #7B30D0;\">-</span><span style=\"color: #002339;\">mb_advantages </span><span style=\"color: #7B30D0;\">*</span><span style=\"color: #002339;\"> torch.clamp(ratio, </span><span style=\"color: #174781;\">1</span><span style=\"color: #002339;\"> </span><span style=\"color: #7B30D0;\">-</span><span style=\"color: #002339;\"> args.clip_coef, </span><span style=\"color: #174781;\">1</span><span style=\"color: #002339;\"> </span><span style=\"color: #7B30D0;\">+</span><span style=\"color: #002339;\"> args.clip_coef)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">202</span><span style=\"color: #002339;\">                pg_loss </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> torch.max(pg_loss1, pg_loss2).mean()</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">203</span>&nbsp;</div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">204</span><span style=\"color: #002339;\">                </span><span style=\"color: #357B42;\"># Value loss</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">205</span><span style=\"color: #002339;\">                newvalue </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> newvalue.view(</span><span style=\"color: #7B30D0;\">-</span><span style=\"color: #174781;\">1</span><span style=\"color: #002339;\">)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">206</span><span style=\"color: #002339;\">                </span><span style=\"color: #0991B6;\">if</span><span style=\"color: #002339;\"> args.clip_vloss:</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">207</span><span style=\"color: #002339;\">                    v_loss_unclipped </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> (newvalue </span><span style=\"color: #7B30D0;\">-</span><span style=\"color: #002339;\"> b_returns[mb_inds]) </span><span style=\"color: #7B30D0;\">**</span><span style=\"color: #002339;\"> </span><span style=\"color: #174781;\">2</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">208</span><span style=\"color: #002339;\">                    v_clipped </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> b_values[mb_inds] </span><span style=\"color: #7B30D0;\">+</span><span style=\"color: #002339;\"> torch.clamp(</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">209</span><span style=\"color: #002339;\">                        newvalue </span><span style=\"color: #7B30D0;\">-</span><span style=\"color: #002339;\"> b_values[mb_inds],</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">210</span><span style=\"color: #002339;\">                        </span><span style=\"color: #7B30D0;\">-</span><span style=\"color: #002339;\">args.clip_coef,</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">211</span><span style=\"color: #002339;\">                        args.clip_coef,</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">212</span><span style=\"color: #002339;\">                    )</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">213</span><span style=\"color: #002339;\">                    v_loss_clipped </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> (v_clipped </span><span style=\"color: #7B30D0;\">-</span><span style=\"color: #002339;\"> b_returns[mb_inds]) </span><span style=\"color: #7B30D0;\">**</span><span style=\"color: #002339;\"> </span><span style=\"color: #174781;\">2</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">214</span><span style=\"color: #002339;\">                    v_loss_max </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> torch.max(v_loss_unclipped, v_loss_clipped)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">215</span><span style=\"color: #002339;\">                    v_loss </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> </span><span style=\"color: #174781;\">0.5</span><span style=\"color: #002339;\"> </span><span style=\"color: #7B30D0;\">*</span><span style=\"color: #002339;\"> v_loss_max.mean()</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">216</span><span style=\"color: #002339;\">                </span><span style=\"color: #0991B6;\">else</span><span style=\"color: #002339;\">:</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">217</span><span style=\"color: #002339;\">                    v_loss </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> </span><span style=\"color: #174781;\">0.5</span><span style=\"color: #002339;\"> </span><span style=\"color: #7B30D0;\">*</span><span style=\"color: #002339;\"> ((newvalue </span><span style=\"color: #7B30D0;\">-</span><span style=\"color: #002339;\"> b_returns[mb_inds]) </span><span style=\"color: #7B30D0;\">**</span><span style=\"color: #002339;\"> </span><span style=\"color: #174781;\">2</span><span style=\"color: #002339;\">).mean()</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">218</span>&nbsp;</div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">219</span><span style=\"color: #002339;\">                entropy_loss </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> entropy.mean()</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">220</span><span style=\"color: #002339;\">                loss </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> pg_loss </span><span style=\"color: #7B30D0;\">-</span><span style=\"color: #002339;\"> args.ent_coef </span><span style=\"color: #7B30D0;\">*</span><span style=\"color: #002339;\"> entropy_loss </span><span style=\"color: #7B30D0;\">+</span><span style=\"color: #002339;\"> v_loss </span><span style=\"color: #7B30D0;\">*</span><span style=\"color: #002339;\"> args.vf_coef</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">221</span>&nbsp;</div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">222</span><span style=\"color: #002339;\">                optimizer.zero_grad()</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">223</span><span style=\"color: #002339;\">                loss.backward()</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">224</span><span style=\"color: #002339;\">                nn.utils.clip_grad_norm_(agent.parameters(), args.max_grad_norm)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">225</span><span style=\"color: #002339;\">                optimizer.step()</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">226</span>&nbsp;</div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">227</span><span style=\"color: #002339;\">            </span><span style=\"color: #0991B6;\">if</span><span style=\"color: #002339;\"> args.target_kl </span><span style=\"color: #7B30D0;\">is</span><span style=\"color: #002339;\"> </span><span style=\"color: #7B30D0;\">not</span><span style=\"color: #002339;\"> </span><span style=\"color: #2970C7;\">None</span><span style=\"color: #002339;\"> </span><span style=\"color: #7B30D0;\">and</span><span style=\"color: #002339;\"> approx_kl </span><span style=\"color: #7B30D0;\">&gt;</span><span style=\"color: #002339;\"> args.target_kl:</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">228</span><span style=\"color: #002339;\">                </span><span style=\"color: #0991B6;\">break</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">229</span>&nbsp;</div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">230</span><span style=\"color: #002339;\">        y_pred, y_true </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> b_values.cpu().numpy(), b_returns.cpu().numpy()</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">231</span><span style=\"color: #002339;\">        var_y </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> np.var(y_true)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">232</span><span style=\"color: #002339;\">        explained_var </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> np.nan </span><span style=\"color: #0991B6;\">if</span><span style=\"color: #002339;\"> var_y </span><span style=\"color: #7B30D0;\">==</span><span style=\"color: #002339;\"> </span><span style=\"color: #174781;\">0</span><span style=\"color: #002339;\"> </span><span style=\"color: #0991B6;\">else</span><span style=\"color: #002339;\"> </span><span style=\"color: #174781;\">1</span><span style=\"color: #002339;\"> </span><span style=\"color: #7B30D0;\">-</span><span style=\"color: #002339;\"> np.var(y_true </span><span style=\"color: #7B30D0;\">-</span><span style=\"color: #002339;\"> y_pred) </span><span style=\"color: #7B30D0;\">/</span><span style=\"color: #002339;\"> var_y</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">233</span>&nbsp;</div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">234</span><span style=\"color: #002339;\">        records[</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">reward</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">][iteration </span><span style=\"color: #7B30D0;\">-</span><span style=\"color: #002339;\"> </span><span style=\"color: #174781;\">1</span><span style=\"color: #002339;\">] </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> rewards.sum().item()</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">235</span><span style=\"color: #002339;\">        records[</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">learning_rate</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">][iteration </span><span style=\"color: #7B30D0;\">-</span><span style=\"color: #002339;\"> </span><span style=\"color: #174781;\">1</span><span style=\"color: #002339;\">] </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> optimizer.param_groups[</span><span style=\"color: #174781;\">0</span><span style=\"color: #002339;\">][</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">lr</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">]</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">236</span><span style=\"color: #002339;\">        records[</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">value_loss</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">][iteration </span><span style=\"color: #7B30D0;\">-</span><span style=\"color: #002339;\"> </span><span style=\"color: #174781;\">1</span><span style=\"color: #002339;\">] </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> v_loss.item()</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">237</span><span style=\"color: #002339;\">        records[</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">policy_loss</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">][iteration </span><span style=\"color: #7B30D0;\">-</span><span style=\"color: #002339;\"> </span><span style=\"color: #174781;\">1</span><span style=\"color: #002339;\">] </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> pg_loss.item()</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">238</span><span style=\"color: #002339;\">        records[</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">entropy</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">][iteration </span><span style=\"color: #7B30D0;\">-</span><span style=\"color: #002339;\"> </span><span style=\"color: #174781;\">1</span><span style=\"color: #002339;\">] </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> entropy_loss.item()</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">239</span>&nbsp;</div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">240</span><span style=\"color: #002339;\">        cos_annealing_scheduler.step()</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">241</span>&nbsp;</div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">242</span><span style=\"color: #002339;\">        </span><span style=\"color: #0991B6;\">if</span><span style=\"color: #002339;\"> iteration </span><span style=\"color: #7B30D0;\">==</span><span style=\"color: #002339;\"> args.num_iterations:</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">243</span><span style=\"color: #002339;\">            states </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> []</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">244</span><span style=\"color: #002339;\">            rewards </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> []</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">245</span><span style=\"color: #002339;\">            env </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> aerodrome.make(</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">wingedcone-v0</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">246</span><span style=\"color: #002339;\">            </span><span style=\"color: #DC3EB7;\">object</span><span style=\"color: #002339;\"> </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> WingedCone2D_RL(object_dict)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">247</span><span style=\"color: #002339;\">            env.add_object(</span><span style=\"color: #DC3EB7;\">object</span><span style=\"color: #002339;\">)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">248</span><span style=\"color: #002339;\">            next_obs, info </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> env.reset()</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">249</span><span style=\"color: #002339;\">            next_obs </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> torch.Tensor(next_obs).reshape((</span><span style=\"color: #174781;\">1</span><span style=\"color: #002339;\">, </span><span style=\"color: #7B30D0;\">-</span><span style=\"color: #174781;\">1</span><span style=\"color: #002339;\">)).to(device)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">250</span><span style=\"color: #002339;\">            step </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> </span><span style=\"color: #174781;\">0</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">251</span><span style=\"color: #002339;\">            </span><span style=\"color: #0991B6;\">while</span><span style=\"color: #002339;\"> </span><span style=\"color: #2970C7;\">True</span><span style=\"color: #002339;\">:</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">252</span><span style=\"color: #002339;\">                step </span><span style=\"color: #7B30D0;\">+=</span><span style=\"color: #002339;\"> </span><span style=\"color: #174781;\">1</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">253</span><span style=\"color: #002339;\">                </span><span style=\"color: #357B42;\"># ALGO LOGIC: action logic</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">254</span><span style=\"color: #002339;\">                states.append(env.get_state())</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">255</span><span style=\"color: #002339;\">                </span><span style=\"color: #0991B6;\">with</span><span style=\"color: #002339;\"> torch.no_grad():</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">256</span><span style=\"color: #002339;\">                    action, logprob, _, value </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> agent.get_action_and_value(next_obs, </span><span style=\"color: #B1108E;\">evaluate</span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #2970C7;\">True</span><span style=\"color: #002339;\">)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">257</span>&nbsp;</div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">258</span><span style=\"color: #002339;\">                </span><span style=\"color: #357B42;\"># TRY NOT TO MODIFY: execute the game and log data.</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">259</span><span style=\"color: #002339;\">                step_action </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> {</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">260</span><span style=\"color: #002339;\">                    </span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">test</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">: {</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">Nyc</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">:</span><span style=\"color: #174781;\">1.0</span><span style=\"color: #002339;\">, </span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">Vc</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">:</span><span style=\"color: #174781;\">4590.29</span><span style=\"color: #002339;\">, </span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">nn_control</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">:action.item()},</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">261</span><span style=\"color: #002339;\">                }</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">262</span><span style=\"color: #002339;\">                next_obs, reward, terminations, truncations, infos </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> env.step(step_action)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">263</span><span style=\"color: #002339;\">                next_done </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> np.logical_or(terminations, truncations)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">264</span><span style=\"color: #002339;\">                next_obs </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> torch.Tensor(next_obs).reshape((</span><span style=\"color: #174781;\">1</span><span style=\"color: #002339;\">, </span><span style=\"color: #7B30D0;\">-</span><span style=\"color: #174781;\">1</span><span style=\"color: #002339;\">)).to(device)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">265</span><span style=\"color: #002339;\">                rewards.append(reward)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">266</span><span style=\"color: #002339;\">                </span><span style=\"color: #0991B6;\">if</span><span style=\"color: #002339;\"> next_done </span><span style=\"color: #7B30D0;\">or</span><span style=\"color: #002339;\"> step </span><span style=\"color: #7B30D0;\">&gt;=</span><span style=\"color: #002339;\"> </span><span style=\"color: #174781;\">1000</span><span style=\"color: #002339;\">:</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">267</span><span style=\"color: #002339;\">                    </span><span style=\"color: #0991B6;\">break</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">268</span><span style=\"color: #002339;\">            fig, ax </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> plt.subplots(</span><span style=\"color: #174781;\">1</span><span style=\"color: #002339;\">, </span><span style=\"color: #174781;\">1</span><span style=\"color: #002339;\">)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">269</span><span style=\"color: #002339;\">            x </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> np.array([states[i][</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">pos</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">][</span><span style=\"color: #174781;\">0</span><span style=\"color: #002339;\">] </span><span style=\"color: #0991B6;\">for</span><span style=\"color: #002339;\"> i </span><span style=\"color: #0991B6;\">in</span><span style=\"color: #002339;\"> </span><span style=\"color: #08134A;\">range</span><span style=\"color: #002339;\">(</span><span style=\"color: #08134A;\">len</span><span style=\"color: #002339;\">(states))])</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">270</span><span style=\"color: #002339;\">            y </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> np.array([states[i][</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">Ny</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">] </span><span style=\"color: #0991B6;\">for</span><span style=\"color: #002339;\"> i </span><span style=\"color: #0991B6;\">in</span><span style=\"color: #002339;\"> </span><span style=\"color: #08134A;\">range</span><span style=\"color: #002339;\">(</span><span style=\"color: #08134A;\">len</span><span style=\"color: #002339;\">(states))])</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">271</span><span style=\"color: #002339;\">            ax.plot(x, y)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">272</span><span style=\"color: #002339;\">            ax.plot(x, rewards)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">273</span><span style=\"color: #002339;\">            plt.show()</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">274</span>&nbsp;</div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">275</span><span style=\"color: #002339;\">    fig, ax </span><span style=\"color: #7B30D0;\">=</span><span style=\"color: #002339;\"> plt.subplots(</span><span style=\"color: #174781;\">1</span><span style=\"color: #002339;\">, </span><span style=\"color: #174781;\">1</span><span style=\"color: #002339;\">)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">276</span><span style=\"color: #002339;\">    ax.plot(records[</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">reward</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">])</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">277</span><span style=\"color: #002339;\">    ax.set_xlabel(</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">Iteration</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">278</span><span style=\"color: #002339;\">    ax.set_ylabel(</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">Reward</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">279</span><span style=\"color: #002339;\">    plt.show()</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">280</span>&nbsp;</div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">281</span><span style=\"color: #002339;\">    torch.save(agent.state_dict(), </span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">models/wingedcone_ppo.pth</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">)</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">282</span>&nbsp;</div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">283</span><span style=\"color: #0991B6;\">if</span><span style=\"color: #002339;\"> __name__ </span><span style=\"color: #7B30D0;\">==</span><span style=\"color: #002339;\"> </span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #A44185;\">__main__</span><span style=\"color: #D86DB6;\">&quot;</span><span style=\"color: #002339;\">:</span></div><div class='line'><span style=\"color:#2f86d2; text-align: right; -webkit-user-select: none; user-select: none;\" class=\"line-number\">284</span><span style=\"color: #002339;\">    main()</span></div>","classes":"torchlight","styles":"background-color: #FFFFFF; --theme-selection-background: #4373c2;"}}
